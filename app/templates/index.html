<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SEO Blog Post Generator | AI ê¸°ë°˜ SEO ì½˜í…ì¸  ìƒì„±ê¸°</title>
    <meta name="description" content="ê³ í’ˆì§ˆì˜ SEO ìµœì í™” ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ëª‡ ì´ˆ ë§Œì— ìƒì„±í•˜ì„¸ìš”. ê³ ê¸‰ AI ëª¨ë¸ê³¼ ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ë¶„ì„ì„ í™œìš©í•©ë‹ˆë‹¤.">
    <!-- Bootstrap CSS & Icons (Keep for grid/utilities, but override styles) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <!-- ìƒˆë¡œìš´ ëª¨ë“ˆí™”ëœ CSS ì‹œìŠ¤í…œ -->
    <link rel="stylesheet" href="/static/css/main.css">
    <!-- ê¸°ì¡´ ìŠ¤íƒ€ì¼ í˜¸í™˜ì„± ìœ ì§€ -->
    <link rel="stylesheet" href="/static/sanity_style.css">
    <link rel="stylesheet" href="/static/common.css">
    <link rel="stylesheet" href="/static/wizard.css">
    
    <!-- ëª¨ë“ˆí™”ëœ JavaScript (ES6 ëª¨ë“ˆ) -->
    <script type="module" src="/static/js/main.js" defer></script>
</head>

<body>
    <!-- Navbar -->
    {% include '_navbar.html' %}

    <!-- Main Content -->
    <div class="container-custom">
        <!-- Hero Section -->
        <section class="hero-section" aria-labelledby="hero-title">
            <h1 id="hero-title" class="hero-title">
                <span id="hero-title-text" class="text-gradient">GEO, AIO, SEO ì½˜í…ì¸ , AIê°€ ì¨ë“œë¦½ë‹ˆë‹¤</span>
            </h1>
            <p class="hero-subtitle">
                ê³ í’ˆì§ˆì˜ SEO ìµœì í™” ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ëª‡ ì´ˆ ë§Œì— ìƒì„±í•˜ì„¸ìš”.
            </p>
        </section>

        <!-- ì‘ì—… ì„ íƒ: íƒ­ìœ¼ë¡œ êµ¬ë¶„ (íƒ€ê²Ÿ ë¶„ì„ | ìƒˆ í¬ìŠ¤íŠ¸ ì‘ì„±) -->
        <div class="row justify-content-center">
            <div class="col-lg-10">
                {% include 'components/_work_tabs.html' %}

                <!-- Progress (ìƒì„± ì‹œì—ë§Œ í‘œì‹œ) -->
                {% include 'components/_progress_bar.html' %}

                <!-- í†µí•© ê²°ê³¼: ë¶„ì„ ì™„ë£Œ ë˜ëŠ” ìƒì„± ì™„ë£Œ í›„ ì—¬ê¸°ì— í‘œì‹œ -->
                {% include 'components/_result_display.html' %}
        </div>
    </div>

    <!-- Modals -->
    <div class="modal fade" id="complianceGuideModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ì¤€ìˆ˜ ê°€ì´ë“œ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="compliance-guide-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                    <button type="button" class="btn btn-primary" id="applySuggestionsBtn"
                        onclick="applyComplianceSuggestions()">ì œì•ˆ ì ìš©</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="analysisHelpModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="analysisHelpModalLabel">ë¶„ì„ ë„ì›€ë§</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="analysis-help-content"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentAbortController = null;

        // HTML ì½”ë“œ ë¸”ë¡ ì œê±° í•¨ìˆ˜ (ì „ì—­)
        function removeCodeBlocks(content) {
            if (!content || typeof content !== 'string') {
                return content;
            }

            return content
                .replace(/```html\s*[\s\S]*?\s*```/gi, '') // ```html ë¸”ë¡ ì œê±°
                .replace(/'''html\s*[\s\S]*?\s*'''/gi, '') // '''html ë¸”ë¡ ì œê±°
                .replace(/```\s*[\s\S]*?\s*```/gi, '') // ê¸°íƒ€ ``` ë¸”ë¡ ì œê±°
                .replace(/'''\s*[\s\S]*?\s*'''/gi, '') // ê¸°íƒ€ ''' ë¸”ë¡ ì œê±°
                .replace(/`[^`]*`/gi, '') // ë‹¨ì¼ ` ë¸”ë¡ ì œê±°
                .trim(); // ì•ë’¤ ê³µë°± ì œê±°
        }

        // HTML ë¸”ë¡ì—ì„œ ì‹¤ì œ HTML ì½˜í…ì¸ ë§Œ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜
        function extractHtmlContent(content) {
            if (!content || typeof content !== 'string') {
                return content;
            }

            // ```html ë¸”ë¡ì—ì„œ HTML ì½˜í…ì¸  ì¶”ì¶œ
            const htmlBlockMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (htmlBlockMatch) {
                return htmlBlockMatch[1].trim();
            }

            // '''html ë¸”ë¡ì—ì„œ HTML ì½˜í…ì¸  ì¶”ì¶œ
            const htmlBlockMatch2 = content.match(/'''html\s*([\s\S]*?)\s*'''/i);
            if (htmlBlockMatch2) {
                return htmlBlockMatch2[1].trim();
            }

            // HTML ë¸”ë¡ì´ ì—†ìœ¼ë©´ ì½”ë“œ ë¸”ë¡ë§Œ ì œê±°
            return removeCodeBlocks(content);
        }

        // ëª¨ë‹¬ ì ‘ê·¼ì„± ê°œì„ ì„ ìœ„í•œ ì „ì—­ ì„¤ì •
        document.addEventListener('DOMContentLoaded', function () {
            // ëª¨ë“  ëª¨ë‹¬ì— ëŒ€í•œ ì ‘ê·¼ì„± ê°œì„ 
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                // aria-hidden ì†ì„± ì œê±° (Bootstrapì´ ìë™ìœ¼ë¡œ ê´€ë¦¬)
                modal.removeAttribute('aria-hidden');

                // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                modal.addEventListener('show.bs.modal', function () {
                    // ëª¨ë‹¬ì´ ì—´ë¦¬ê¸° ì „ì— í¬ì»¤ìŠ¤ íŠ¸ë© ì„¤ì •
                    const focusableElements = modal.querySelectorAll(
                        'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
                    );
                    if (focusableElements.length > 0) {
                        focusableElements[0].focus();
                    }
                });

                modal.addEventListener('shown.bs.modal', function () {
                    // ëª¨ë‹¬ì´ ì™„ì „íˆ ì—´ë¦° í›„ í¬ì»¤ìŠ¤ ê´€ë¦¬
                    const firstFocusable = modal.querySelector(
                        'button:not([disabled]), [href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), [tabindex]:not([tabindex="-1"])'
                    );
                    if (firstFocusable) {
                        firstFocusable.focus();
                    }
                });

                modal.addEventListener('hidden.bs.modal', function () {
                    // ëª¨ë‹¬ì´ ë‹«íŒ í›„ í¬ì»¤ìŠ¤ ë³µì›
                    const generateBtn = document.getElementById('generate-btn');
                    if (generateBtn) {
                        generateBtn.focus();
                    }
                });
            });

            // ì „ì—­ ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ ì¶”ê°€
            window.addEventListener('error', function (event) {
                console.error('ì „ì—­ ì˜¤ë¥˜ ë°œìƒ:', event.error);
                // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ì•Œë¦¼ (í•„ìš”í•œ ê²½ìš°)
                if (event.error && event.error.message && !event.error.message.includes('Script error')) {
                    showAlert('danger', 'ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
            });

            // Promise ì˜¤ë¥˜ í•¸ë“¤ëŸ¬ ì¶”ê°€
            window.addEventListener('unhandledrejection', function (event) {
                console.error('ì²˜ë¦¬ë˜ì§€ ì•Šì€ Promise ì˜¤ë¥˜:', event.reason);
                event.preventDefault(); // ê¸°ë³¸ ì˜¤ë¥˜ ì²˜ë¦¬ ë°©ì§€

                // ë©”ì‹œì§€ ì±„ë„ ì˜¤ë¥˜ëŠ” ë¬´ì‹œ (ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ê´€ë ¨)
                if (event.reason && event.reason.message &&
                    event.reason.message.includes('message channel closed')) {
                    return;
                }

                // ë‹¤ë¥¸ Promise ì˜¤ë¥˜ëŠ” ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                showAlert('warning', 'ì‘ì—… ì¤‘ ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            });
        });

        async function generateContent() {
            const text = document.getElementById('text_input').value.trim();
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const keywordCountDiv = document.getElementById('keyword-count-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const contentLengthDiv = document.getElementById('content-length-container');
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressMessage = document.getElementById('progress-message');
            const aiStatus = document.getElementById('ai-status');
            const seoStatus = document.getElementById('seo-status');
            const cancelBtn = document.getElementById('cancel-btn');

            // URL ì…ë ¥ í™•ì¸
            const urlInput = document.getElementById('url_input');
            const url = urlInput ? urlInput.value.trim() : '';

            // URLì´ë‚˜ í…ìŠ¤íŠ¸ ì¤‘ í•˜ë‚˜ëŠ” ë°˜ë“œì‹œ ì…ë ¥ë˜ì–´ì•¼ í•¨
            if (!text && !url) {
                alert('URL ë˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // UI ìƒíƒœ ì´ˆê¸°í™” (null ì²´í¬ í¬í•¨)
            if (generateBtn) {
                generateBtn.disabled = true;
            }
            if (btnSpinner) {
                btnSpinner.classList.remove('d-none');
            }
            if (copyBtn) {
                copyBtn.classList.add('d-none');
            }
            if (downloadBtn) {
                downloadBtn.classList.add('d-none');
            }
            if (progressContainer) {
                progressContainer.style.display = 'block';
            }
            if (cancelBtn) {
                cancelBtn.style.display = 'inline-block';
            }

            // ê²°ê³¼ ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”
            resultDiv.innerHTML = `
                <div class="text-center text-muted py-5">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mb-0">AIê°€ ì½˜í…ì¸ ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            `;

            // ì½˜í…ì¸  ìƒíƒœ ì—…ë°ì´íŠ¸
            const contentStatus = document.getElementById('content-status');
            contentStatus.textContent = 'ìƒì„± ì¤‘';
            contentStatus.className = 'badge bg-warning me-2';

            // ì§„í–‰ë¥  ì´ˆê¸°í™” (null ì²´í¬ í¬í•¨)
            if (progressBar) {
                progressBar.style.width = '0%';
            }
            if (progressMessage) {
                progressMessage.textContent = 'ì´ˆê¸°í™” ì¤‘...';
            }
            if (aiStatus) {
                aiStatus.textContent = 'ëŒ€ê¸° ì¤‘';
            }
            if (seoStatus) {
                seoStatus.textContent = 'ëŒ€ê¸° ì¤‘';
            }

            // AbortController ì„¤ì •
            currentAbortController = new AbortController();

            try {
                // ì„ íƒëœ ì˜µì…˜ë“¤ ê°€ì ¸ì˜¤ê¸°
                const ruleCheckboxes = document.querySelectorAll('input[name="rules"]:checked');
                const rules = Array.from(ruleCheckboxes).map(cb => cb.value);
                const aiMode = document.getElementById('ai_mode').value;
                const contentLength = document.getElementById('content_length').value;
                const policyAuto = document.getElementById('policy_auto').checked;

                // ê²¬ê³ í•œ íŒŒì´í”„ë¼ì¸ ì‚¬ìš© ì—¬ë¶€ ê²°ì •
                const useRobustPipeline = url || text.length > 500; // URLì´ ìˆê±°ë‚˜ ê¸´ í…ìŠ¤íŠ¸ì¸ ê²½ìš°

                // ì…ë ¥ í…ìŠ¤íŠ¸ ë³´ì™„ (í…ìŠ¤íŠ¸ê°€ ì—†ëŠ” ê²½ìš° ë¹ˆ ë¬¸ìì—´ ì‚¬ìš©)
                const inputText = text || "";
                const enhancement = enhanceInputText(inputText, rules, aiMode);
                const enhancedText = enhancement.enhancedText;
                const enhancementNotes = enhancement.enhancementNotes;

                // ì¶”ê°€ ë³´ì™„ ì‚¬í•­ ì œì•ˆ
                const improvementSuggestions = generateImprovementSuggestions(rules, aiMode, contentLength);

                // ì„¤ì •ëœ ê°€ì´ë“œë¼ì¸ ì •ë³´ ì €ì¥ (ì „ì—­ ë³€ìˆ˜ë¡œ)
                window.currentGuidelinesConfig = {
                    rules: rules,
                    aiMode: aiMode,
                    contentLength: contentLength,
                    policyAuto: policyAuto,
                    enhancementNotes: enhancementNotes,
                    improvementSuggestions: improvementSuggestions
                };

                // ì ìš©ëœ ê°€ì´ë“œë¼ì¸ í‘œì‹œ
                displayAppliedGuidelines(rules, aiMode, contentLength, policyAuto, enhancementNotes, improvementSuggestions);

                // ìš”ì²­ ë°ì´í„° êµ¬ì„±
                const requestData = {
                    text: enhancedText,
                    url: url,
                    rules: rules,
                    ai_mode: aiMode,
                    content_length: contentLength,
                    policy_auto: policyAuto
                };

                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (null ì²´í¬ í¬í•¨)
                if (progressBar) {
                    progressBar.style.width = '25%';
                }
                if (progressMessage) {
                    progressMessage.textContent = 'AI ëª¨ë¸ ì´ˆê¸°í™” ì¤‘...';
                }
                if (aiStatus) {
                    aiStatus.textContent = 'ì²˜ë¦¬ ì¤‘';
                }

                // API ì—”ë“œí¬ì¸íŠ¸ ì„ íƒ - ê²¬ê³ í•œ íŒŒì´í”„ë¼ì¸ ìš°ì„  ì‚¬ìš©
                let apiEndpoint;
                if (useRobustPipeline) {
                    apiEndpoint = '/api/v1/generate-post-pipeline-robust';
                    if (progressMessage) {
                        progressMessage.textContent = 'ê²¬ê³ í•œ íŒŒì´í”„ë¼ì¸ìœ¼ë¡œ ì²˜ë¦¬ ì¤‘...';
                    }
                } else {
                    apiEndpoint = '/api/v1/generate-post-gemini-2-flash';
                    if (aiMode === 'enhanced') {
                        apiEndpoint = '/api/v1/generate-post-enhanced';
                    }
                }

                // API í˜¸ì¶œ
                const response = await fetch(apiEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                    signal: currentAbortController.signal
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸ (null ì²´í¬ í¬í•¨)
                if (progressBar) {
                    progressBar.style.width = '75%';
                }
                if (progressMessage) {
                    progressMessage.textContent = 'SEO ë¶„ì„ ì¤‘...';
                }
                if (seoStatus) {
                    seoStatus.textContent = 'ì²˜ë¦¬ ì¤‘';
                }

                const result = await response.json();

                if (result.success) {
                    // ì§„í–‰ë¥  ì™„ë£Œ (null ì²´í¬ í¬í•¨)
                    if (progressBar) {
                        progressBar.style.width = '100%';
                    }
                    if (progressMessage) {
                        progressMessage.textContent = 'ì™„ë£Œ!';
                    }
                    if (aiStatus) {
                        aiStatus.textContent = 'ì™„ë£Œ';
                    }
                    if (seoStatus) {
                        seoStatus.textContent = 'ì™„ë£Œ';
                    }

                    // ê²°ê³¼ í‘œì‹œ - ìƒˆë¡œìš´ í…œí”Œë¦¿ ì‚¬ìš©
                    const data = result.data;

                    // ì½˜í…ì¸  ê²€ì¦
                    if (!data.content || data.content.trim().length === 0) {
                        throw new Error('ìƒì„±ëœ ì½˜í…ì¸ ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    }

                    console.log('API ì‘ë‹µ ë°ì´í„°:', data);
                    console.log('ì½˜í…ì¸  ê¸¸ì´:', data.content.length);
                    console.log('ì½˜í…ì¸  ì‹œì‘ ë¶€ë¶„:', data.content.substring(0, 100));
                    console.log('ì½˜í…ì¸  ë ë¶€ë¶„:', data.content.substring(data.content.length - 100));

                    const aiMode = document.getElementById('ai_mode').value;
                    resultDiv.innerHTML = generateContentTemplate(data, aiMode);

                    // ì½˜í…ì¸  ìƒíƒœ ì—…ë°ì´íŠ¸
                    const contentStatus = document.getElementById('content-status');
                    contentStatus.textContent = 'ì™„ë£Œ';
                    contentStatus.className = 'badge bg-success me-2';

                    // ì •í™•í•œ ì½˜í…ì¸  ê¸¸ì´ ì¸¡ì • (ë³¸ë¬¸ë§Œ, ìš”ì•½ ì œì™¸)
                    console.log('=== generateContentì—ì„œ HTML ì •ì œ ê³¼ì • ===');

                    // HTML ë¸”ë¡ì—ì„œ ì‹¤ì œ HTML ì½˜í…ì¸ ë§Œ ì¶”ì¶œ
                    let generateCleanContent = extractHtmlContent(data.content);
                    console.log('HTML ë¸”ë¡ ì¶”ì¶œ ì„±ê³µ, ê¸¸ì´:', generateCleanContent.length);

                    // 2ë‹¨ê³„: generateCleanContentê°€ ë¹„ì–´ìˆìœ¼ë©´ ì›ë³¸ ì‚¬ìš©
                    if (!generateCleanContent || generateCleanContent.trim().length === 0) {
                        console.log('generateCleanContentê°€ ë¹„ì–´ìˆì–´ì„œ ì›ë³¸ data.content ì‚¬ìš©');
                        generateCleanContent = data.content;
                        console.log('ì›ë³¸ ì‚¬ìš© í›„ ê¸¸ì´:', generateCleanContent.length);
                    }

                    // 3ë‹¨ê³„: HTML íƒœê·¸ ë‹¨ê³„ë³„ ì œê±°
                    let contentText = generateCleanContent;

                    // H1-H4 íƒœê·¸ë§Œ ì œê±°
                    contentText = contentText.replace(/<h[1-4][^>]*>.*?<\/h[1-4]>/gi, '');
                    console.log('H1-H4 ì œê±° í›„ ê¸¸ì´:', contentText.length);

                    // ë‚˜ë¨¸ì§€ HTML íƒœê·¸ ì œê±°
                    contentText = contentText.replace(/<[^>]*>/g, '');
                    console.log('ëª¨ë“  HTML íƒœê·¸ ì œê±° í›„ ê¸¸ì´:', contentText.length);

                    // ê³µë°± ì •ë¦¬
                    contentText = contentText.replace(/\s+/g, ' ').trim();
                    console.log('ê³µë°± ì •ë¦¬ í›„ ê¸¸ì´:', contentText.length);

                    // 4ë‹¨ê³„: contentTextê°€ ë¹„ì–´ìˆìœ¼ë©´ H1-H4ë§Œ ì œê±°í•œ ë²„ì „ ì‚¬ìš©
                    if (!contentText || contentText.trim().length === 0) {
                        console.log('contentTextê°€ ë¹„ì–´ìˆì–´ì„œ H1-H4ë§Œ ì œê±°í•œ ë²„ì „ ì‚¬ìš©');
                        contentText = generateCleanContent
                            .replace(/<h[1-4][^>]*>.*?<\/h[1-4]>/gi, '')
                            .replace(/\s+/g, ' ')
                            .trim();
                        console.log('H1-H4ë§Œ ì œê±° í›„ ê¸¸ì´:', contentText.length);
                    }

                    // ìš”ì•½/ë³¸ë¬¸ ë¶„ë¦¬í•˜ì—¬ ë³¸ë¬¸ë§Œ ì¹´ìš´íŠ¸
                    console.log('=== generateContentì—ì„œ ìš”ì•½/ë³¸ë¬¸ ë¶„ë¦¬ ì‹œì‘ ===');
                    const { summary, body } = extractSummaryAndBody(contentText);
                    const actualContentLength = body.length;
                    const actualWordCount = body.split(' ').filter(word => word.length > 0).length;

                    console.log('generateContent ì¹´ìš´íŠ¸ ê²°ê³¼:');
                    console.log('- ë³¸ë¬¸ ê¸¸ì´:', actualContentLength);
                    console.log('- ë³¸ë¬¸ ë‹¨ì–´ìˆ˜:', actualWordCount);

                    // í†µê³„ ì—…ë°ì´íŠ¸ (ë³¸ë¬¸ ê¸°ì¤€)
                    keywordsDiv.textContent = data.keywords || 'í‚¤ì›Œë“œ ì—†ìŒ';
                    keywordCountDiv.textContent = data.keywords ? data.keywords.split(',').length : 0;
                    contentLengthDiv.textContent = actualContentLength.toLocaleString();
                    wordCountDiv.textContent = actualWordCount.toLocaleString();

                    // ìƒì„¸ ì§€í‘œ ì—…ë°ì´íŠ¸
                    if (data.metrics) {
                        document.getElementById('noun-count').textContent = data.metrics.noun_count || '-';
                        document.getElementById('verb-count').textContent = data.metrics.verb_count || '-';
                        document.getElementById('adj-count').textContent = data.metrics.adjective_count || '-';
                        document.getElementById('max-sent-len').textContent = data.metrics.max_sentence_length || '-';
                    }

                    // í‰ê°€ ì ìˆ˜ ì—…ë°ì´íŠ¸
                    if (data.score !== undefined) {
                        document.getElementById('eval-score').textContent = `ì ìˆ˜: ${data.score}`;
                        document.getElementById('eval-reason').textContent = data.evaluation || 'í‰ê°€ ë‚´ìš© ì—†ìŒ';
                    }


                    // ê°€ì´ë“œë¼ì¸ ë¶„ì„ ë° í‘œì‹œ
                    // í˜„ì¬ ìƒì„±ëœ ì½˜í…ì¸  ì €ì¥
                    currentGeneratedContent = data.content;

                    // ê°€ì´ë“œë¼ì¸ ë¶„ì„ - ë°±ì—”ë“œ ë°ì´í„° ìš°ì„ , ì—†ìœ¼ë©´ í”„ë¡ íŠ¸ì—”ë“œ ë¶„ì„
                    if (data.guidelines_analysis) {
                        console.log('ë°±ì—”ë“œ ê°€ì´ë“œë¼ì¸ ë¶„ì„ ì‚¬ìš©:', data.guidelines_analysis);
                        displayBackendGuidelinesAnalysis(data.guidelines_analysis);

                        // ì¤€ìˆ˜ë„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                        const complianceScore = document.getElementById('guidelines-compliance-score');
                        const complianceProgress = document.getElementById('compliance-progress');
                        const compliancePercentage = document.getElementById('compliance-percentage');

                        if (complianceScore && complianceProgress && compliancePercentage) {
                            const score = calculateComplianceScore(data.guidelines_analysis);
                            complianceScore.textContent = `ì¤€ìˆ˜ë„: ${score}%`;
                            complianceProgress.style.width = `${score}%`;
                            compliancePercentage.textContent = `${score}%`;
                        }
                    } else {
                        console.log('í”„ë¡ íŠ¸ì—”ë“œ ê°€ì´ë“œë¼ì¸ ë¶„ì„ ì‚¬ìš©');
                        console.log('ë¶„ì„í•  ì½˜í…ì¸  ê¸¸ì´:', data.content ? data.content.length : 'undefined');
                        const contentAnalysis = analyzeContentGuidelines(data.content || '');
                        displayGuidelinesAnalysis(contentAnalysis);

                        // ì¤€ìˆ˜ë„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                        const complianceScore = document.getElementById('guidelines-compliance-score');
                        const complianceProgress = document.getElementById('compliance-progress');
                        const compliancePercentage = document.getElementById('compliance-percentage');

                        if (complianceScore && complianceProgress && compliancePercentage) {
                            const score = calculateComplianceRate(contentAnalysis);
                            complianceScore.textContent = `ì¤€ìˆ˜ë„: ${score}%`;
                            complianceProgress.style.width = `${score}%`;
                            compliancePercentage.textContent = `${score}%`;
                        }
                    }

                    // ì„¤ì •ê³¼ ê²°ê³¼ ê°„ì˜ ì—°ê²°ì„± í‘œì‹œ
                    if (window.currentGuidelinesConfig) {
                        displayGuidelinesCompliance(data.content, window.currentGuidelinesConfig);
                    }

                    // AI ë¶„ì„ ê²°ê³¼ ì—…ë°ì´íŠ¸ (ìƒˆë¡œìš´ í…œí”Œë¦¿ ë‚´ì—ì„œ ì²˜ë¦¬)
                    setTimeout(() => {
                        const trustScoreContainer = document.getElementById('trust-score-container');
                        const trustReasonContainer = document.getElementById('trust-reason-container');
                        const seoScoreContainer = document.getElementById('seo-score-container');
                        const seoReasonContainer = document.getElementById('seo-reason-container');
                        const aiSummaryContainer = document.getElementById('ai-summary-container');

                        if (data.ai_analysis) {
                            // ë°±ì—”ë“œ AI ë¶„ì„ ë°ì´í„° ì‚¬ìš©
                            trustScoreContainer.textContent = `${data.ai_analysis.trust_score}/5`;
                            trustReasonContainer.textContent = data.ai_analysis.trust_reason || '-';
                            seoScoreContainer.textContent = `${data.ai_analysis.seo_score}/10`;
                            seoReasonContainer.textContent = data.ai_analysis.seo_reason || '-';
                            aiSummaryContainer.textContent = data.ai_analysis.ai_summary || '-';
                        } else {
                            // ê¸°ë³¸ ë¶„ì„ ìˆ˜í–‰ - ì•ˆì „í•œ HTML ì •ì œ
                            let analysisCleanContent = extractHtmlContent(data.content);

                            // analysisCleanContentê°€ ë¹„ì–´ìˆìœ¼ë©´ ì›ë³¸ ì‚¬ìš©
                            if (!analysisCleanContent || analysisCleanContent.trim().length === 0) {
                                analysisCleanContent = data.content;
                            }

                            let contentText = analysisCleanContent
                                .replace(/<h[1-4][^>]*>.*?<\/h[1-4]>/gi, '')
                                .replace(/<[^>]*>/g, '')
                                .replace(/\s+/g, ' ')
                                .trim();

                            // contentTextê°€ ë¹„ì–´ìˆìœ¼ë©´ H1-H4ë§Œ ì œê±°í•œ ë²„ì „ ì‚¬ìš©
                            if (!contentText || contentText.trim().length === 0) {
                                contentText = analysisCleanContent
                                    .replace(/<h[1-4][^>]*>.*?<\/h[1-4]>/gi, '')
                                    .replace(/\s+/g, ' ')
                                    .trim();
                            }

                            const contentLength = contentText.length;
                            const hasKeywords = data.keywords && data.keywords.length > 0;
                            const hasStructure = data.content.includes('<h1') || data.content.includes('<h2');

                            const trustScore = contentLength > 1000 ? 4 : contentLength > 500 ? 3 : 2;
                            const seoScore = (hasKeywords ? 2 : 0) + (hasStructure ? 2 : 0) + (contentLength > 800 ? 2 : 1) + 3;
                            const summary = contentLength > 100 ?
                                `${contentText.substring(0, 100)}...` :
                                'ìƒì„±ëœ ì½˜í…ì¸ ì— ëŒ€í•œ ê¸°ë³¸ ìš”ì•½';

                            trustScoreContainer.textContent = `${trustScore}/5`;
                            trustReasonContainer.textContent = contentLength > 1000 ? 'ìƒì„¸í•œ ì½˜í…ì¸ ë¡œ ë†’ì€ ì‹ ë¢°ë„' : 'ê¸°ë³¸ ì‹ ë¢°ë„ í‰ê°€';
                            seoScoreContainer.textContent = `${seoScore}/10`;
                            seoReasonContainer.textContent = hasKeywords && hasStructure ? 'í‚¤ì›Œë“œì™€ êµ¬ì¡° ìµœì í™”ë¨' : 'ê¸°ë³¸ SEO ìµœì í™”';
                            aiSummaryContainer.textContent = summary;
                        }
                    }, 100);

                    // ë²„íŠ¼ í‘œì‹œ
                    copyBtn.classList.remove('d-none');
                    downloadBtn.classList.remove('d-none');

                    // ì„±ê³µ ë©”ì‹œì§€
                    showAlert('success', 'ì½˜í…ì¸ ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } else {
                    throw new Error(result.message || 'ì½˜í…ì¸  ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }

            } catch (error) {
                if (error.name === 'AbortError') {
                    showAlert('info', 'ì½˜í…ì¸  ìƒì„±ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.');
                } else {
                    console.error('Error:', error);

                    // ì˜¤ë¥˜ ë©”ì‹œì§€ ê°œì„ 
                    let errorMessage = error.message;
                    let errorType = 'danger';
                    let errorTitle = 'ì½˜í…ì¸  ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';

                    // íŠ¹ì • ì˜¤ë¥˜ íƒ€ì…ì— ë”°ë¥¸ ë©”ì‹œì§€ ê°œì„ 
                    if (errorMessage.includes('API í‚¤') || errorMessage.includes('OPENAI_API_KEY')) {
                        errorTitle = 'API ì„¤ì • ë¬¸ì œ';
                        errorMessage = 'API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
                        errorType = 'warning';
                    } else if (errorMessage.includes('ë²ˆì—­') || errorMessage.includes('translation')) {
                        errorTitle = 'ë²ˆì—­ ì„œë¹„ìŠ¤ ì¼ì‹œì  ì¥ì• ';
                        errorMessage = 'ë²ˆì—­ ì„œë¹„ìŠ¤ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        errorType = 'warning';
                    } else if (errorMessage.includes('ê¸¸ì´') || errorMessage.includes('length')) {
                        errorTitle = 'ì½˜í…ì¸  ê¸¸ì´ ë¶€ì¡±';
                        errorMessage = 'ìƒì„±ëœ ì½˜í…ì¸ ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë” ê¸´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        errorType = 'info';
                    } else if (errorMessage.includes('timeout') || errorMessage.includes('ì‹œê°„ ì´ˆê³¼')) {
                        errorTitle = 'ìš”ì²­ ì‹œê°„ ì´ˆê³¼';
                        errorMessage = 'ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ìƒíƒœë¥¼ í™•ì¸í•˜ê³  ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                        errorType = 'warning';
                    }

                    resultDiv.innerHTML = `
                        <div class="text-center text-${errorType} py-5">
                            <i class="bi bi-exclamation-triangle fs-1 mb-3 d-block"></i>
                            <h5 class="mb-3">${errorTitle}</h5>
                            <p class="mb-3">${errorMessage}</p>
                            <div class="d-flex justify-content-center gap-2">
                                <button class="btn btn-outline-primary" onclick="generateContent()">
                                    <i class="bi bi-arrow-clockwise me-2"></i>ë‹¤ì‹œ ì‹œë„
                                </button>
                                <button class="btn btn-outline-secondary" onclick="showHelpModal()">
                                    <i class="bi bi-question-circle me-2"></i>ë„ì›€ë§
                                </button>
                            </div>
                        </div>
                    `;

                    // ì½˜í…ì¸  ìƒíƒœ ì—…ë°ì´íŠ¸
                    const contentStatus = document.getElementById('content-status');
                    contentStatus.textContent = 'ì˜¤ë¥˜';
                    contentStatus.className = `badge bg-${errorType} me-2`;

                    showAlert(errorType, errorMessage);
                }

                // í†µê³„ ì´ˆê¸°í™”
                keywordsDiv.textContent = '-';
                keywordCountDiv.textContent = '-';
                contentLengthDiv.textContent = '-';
                wordCountDiv.textContent = '-';
            } finally {
                // UI ìƒíƒœ ë³µì› (null ì²´í¬ í¬í•¨)
                if (generateBtn) {
                    generateBtn.disabled = false;
                }
                if (btnSpinner) {
                    btnSpinner.classList.add('d-none');
                }
                if (progressContainer) {
                    progressContainer.style.display = 'none';
                }
                if (cancelBtn) {
                    cancelBtn.style.display = 'none';
                }
                currentAbortController = null;
            }
        }

        function cancelGeneration() {
            if (currentAbortController) {
                currentAbortController.abort();
            }
        }

        function copyResult() {
            const resultDiv = document.getElementById('result-container');
            const content = resultDiv.innerText || resultDiv.textContent;

            navigator.clipboard.writeText(content).then(() => {
                showAlert('success', 'ê²°ê³¼ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }).catch(() => {
                showAlert('danger', 'ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            });
        }

        function displayAppliedGuidelines(rules, aiMode, contentLength, policyAuto, enhancementNotes = [], improvementSuggestions = []) {
            const guidelinesSummary = document.getElementById('guidelines-summary');
            const appliedGuidelinesContainer = document.getElementById('applied-guidelines-container');
            const configuredGuidelines = document.getElementById('configured-guidelines');
            const complianceScore = document.getElementById('guidelines-compliance-score');
            const complianceProgress = document.getElementById('compliance-progress');
            const compliancePercentage = document.getElementById('compliance-percentage');
            const guidelinesDetails = document.getElementById('guidelines-details');
            const appliedResults = document.getElementById('applied-results');

            let guidelines = [];
            let guidelineCount = 0;
            let totalGuidelines = 0;

            // ì„ íƒëœ ê·œì¹™ë“¤
            if (rules.length > 0) {
                totalGuidelines += rules.length;
                rules.forEach(rule => {
                    switch (rule) {
                        case 'AI_SEO':
                            guidelines.push('ğŸ¤– AI SEO: í‚¤ì›Œë“œ ìµœì í™”, êµ¬ì¡°í™”ëœ ë°ì´í„°');
                            break;
                        case 'AI_SEARCH':
                            guidelines.push('ğŸ” AI SEARCH: ê²€ìƒ‰ ì˜ë„ ë°˜ì˜, Featured Snippet');
                            break;
                        case 'AEO':
                            guidelines.push('ğŸ’¬ AEO: ì§ˆë¬¸ ë‹µë³€, FAQ í˜•ì‹');
                            break;
                        case 'GEO':
                            guidelines.push('ğŸŒ GEO: AI ì¸ìš©, ì‹ ë¢°ì„± ê°•í™”');
                            break;
                        case 'AIO':
                            guidelines.push('ğŸ”§ AIO: AI ë„êµ¬ í†µí•©, API ì¹œí™”ì ');
                            break;
                    }
                });
            }

            // AI ëª¨ë“œ
            if (aiMode) {
                totalGuidelines += 1;
                switch (aiMode) {
                    case 'ë‰´ìŠ¤':
                        guidelines.push('ğŸ“° ë‰´ìŠ¤ ìŠ¤íƒ€ì¼: ê°ê´€ì , ìµœì‹  ì •ë³´');
                        break;
                    case 'ë¦¬ë·°':
                        guidelines.push('â­ ë¦¬ë·° ìŠ¤íƒ€ì¼: ì¥ë‹¨ì , ê²½í—˜ ê³µìœ ');
                        break;
                    case 'ê°€ì´ë“œ':
                        guidelines.push('ğŸ“‹ ê°€ì´ë“œ ìŠ¤íƒ€ì¼: ë‹¨ê³„ë³„ ì„¤ëª…');
                        break;
                    case 'ìš”ì•½':
                        guidelines.push('ğŸ“ ìš”ì•½ ìŠ¤íƒ€ì¼: í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ');
                        break;
                    case 'ë¸”ë¡œê·¸':
                        guidelines.push('âœï¸ ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼: ê°œì¸ì  ì¸ì‚¬ì´íŠ¸');
                        break;
                    case 'enhanced':
                        guidelines.push('ğŸŒŸ í–¥ìƒëœ ëª¨ë“œ: AI ë¶„ì„ í¬í•¨');
                        break;
                    case 'enhanced_gemini':
                        guidelines.push('ğŸš€ í–¥ìƒëœ Gemini: ê³ ì„±ëŠ¥ AI ë¶„ì„');
                        break;
                }
            }

            // ì½˜í…ì¸  ê¸¸ì´
            if (contentLength) {
                totalGuidelines += 1;
                guidelines.push(`ğŸ“ ì½˜í…ì¸  ê¸¸ì´: ${contentLength}ì`);
            }

            // ì •ì±… ìë™ ì ìš©
            if (policyAuto) {
                totalGuidelines += 1;
                guidelines.push('âš–ï¸ ê· í˜• ì¡íŒ ê´€ì  ìë™ ì ìš©');
            }

            if (guidelines.length > 0) {
                appliedGuidelinesContainer.innerHTML = guidelines.map(g => `<span class="badge bg-light text-dark me-1 mb-1">${g}</span>`).join('');

                // ì„¤ì •ëœ ê°€ì´ë“œë¼ì¸ í‘œì‹œ
                let configuredContent = guidelines.map(g => `<div class="mb-1">â€¢ ${g}</div>`).join('');

                // ë³´ì™„ ì‚¬í•­ í‘œì‹œ
                if (enhancementNotes.length > 0) {
                    configuredContent += '<div class="mt-3"><h6 class="text-success mb-2"><i class="bi bi-plus-circle me-1"></i>ì ìš©ëœ ë³´ì™„ ì‚¬í•­</h6>';
                    configuredContent += enhancementNotes.map(note => `<div class="mb-1 text-success">âœ“ ${note}</div>`).join('');
                    configuredContent += '</div>';
                }

                configuredGuidelines.innerHTML = configuredContent;

                // ì¶”ê°€ ë³´ì™„ ì œì•ˆ í‘œì‹œ
                if (improvementSuggestions.length > 0) {
                    const suggestionsContainer = document.getElementById('improvement-suggestions');
                    if (suggestionsContainer) {
                        let suggestionsContent = '<div class="mt-3"><h6 class="text-warning mb-2"><i class="bi bi-lightbulb me-1"></i>ì¶”ê°€ ë³´ì™„ ì œì•ˆ</h6>';
                        improvementSuggestions.forEach(suggestion => {
                            const priorityClass = suggestion.priority === 'high' ? 'text-danger' :
                                suggestion.priority === 'medium' ? 'text-warning' : 'text-info';
                            const priorityIcon = suggestion.priority === 'high' ? 'bi-exclamation-triangle' :
                                suggestion.priority === 'medium' ? 'bi-exclamation-circle' : 'bi-info-circle';
                            suggestionsContent += `
                                <div class="suggestion-item mb-2 p-2 rounded" style="background: rgba(245, 158, 11, 0.1); border-left: 3px solid #f59e0b;">
                                    <div class="d-flex align-items-start">
                                        <i class="bi ${priorityIcon} ${priorityClass} me-2 mt-1"></i>
                                        <div>
                                            <div class="fw-medium">${suggestion.title}</div>
                                            <small class="text-muted">${suggestion.description}</small>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        suggestionsContent += '</div>';
                        suggestionsContainer.innerHTML = suggestionsContent;
                        suggestionsContainer.style.display = 'block';
                    }
                }

                // ì¤€ìˆ˜ë„ ê³„ì‚° (ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •, ì‹¤ì œ ë¶„ì„ì€ ë³„ë„ í•¨ìˆ˜ì—ì„œ ì²˜ë¦¬)
                const complianceRate = 0; // ì´ˆê¸°ê°’, ì‹¤ì œ ì½˜í…ì¸  ë¶„ì„ í›„ ì—…ë°ì´íŠ¸ë¨
                complianceScore.textContent = `ì¤€ìˆ˜ë„: ${complianceRate}%`;
                complianceProgress.style.width = `${complianceRate}%`;
                compliancePercentage.textContent = `${complianceRate}%`;

                guidelinesSummary.style.display = 'block';
            } else {
                guidelinesSummary.style.display = 'none';
            }
        }

        function analyzeContentGuidelines(content) {
            console.log('=== analyzeContentGuidelines ì‹œì‘ ===');
            console.log('ì…ë ¥ ì½˜í…ì¸  íƒ€ì…:', typeof content);
            console.log('ì…ë ¥ ì½˜í…ì¸  ê¸¸ì´:', content ? content.length : 'undefined');
            console.log('ì…ë ¥ ì½˜í…ì¸  ì‹œì‘:', content ? content.substring(0, 100) : 'undefined');

            const analysis = {
                hasStructuredData: false,
                hasFAQ: false,
                hasKeywords: false,
                hasHeadings: false,
                hasLinks: false,
                hasImages: false,
                hasPolicyBalance: false,
                contentLength: 0,
                aiSeoCompliance: false,
                geoCompliance: false,
                policyBalanceCompliance: false
            };

            // ì½˜í…ì¸  ìœ íš¨ì„± ê²€ì‚¬
            if (!content || typeof content !== 'string' || content.trim().length === 0) {
                console.error('ìœ íš¨í•˜ì§€ ì•Šì€ ì½˜í…ì¸ :', content);
                analysis.contentLength = 0;
                return analysis;
            }

            // HTML ë¸”ë¡ì—ì„œ ì‹¤ì œ ì½˜í…ì¸  ì¶”ì¶œ
            let processedContent = content;
            const htmlBlockMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (htmlBlockMatch) {
                processedContent = htmlBlockMatch[1];
                console.log('HTML ë¸”ë¡ì—ì„œ ì½˜í…ì¸  ì¶”ì¶œë¨, ê¸¸ì´:', processedContent.length);
            }

            // ì½˜í…ì¸  ê¸¸ì´ í™•ì¸ (HTML íƒœê·¸ ì œê±° í›„)
            const analysisCleanContent = processedContent.replace(/<[^>]*>/g, '').replace(/\s+/g, ' ').trim();
            analysis.contentLength = analysisCleanContent.length;
            console.log('ì •ì œëœ ì½˜í…ì¸  ê¸¸ì´:', analysis.contentLength);

            // êµ¬ì¡°í™”ëœ ë°ì´í„° í™•ì¸
            if (content.includes('itemscope') || content.includes('schema.org') || content.includes('ld+json')) {
                analysis.hasStructuredData = true;
            }

            // FAQ í™•ì¸ (ë” ì •í™•í•œ íŒ¨í„´)
            if (content.includes('FAQ') || content.includes('ìì£¼ ë¬»ëŠ” ì§ˆë¬¸') || content.includes('Q&A') ||
                content.includes('ì§ˆë¬¸') || content.includes('ë‹µë³€') || content.includes('faq')) {
                analysis.hasFAQ = true;
            }

            // í‚¤ì›Œë“œ í™•ì¸ (H1, H2, H3 íƒœê·¸ì—ì„œ)
            if (content.includes('<h1') || content.includes('<h2') || content.includes('<h3')) {
                analysis.hasKeywords = true;
            }

            // í—¤ë”© êµ¬ì¡° í™•ì¸ (ê³„ì¸µì  êµ¬ì¡°)
            if (content.includes('<h1') && content.includes('<h2')) {
                analysis.hasHeadings = true;
            }

            // ë§í¬ í™•ì¸
            if (content.includes('<a href') || content.includes('http') || content.includes('https')) {
                analysis.hasLinks = true;
            }

            // ì´ë¯¸ì§€ í™•ì¸
            if (content.includes('<img') || content.includes('alt=') || content.includes('src=')) {
                analysis.hasImages = true;
            }

            // ì •ì±… ê· í˜• í™•ì¸ (ë” í¬ê´„ì ì¸ í‚¤ì›Œë“œ)
            const balanceKeywords = ['ì¥ë‹¨ì ', 'ê³ ë ¤ì‚¬í•­', 'ì£¼ì˜ì‚¬í•­', 'ì¥ì ', 'ë‹¨ì ', 'ì´ì ', 'í•œê³„',
                'ì£¼ì˜', 'ê²½ê³ ', 'ë¦¬ìŠ¤í¬', 'ìœ„í—˜', 'ì¥ì• ', 'ë¬¸ì œ', 'í•´ê²°ì±…', 'ëŒ€ì•ˆ'];
            if (balanceKeywords.some(keyword => content.includes(keyword))) {
                analysis.hasPolicyBalance = true;
                analysis.policyBalanceCompliance = true;
            }

            // AI SEO ì¤€ìˆ˜ë„ í™•ì¸ (ê¸¸ì´ + êµ¬ì¡°)
            if (analysis.contentLength >= 1500 && analysis.hasHeadings && analysis.hasKeywords) {
                analysis.aiSeoCompliance = true;
            }

            // GEO ì¤€ìˆ˜ë„ í™•ì¸ (ìƒì„±í˜• AI ì—”ì§„ ìµœì í™”)
            const geoKeywords = [
                'ìƒì„±í˜•', 'ai', 'chatgpt', 'claude', 'gemini', 'ai ì˜¤ë²„ë·°', 'featured snippet',
                'êµ¬ì¡°í™”', 'schema', 'faq', 'how-to', 'ì •ì˜', 'ë¹„êµ', 'ë‹¨ê³„ë³„', 'ê°€ì´ë“œ',
                'ì¶œì²˜', 'ì¸ìš©', 'í†µê³„', 'ì—°êµ¬', 'ì „ë¬¸ê°€', 'ê¶Œìœ„', 'ì‹ ë¢°ì„±'
            ];
            const geoPatterns = ['<h1>', '<h2>', '<h3>', '<ul>', '<ol>', '<table>', '<details>', '<summary>'];
            const hasGeoKeywords = geoKeywords.some(keyword => content.toLowerCase().includes(keyword));
            const hasGeoStructure = geoPatterns.some(pattern => content.includes(pattern));
            const hasAuthoritativeLanguage = ['ì—°êµ¬ì— ë”°ë¥´ë©´', 'ì „ë¬¸ê°€ë“¤ì€', 'ì—°êµ¬ ê²°ê³¼', 'í†µê³„ì— ë”°ë¥´ë©´'].some(phrase => content.includes(phrase));

            if (hasGeoKeywords || hasGeoStructure || hasAuthoritativeLanguage) {
                analysis.geoCompliance = true;
            }

            console.log('ë¶„ì„ ê²°ê³¼:', analysis);
            return analysis;
        }

        function displayGuidelinesAnalysis(analysis) {
            console.log('=== displayGuidelinesAnalysis ì‹œì‘ ===');
            console.log('ë¶„ì„ ë°ì´í„°:', analysis);

            const guidelinesSummary = document.getElementById('guidelines-summary');
            const appliedGuidelinesContainer = document.getElementById('applied-guidelines-container');
            const appliedResults = document.getElementById('applied-results');
            const complianceProgress = document.getElementById('compliance-progress');
            const compliancePercentage = document.getElementById('compliance-percentage');
            const complianceScore = document.getElementById('guidelines-compliance-score');
            const guidelinesDetails = document.getElementById('guidelines-details');

            let analysisResults = [];
            let complianceCount = 0;
            let totalChecks = 0;

            // ì½˜í…ì¸  ê¸¸ì´ í™•ì¸ (ê°€ì¥ ì¤‘ìš”)
            totalChecks++;
            console.log('ê°€ì´ë“œë¼ì¸ ë¶„ì„ - ì½˜í…ì¸  ê¸¸ì´:', analysis.contentLength);
            if (analysis.contentLength >= 1500) {
                analysisResults.push(`<span class="badge bg-success me-1 mb-1">âœ… ê¸¸ì´ ì¤€ìˆ˜ (${analysis.contentLength}ì)</span>`);
                complianceCount++;
            } else if (analysis.contentLength > 0) {
                analysisResults.push(`<span class="badge bg-warning me-1 mb-1">âš ï¸ ê¸¸ì´ ë¶€ë¶„ ì¤€ìˆ˜ (${analysis.contentLength}ì)</span>`);
            } else {
                analysisResults.push(`<span class="badge bg-danger me-1 mb-1">âŒ ê¸¸ì´ ë¯¸ì¤€ìˆ˜ (${analysis.contentLength}ì)</span>`);
            }

            // AI SEO ì¤€ìˆ˜ë„ í™•ì¸
            totalChecks++;
            if (analysis.aiSeoCompliance) {
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… AI SEO ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ AI SEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
            }

            // GEO ì¤€ìˆ˜ë„ í™•ì¸
            totalChecks++;
            if (analysis.geoCompliance) {
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… GEO ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ GEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
            }

            // ì •ì±… ê· í˜• í™•ì¸
            totalChecks++;
            if (analysis.policyBalanceCompliance) {
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ì •ì±… ê· í˜• ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                analysisResults.push('<span class="badge bg-danger me-1 mb-1">âŒ ì •ì±… ê· í˜• ë¯¸ì¤€ìˆ˜</span>');
            }

            // ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ í™•ì¸
            totalChecks++;
            if (analysis.hasHeadings && analysis.hasKeywords) {
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ë¶€ë¶„ ì¤€ìˆ˜</span>');
            }

            // ì¤€ìˆ˜ë„ ê³„ì‚°
            const complianceRate = totalChecks > 0 ? Math.round((complianceCount / totalChecks) * 100) : 0;

            if (analysisResults.length > 0) {
                // ì¤‘ë³µ ì œê±°: appliedGuidelinesContainerëŠ” ì œê±°í•˜ê³  appliedResultsë§Œ ì‚¬ìš©
                appliedResults.innerHTML = analysisResults.map(result => {
                    // HTML íƒœê·¸ ì œê±°í•˜ë˜ ì´ëª¨ì§€ ì•„ì´ì½˜ì€ ìœ ì§€
                    const text = result.replace(/<[^>]*>/g, '');
                    // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ë¶„ë¦¬í•˜ì—¬ ì¤‘ë³µ ì œê±° (ë” ì •í™•í•œ íŒ¨í„´)
                    const iconMatch = text.match(/^([^\s]+)\s*(.+)$/);
                    if (iconMatch) {
                        const icon = iconMatch[1];
                        const content = iconMatch[2];
                        return `<div class="result-item result-${getResultStatus(content)}">
                            <span class="result-icon">${icon}</span>
                            <span class="result-text">${content}</span>
                        </div>`;
                    }
                    return `<div class="result-item result-neutral">
                        <span class="result-icon">â€¢</span>
                        <span class="result-text">${text}</span>
                    </div>`;
                }).join('');

                // ì¤€ìˆ˜ë„ í‘œì‹œ
                complianceScore.textContent = `ì¤€ìˆ˜ë„: ${complianceRate}%`;
                complianceProgress.style.width = `${complianceRate}%`;
                compliancePercentage.textContent = `${complianceRate}%`;

                // ì¤€ìˆ˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (complianceRate >= 80) {
                    complianceScore.className = 'badge compliance-score bg-success me-2';
                    complianceProgress.className = 'progress-bar bg-success';
                } else if (complianceRate >= 60) {
                    complianceScore.className = 'badge compliance-score bg-warning me-2';
                    complianceProgress.className = 'progress-bar bg-warning';
                } else {
                    complianceScore.className = 'badge compliance-score bg-danger me-2';
                    complianceProgress.className = 'progress-bar bg-danger';
                }

                guidelinesDetails.classList.remove('show');
                guidelinesSummary.style.display = 'block';
            } else {
                appliedGuidelinesContainer.innerHTML = '-';
                appliedResults.innerHTML = '<div class="text-muted">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                guidelinesDetails.classList.add('show');
            }
        }

        function displayBackendGuidelinesAnalysis(analysis) {
            console.log('=== displayBackendGuidelinesAnalysis ì‹œì‘ ===');
            console.log('ë°±ì—”ë“œ ë¶„ì„ ë°ì´í„°:', analysis);

            const guidelinesSummary = document.getElementById('guidelines-summary');
            const appliedGuidelinesContainer = document.getElementById('applied-guidelines-container');
            const appliedResults = document.getElementById('applied-results');
            const complianceProgress = document.getElementById('compliance-progress');
            const compliancePercentage = document.getElementById('compliance-percentage');
            const complianceScore = document.getElementById('guidelines-compliance-score');
            const guidelinesDetails = document.getElementById('guidelines-details');

            let analysisResults = [];
            let complianceCount = 0;
            let totalChecks = 0;

            // ì½˜í…ì¸  ê¸¸ì´ í™•ì¸ (ë°±ì—”ë“œ ë°ì´í„° ì‚¬ìš©)
            totalChecks++;
            const contentLength = analysis.content_length || 0;
            console.log('ë°±ì—”ë“œ ì½˜í…ì¸  ê¸¸ì´:', contentLength);

            if (analysis.length_compliant) {
                analysisResults.push(`<span class="badge bg-success me-1 mb-1">âœ… ê¸¸ì´ ì¤€ìˆ˜ (${contentLength}ì)</span>`);
                complianceCount++;
            } else if (contentLength > 0) {
                analysisResults.push(`<span class="badge bg-warning me-1 mb-1">âš ï¸ ê¸¸ì´ ë¶€ë¶„ ì¤€ìˆ˜ (${contentLength}ì)</span>`);
            } else {
                analysisResults.push(`<span class="badge bg-danger me-1 mb-1">âŒ ê¸¸ì´ ë¯¸ì¤€ìˆ˜ (${contentLength}ì)</span>`);
            }

            // AI SEO ë¶„ì„
            if (analysis.ai_seo_compliant) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… AI SEO ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ AI SEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
            }

            if (analysis.structured_data) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… êµ¬ì¡°í™”ëœ ë°ì´í„°</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ êµ¬ì¡°í™”ëœ ë°ì´í„° ì—†ìŒ</span>');
            }
            if (analysis.keywords_optimized) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… í‚¤ì›Œë“œ ìµœì í™”</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ í‚¤ì›Œë“œ ìµœì í™” ì—†ìŒ</span>');
            }
            if (analysis.headings_structure) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… í—¤ë”© êµ¬ì¡°</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ í—¤ë”© êµ¬ì¡° ì—†ìŒ</span>');
            }
            if (analysis.links_included) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ë§í¬ í¬í•¨</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ ë§í¬ ì—†ìŒ</span>');
            }
            if (analysis.images_optimized) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ì´ë¯¸ì§€ ìµœì í™”</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ ì´ë¯¸ì§€ ìµœì í™” ì—†ìŒ</span>');
            }

            // AEO ë¶„ì„
            if (analysis.aeo_applied) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-info me-1 mb-1">ğŸ’¬ AEO ì ìš©</span>');
                complianceCount++;
            }
            if (analysis.faq_included) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… FAQ í¬í•¨</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ FAQ ì—†ìŒ</span>');
            }

            // GEO ë¶„ì„
            if (analysis.geo_compliant) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… GEO ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ GEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
            }

            // ì •ì±… ê· í˜• ë¶„ì„
            if (analysis.policy_balance_compliant) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ì •ì±… ê· í˜• ì¤€ìˆ˜</span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-danger me-1 mb-1">âŒ ì •ì±… ê· í˜• ë¯¸ì¤€ìˆ˜</span>');
            }

            // AIO ë¶„ì„
            if (analysis.aio_applied) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-secondary me-1 mb-1">ğŸ”§ AIO ì ìš©</span>');
                complianceCount++;
            }

            // ì •ì±… ë¶„ì„
            if (analysis.policy_applied) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-dark me-1 mb-1">âš–ï¸ ì •ì±… ì ìš©</span>');
                complianceCount++;
            }
            if (analysis.balance_perspective) {
                totalChecks++;
                analysisResults.push('<span class="badge bg-success me-1 mb-1">âœ… ê· í˜• ì¡íŒ ê´€ì </span>');
                complianceCount++;
            } else {
                totalChecks++;
                analysisResults.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ ê· í˜• ì¡íŒ ê´€ì  ì—†ìŒ</span>');
            }

            // ì¤€ìˆ˜ë„ ê³„ì‚°
            const complianceRate = totalChecks > 0 ? Math.round((complianceCount / totalChecks) * 100) : 0;

            if (analysisResults.length > 0) {
                // ì¤‘ë³µ ì œê±°: appliedGuidelinesContainerëŠ” ì œê±°í•˜ê³  appliedResultsë§Œ ì‚¬ìš©
                appliedResults.innerHTML = analysisResults.map(result => {
                    // HTML íƒœê·¸ ì œê±°í•˜ë˜ ì´ëª¨ì§€ ì•„ì´ì½˜ì€ ìœ ì§€
                    const text = result.replace(/<[^>]*>/g, '');
                    // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ ë¶„ë¦¬í•˜ì—¬ ì¤‘ë³µ ì œê±° (ë” ì •í™•í•œ íŒ¨í„´)
                    const iconMatch = text.match(/^([^\s]+)\s*(.+)$/);
                    if (iconMatch) {
                        const icon = iconMatch[1];
                        const content = iconMatch[2];
                        return `<div class="result-item result-${getResultStatus(content)}">
                            <span class="result-icon">${icon}</span>
                            <span class="result-text">${content}</span>
                        </div>`;
                    }
                    return `<div class="result-item result-neutral">
                        <span class="result-icon">â€¢</span>
                        <span class="result-text">${text}</span>
                    </div>`;
                }).join('');

                // ì¤€ìˆ˜ë„ í‘œì‹œ
                complianceScore.textContent = `ì¤€ìˆ˜ë„: ${complianceRate}%`;
                complianceProgress.style.width = `${complianceRate}%`;
                compliancePercentage.textContent = `${complianceRate}%`;

                // ì¤€ìˆ˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (complianceRate >= 80) {
                    complianceScore.className = 'badge compliance-score bg-success me-2';
                    complianceProgress.className = 'progress-bar bg-success';
                } else if (complianceRate >= 60) {
                    complianceScore.className = 'badge compliance-score bg-warning me-2';
                    complianceProgress.className = 'progress-bar bg-warning';
                } else {
                    complianceScore.className = 'badge compliance-score bg-danger me-2';
                    complianceProgress.className = 'progress-bar bg-danger';
                }

                guidelinesDetails.classList.remove('show');
                guidelinesSummary.style.display = 'block';
            } else {
                appliedGuidelinesContainer.innerHTML = '-';
                appliedResults.innerHTML = '<div class="text-muted">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                guidelinesDetails.classList.add('show');
            }
        }

        function downloadResult() {
            const resultDiv = document.getElementById('result-container');
            const content = resultDiv.innerText || resultDiv.textContent;
            const keywords = document.getElementById('keywords-container').textContent;

            const data = {
                title: 'AI SEO Blog Post',
                keywords: keywords,
                content: content,
                generated_at: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `blog-post-${Date.now()}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            showAlert('success', 'ê²°ê³¼ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
        }

        function showAlert(type, message) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(alertDiv);

            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function toggleGuidelinesDetails() {
            const guidelinesDetails = document.getElementById('guidelines-details');
            guidelinesDetails.classList.toggle('show');
        }

        // AI ë¶„ì„ ë„ì›€ë§ í‘œì‹œ í•¨ìˆ˜
        function showAnalysisHelp(type) {
            const modal = new bootstrap.Modal(document.getElementById('analysisHelpModal'));
            const modalTitle = document.getElementById('analysisHelpModalLabel');
            const modalBody = document.getElementById('analysis-help-content');

            if (type === 'trust') {
                modalTitle.innerHTML = '<i class="bi bi-shield-check text-success me-2"></i>ì‹ ë¢°ë„ í‰ê°€ ê·¼ê±° ìë£Œ';
                modalBody.innerHTML = generateTrustAnalysisHelp();
            } else if (type === 'seo') {
                modalTitle.innerHTML = '<i class="bi bi-search text-warning me-2"></i>SEO ìµœì í™” ì ìˆ˜ ê·¼ê±° ìë£Œ';
                modalBody.innerHTML = generateSEOAnalysisHelp();
            }

            modal.show();
        }

        // ì‹ ë¢°ë„ í‰ê°€ ë„ì›€ë§ ìƒì„±
        function generateTrustAnalysisHelp() {
            const trustScore = document.getElementById('trust-score-container')?.textContent || '-';
            const trustReason = document.getElementById('trust-reason-container')?.textContent || '-';

            return `
                <div class="analysis-help-content">
                    <div class="current-score-section mb-4">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-info-circle me-2"></i>í˜„ì¬ í‰ê°€ ê²°ê³¼
                        </h6>
                        <div class="score-display">
                            <div class="current-score">${trustScore}</div>
                            <div class="score-reason">${trustReason}</div>
                        </div>
                    </div>
                    
                    <div class="evaluation-criteria mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-list-check me-2"></i>ì‹ ë¢°ë„ í‰ê°€ ê¸°ì¤€
                        </h6>
                        <div class="criteria-list">
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">5ì </span>
                                    <span class="criteria-title">ë§¤ìš° ë†’ì€ ì‹ ë¢°ë„</span>
                                </div>
                                <div class="criteria-desc">
                                    ì „ë¬¸ê°€ ì¸ìš©, ê³µì‹ í†µê³„, í•™ìˆ  ìë£Œ, ìµœì‹  ì •ë³´(1ë…„ ì´ë‚´), ìƒì„¸í•œ ì„¤ëª…(1000ì ì´ìƒ)
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">4ì </span>
                                    <span class="criteria-title">ë†’ì€ ì‹ ë¢°ë„</span>
                                </div>
                                <div class="criteria-desc">
                                    ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜, ê°ê´€ì  ì‚¬ì‹¤, ìƒì„¸í•œ ì„¤ëª…(500ì ì´ìƒ), ìµœì‹  ì •ë³´(3ë…„ ì´ë‚´)
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">3ì </span>
                                    <span class="criteria-title">ë³´í†µ ì‹ ë¢°ë„</span>
                                </div>
                                <div class="criteria-desc">
                                    ê¸°ë³¸ì ì¸ ì •ë³´ ì œê³µ, ì¼ë°˜ì ì¸ ì§€ì‹, ì¤‘ê°„ ê¸¸ì´ ì„¤ëª…(200-500ì)
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">2ì </span>
                                    <span class="criteria-title">ë‚®ì€ ì‹ ë¢°ë„</span>
                                </div>
                                <div class="criteria-desc">
                                    ê°„ë‹¨í•œ ì„¤ëª…, ì¶œì²˜ ë¶ˆëª…í™•, ì£¼ê´€ì  ì˜ê²¬, ì§§ì€ ë‚´ìš©(200ì ë¯¸ë§Œ)
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">1ì </span>
                                    <span class="criteria-title">ë§¤ìš° ë‚®ì€ ì‹ ë¢°ë„</span>
                                </div>
                                <div class="criteria-desc">
                                    ì¶œì²˜ ì—†ìŒ, ì£¼ê´€ì  ì˜ê²¬, ë¶€ì •í™•í•œ ì •ë³´, ë§¤ìš° ì§§ì€ ë‚´ìš©
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="improvement-tips">
                        <h6 class="text-info mb-3">
                            <i class="bi bi-lightbulb me-2"></i>ì‹ ë¢°ë„ í–¥ìƒ íŒ
                        </h6>
                        <ul class="tips-list">
                            <li>ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì„¸ìš”</li>
                            <li>ìµœì‹  í†µê³„ë‚˜ ë°ì´í„°ë¥¼ í¬í•¨í•˜ì„¸ìš”</li>
                            <li>ì „ë¬¸ê°€ ì¸ìš©ì´ë‚˜ í•™ìˆ  ìë£Œë¥¼ í™œìš©í•˜ì„¸ìš”</li>
                            <li>ê°ê´€ì ì´ê³  ì‚¬ì‹¤ ì¤‘ì‹¬ì˜ ë‚´ìš©ì„ ì‘ì„±í•˜ì„¸ìš”</li>
                            <li>ìƒì„¸í•˜ê³  êµ¬ì²´ì ì¸ ì„¤ëª…ì„ ì œê³µí•˜ì„¸ìš”</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // SEO ìµœì í™” ì ìˆ˜ ë„ì›€ë§ ìƒì„±
        function generateSEOAnalysisHelp() {
            const seoScore = document.getElementById('seo-score-container')?.textContent || '-';
            const seoReason = document.getElementById('seo-reason-container')?.textContent || '-';

            return `
                <div class="analysis-help-content">
                    <div class="current-score-section mb-4">
                        <h6 class="text-warning mb-3">
                            <i class="bi bi-info-circle me-2"></i>í˜„ì¬ í‰ê°€ ê²°ê³¼
                        </h6>
                        <div class="score-display">
                            <div class="current-score">${seoScore}</div>
                            <div class="score-reason">${seoReason}</div>
                        </div>
                    </div>
                    
                    <div class="evaluation-criteria mb-4">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-list-check me-2"></i>SEO ìµœì í™” í‰ê°€ ê¸°ì¤€
                        </h6>
                        <div class="criteria-list">
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">9-10ì </span>
                                    <span class="criteria-title">ë§¤ìš° ë†’ì€ ìµœì í™”</span>
                                </div>
                                <div class="criteria-desc">
                                    í‚¤ì›Œë“œ ìµœì í™”, êµ¬ì¡°í™”ëœ ë°ì´í„°, í—¤ë”© êµ¬ì¡°, ë§í¬ í¬í•¨, ì´ë¯¸ì§€ ìµœì í™”, ë©”íƒ€ ì„¤ëª…
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">7-8ì </span>
                                    <span class="criteria-title">ë†’ì€ ìµœì í™”</span>
                                </div>
                                <div class="criteria-desc">
                                    í‚¤ì›Œë“œ í¬í•¨, ê¸°ë³¸ í—¤ë”© êµ¬ì¡°, ì ì ˆí•œ ê¸¸ì´, ì½ê¸° ì‰¬ìš´ êµ¬ì¡°
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">5-6ì </span>
                                    <span class="criteria-title">ë³´í†µ ìµœì í™”</span>
                                </div>
                                <div class="criteria-desc">
                                    ê¸°ë³¸ì ì¸ SEO ìš”ì†Œ í¬í•¨, ì¤‘ê°„ ê¸¸ì´ ì½˜í…ì¸ , ê¸°ë³¸ êµ¬ì¡°
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">3-4ì </span>
                                    <span class="criteria-title">ë‚®ì€ ìµœì í™”</span>
                                </div>
                                <div class="criteria-desc">
                                    SEO ìš”ì†Œ ë¶€ì¡±, ì§§ì€ ì½˜í…ì¸ , êµ¬ì¡° ë¶€ì¡±
                                </div>
                            </div>
                            <div class="criteria-item">
                                <div class="criteria-header">
                                    <span class="criteria-score">1-2ì </span>
                                    <span class="criteria-title">ë§¤ìš° ë‚®ì€ ìµœì í™”</span>
                                </div>
                                <div class="criteria-desc">
                                    SEO ìš”ì†Œ ì—†ìŒ, ë§¤ìš° ì§§ì€ ì½˜í…ì¸ , êµ¬ì¡° ì—†ìŒ
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="seo-factors mb-4">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-gear me-2"></i>SEO í‰ê°€ ìš”ì†Œ
                        </h6>
                        <div class="factors-grid">
                            <div class="factor-item">
                                <i class="bi bi-tags text-primary"></i>
                                <span>í‚¤ì›Œë“œ ìµœì í™” (2ì )</span>
                            </div>
                            <div class="factor-item">
                                <i class="bi bi-diagram-3 text-success"></i>
                                <span>êµ¬ì¡°í™”ëœ ë°ì´í„° (2ì )</span>
                            </div>
                            <div class="factor-item">
                                <i class="bi bi-list-nested text-warning"></i>
                                <span>í—¤ë”© êµ¬ì¡° (2ì )</span>
                            </div>
                            <div class="factor-item">
                                <i class="bi bi-link-45deg text-info"></i>
                                <span>ë§í¬ í¬í•¨ (1ì )</span>
                            </div>
                            <div class="factor-item">
                                <i class="bi bi-image text-danger"></i>
                                <span>ì´ë¯¸ì§€ ìµœì í™” (1ì )</span>
                            </div>
                            <div class="factor-item">
                                <i class="bi bi-file-text text-secondary"></i>
                                <span>ì½˜í…ì¸  ê¸¸ì´ (2ì )</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="improvement-tips">
                        <h6 class="text-info mb-3">
                            <i class="bi bi-lightbulb me-2"></i>SEO ìµœì í™” íŒ
                        </h6>
                        <ul class="tips-list">
                            <li>ì£¼ìš” í‚¤ì›Œë“œë¥¼ ì œëª©ê³¼ ë³¸ë¬¸ì— ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨í•˜ì„¸ìš”</li>
                            <li>H1, H2, H3 í—¤ë”© íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ êµ¬ì¡°ë¥¼ ë§Œë“œì„¸ìš”</li>
                            <li>ê´€ë ¨ ë§í¬ì™€ ì´ë¯¸ì§€ë¥¼ í¬í•¨í•˜ì„¸ìš”</li>
                            <li>ì¶©ë¶„í•œ ê¸¸ì´ì˜ ì½˜í…ì¸ ë¥¼ ì‘ì„±í•˜ì„¸ìš” (ìµœì†Œ 500ì)</li>
                            <li>ë©”íƒ€ ì„¤ëª…ê³¼ ì œëª©ì„ ìµœì í™”í•˜ì„¸ìš”</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì¤€ìˆ˜ë„ ë¶„ì„ ê²°ê³¼ ì €ì¥
        let currentComplianceAnalysis = null;

        // ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬
        window.addEventListener('error', function (event) {
            if (event.error && event.error.message &&
                event.error.message.includes('message channel closed')) {
                console.warn('ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ê³¼ì˜ ì¶©ëŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¬´ì‹œí•©ë‹ˆë‹¤.');
                event.preventDefault();
                return false;
            }
        });

        // Promise rejection í•¸ë“¤ëŸ¬
        window.addEventListener('unhandledrejection', function (event) {
            if (event.reason && event.reason.message &&
                event.reason.message.includes('message channel closed')) {
                console.warn('ë¹„ë™ê¸° ì‘ì—… ì¤‘ ë¸Œë¼ìš°ì € í™•ì¥ í”„ë¡œê·¸ë¨ ì¶©ëŒì´ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                event.preventDefault();
                return false;
            }
        });

        // ì…ë ¥ í…ìŠ¤íŠ¸ ë³´ì™„ í•¨ìˆ˜
        function enhanceInputText(originalText, rules, aiMode) {
            let enhancedText = originalText;
            let enhancementNotes = [];

            // SEO ìµœì í™” ì˜µì…˜ì— ë”°ë¥¸ ë³´ì™„
            if (rules.includes('AI_SEO')) {
                enhancedText += '\n\n[SEO ìµœì í™” ìš”êµ¬ì‚¬í•­]\n- ì£¼ìš” í‚¤ì›Œë“œë¥¼ ì œëª©ê³¼ ë³¸ë¬¸ì— ìì—°ìŠ¤ëŸ½ê²Œ í¬í•¨\n- H1, H2, H3 í—¤ë”© êµ¬ì¡°ë¡œ ì½˜í…ì¸  êµ¬ì„±\n- ë©”íƒ€ ì„¤ëª…ê³¼ ì œëª© ìµœì í™”\n- ê´€ë ¨ ë§í¬ì™€ ì´ë¯¸ì§€ í¬í•¨';
                enhancementNotes.push('AI SEO: í‚¤ì›Œë“œ ìµœì í™” ë° êµ¬ì¡°í™”ëœ ë°ì´í„° ì ìš©');
            }

            if (rules.includes('AI_SEARCH')) {
                enhancedText += '\n\n[ê²€ìƒ‰ ì˜ë„ ìµœì í™”]\n- ì‚¬ìš©ì ê²€ìƒ‰ ì˜ë„ì— ë§ëŠ” ë‹µë³€ ì œê³µ\n- Featured Snippetì„ ìœ„í•œ ê°„ê²°í•˜ê³  ëª…í™•í•œ ì„¤ëª…\n- ì§ˆë¬¸-ë‹µë³€ í˜•ì‹ì˜ ì½˜í…ì¸  êµ¬ì¡°';
                enhancementNotes.push('AI SEARCH: ê²€ìƒ‰ ì˜ë„ ë°˜ì˜ ë° Featured Snippet ìµœì í™”');
            }

            // AI ìµœì í™” ì˜µì…˜ì— ë”°ë¥¸ ë³´ì™„
            if (rules.includes('AEO')) {
                enhancedText += '\n\n[AEO ìµœì í™”]\n- ì‚¬ìš©ìê°€ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ì ì¸ ë‹µë³€\n- FAQ ì„¹ì…˜ í¬í•¨\n- ëª…í™•í•˜ê³  ì´í•´í•˜ê¸° ì‰¬ìš´ ì„¤ëª…';
                enhancementNotes.push('AEO: ì‚¬ìš©ì ì§ˆë¬¸ ì§ì ‘ ë‹µë³€ ë° FAQ í¬í•¨');
            }

            if (rules.includes('GEO')) {
                enhancedText += '\n\n[GEO ìµœì í™”]\n- AIê°€ ì¸ìš©í•  ìˆ˜ ìˆëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´\n- ì „ë¬¸ê°€ ì¸ìš© ë° ì¶œì²˜ ëª…ì‹œ\n- ê°ê´€ì ì´ê³  ì‚¬ì‹¤ ì¤‘ì‹¬ì˜ ë‚´ìš©';
                enhancementNotes.push('GEO: AI ì¸ìš© ê°€ëŠ¥í•œ ë‹µë³€ ë° ì „ë¬¸ê°€ ì¸ìš©');
            }

            if (rules.includes('AIO')) {
                enhancedText += '\n\n[AIO ìµœì í™”]\n- AI ë„êµ¬ì™€ì˜ í†µí•©ì„ ìœ„í•œ êµ¬ì¡°í™”ëœ ë°ì´í„°\n- API ì¹œí™”ì ì¸ ì½˜í…ì¸  êµ¬ì¡°\n- ê¸°ê³„ê°€ ì½ê¸° ì‰¬ìš´ í˜•ì‹';
                enhancementNotes.push('AIO: AI ë„êµ¬ í†µí•© ë° API ì¹œí™”ì  êµ¬ì¡°');
            }

            // ìŠ¤íƒ€ì¼ë³„ ì¶”ê°€ ë³´ì™„
            switch (aiMode) {
                case 'ë‰´ìŠ¤':
                    enhancedText += '\n\n[ë‰´ìŠ¤ ìŠ¤íƒ€ì¼]\n- ìµœì‹  ì •ë³´ì™€ ê°ê´€ì  ì‚¬ì‹¤ ì¤‘ì‹¬\n- 5W1H ìš”ì†Œ í¬í•¨\n- ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ ëª…ì‹œ';
                    enhancementNotes.push('ë‰´ìŠ¤ ìŠ¤íƒ€ì¼: ìµœì‹  ì •ë³´ì™€ ê°ê´€ì  ì‚¬ì‹¤ ì¤‘ì‹¬');
                    break;
                case 'ë¦¬ë·°':
                    enhancedText += '\n\n[ë¦¬ë·° ìŠ¤íƒ€ì¼]\n- ì¥ë‹¨ì  ëª…í™•íˆ ë¶„ì„\n- ê°œì¸ì  ê²½í—˜ê³¼ ì¸ì‚¬ì´íŠ¸ í¬í•¨\n- êµ¬ì²´ì ì¸ ì˜ˆì‹œì™€ ê·¼ê±° ì œê³µ';
                    enhancementNotes.push('ë¦¬ë·° ìŠ¤íƒ€ì¼: ì¥ë‹¨ì  ë¶„ì„ê³¼ ê°œì¸ì  ê²½í—˜');
                    break;
                case 'ê°€ì´ë“œ':
                    enhancedText += '\n\n[ê°€ì´ë“œ ìŠ¤íƒ€ì¼]\n- ë‹¨ê³„ë³„ ìƒì„¸í•œ ì„¤ëª…\n- ì‹¤ìš©ì ì¸ íŒê³¼ ì£¼ì˜ì‚¬í•­\n- ì´ˆë³´ìë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ì„¤ëª…';
                    enhancementNotes.push('ê°€ì´ë“œ ìŠ¤íƒ€ì¼: ë‹¨ê³„ë³„ ì„¤ëª…ê³¼ ì‹¤ìš©ì  ì •ë³´');
                    break;
                case 'ìš”ì•½':
                    enhancedText += '\n\n[ìš”ì•½ ìŠ¤íƒ€ì¼]\n- í•µì‹¬ ë‚´ìš©ë§Œ ê°„ê²°í•˜ê²Œ ì •ë¦¬\n- ì¤‘ìš”í•œ í¬ì¸íŠ¸ ê°•ì¡°\n- ë¹ ë¥¸ ì´í•´ë¥¼ ìœ„í•œ êµ¬ì¡°í™”';
                    enhancementNotes.push('ìš”ì•½ ìŠ¤íƒ€ì¼: í•µì‹¬ ë‚´ìš©ë§Œ ê°„ê²°í•˜ê²Œ ì •ë¦¬');
                    break;
                case 'ë¸”ë¡œê·¸':
                    enhancedText += '\n\n[ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼]\n- ê°œì¸ì  ì¸ì‚¬ì´íŠ¸ì™€ ê²½í—˜ ì¤‘ì‹¬\n- ë…ìì™€ì˜ ì†Œí†µì„ ìœ„í•œ ì¹œê·¼í•œ í†¤\n- ì‹¤ìš©ì ì¸ ì¡°ì–¸ê³¼ íŒ';
                    enhancementNotes.push('ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼: ê°œì¸ì  ì¸ì‚¬ì´íŠ¸ì™€ ê²½í—˜ ì¤‘ì‹¬');
                    break;
                case 'enhanced':
                    enhancedText += '\n\n[í–¥ìƒëœ ëª¨ë“œ]\n- AI ë¶„ì„ì´ í¬í•¨ëœ ê³ í’ˆì§ˆ ì½˜í…ì¸ \n- ë°ì´í„° ê¸°ë°˜ì˜ ê°ê´€ì  ë¶„ì„\n- ì‹¬ì¸µì ì¸ ì¸ì‚¬ì´íŠ¸ ì œê³µ';
                    enhancementNotes.push('í–¥ìƒëœ ëª¨ë“œ: AI ë¶„ì„ì´ í¬í•¨ëœ ê³ í’ˆì§ˆ ì½˜í…ì¸ ');
                    break;
            }

            return {
                enhancedText: enhancedText,
                enhancementNotes: enhancementNotes
            };
        }

        // ì¶”ê°€ ë³´ì™„ ì‚¬í•­ ì œì•ˆ í•¨ìˆ˜
        function generateImprovementSuggestions(rules, aiMode, contentLength) {
            const suggestions = [];

            // SEO ê´€ë ¨ ì œì•ˆ
            if (!rules.includes('AI_SEO')) {
                suggestions.push({
                    category: 'SEO ìµœì í™”',
                    title: 'AI SEO ì ìš© ê¶Œì¥',
                    description: 'í‚¤ì›Œë“œ ìµœì í™”ì™€ êµ¬ì¡°í™”ëœ ë°ì´í„°ë¥¼ í†µí•´ ê²€ìƒ‰ ì—”ì§„ ìµœì í™”ë¥¼ ê°•í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'high'
                });
            }

            if (!rules.includes('AI_SEARCH')) {
                suggestions.push({
                    category: 'ê²€ìƒ‰ ìµœì í™”',
                    title: 'AI SEARCH ì ìš© ê¶Œì¥',
                    description: 'ê²€ìƒ‰ ì˜ë„ ë°˜ì˜ê³¼ Featured Snippet ìµœì í™”ë¡œ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ë” ì˜ ë…¸ì¶œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'medium'
                });
            }

            // AI ìµœì í™” ê´€ë ¨ ì œì•ˆ
            if (!rules.includes('AEO')) {
                suggestions.push({
                    category: 'ì‚¬ìš©ì ê²½í—˜',
                    title: 'AEO ì ìš© ê¶Œì¥',
                    description: 'ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ì ì¸ ë‹µë³€ê³¼ FAQë¥¼ í†µí•´ ì‚¬ìš©ì ë§Œì¡±ë„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'high'
                });
            }

            if (!rules.includes('GEO')) {
                suggestions.push({
                    category: 'ì‹ ë¢°ì„±',
                    title: 'GEO ì ìš© ê¶Œì¥',
                    description: 'AIê°€ ì¸ìš©í•  ìˆ˜ ìˆëŠ” ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ë¡œ ì½˜í…ì¸ ì˜ ê¶Œìœ„ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'medium'
                });
            }

            if (!rules.includes('AIO')) {
                suggestions.push({
                    category: 'ê¸°ìˆ ì  ìµœì í™”',
                    title: 'AIO ì ìš© ê¶Œì¥',
                    description: 'AI ë„êµ¬ í†µí•©ê³¼ API ì¹œí™”ì  êµ¬ì¡°ë¡œ í–¥í›„ í™•ì¥ì„±ì„ í™•ë³´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'low'
                });
            }

            // ì½˜í…ì¸  ê¸¸ì´ ê´€ë ¨ ì œì•ˆ
            const targetLength = parseInt(contentLength);
            if (targetLength < 2000) {
                suggestions.push({
                    category: 'ì½˜í…ì¸  í’ˆì§ˆ',
                    title: 'ì½˜í…ì¸  ê¸¸ì´ í™•ì¥ ê¶Œì¥',
                    description: 'ë” ìƒì„¸í•œ ì •ë³´ì™€ ì˜ˆì‹œë¥¼ ì¶”ê°€í•˜ì—¬ ì½˜í…ì¸ ì˜ ê¹Šì´ì™€ ê°€ì¹˜ë¥¼ ë†’ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'medium'
                });
            }

            // ìŠ¤íƒ€ì¼ë³„ ì œì•ˆ
            if (!aiMode) {
                suggestions.push({
                    category: 'ì½˜í…ì¸  ìŠ¤íƒ€ì¼',
                    title: 'ì½˜í…ì¸  ìŠ¤íƒ€ì¼ ì„ íƒ ê¶Œì¥',
                    description: 'ëª©ì ì— ë§ëŠ” ìŠ¤íƒ€ì¼ì„ ì„ íƒí•˜ì—¬ ë” íš¨ê³¼ì ì¸ ì½˜í…ì¸ ë¥¼ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
                    priority: 'medium'
                });
            }

            return suggestions;
        }

        // ê²°ê³¼ ìƒíƒœì— ë”°ë¥¸ CSS í´ë˜ìŠ¤ ë°˜í™˜ í•¨ìˆ˜
        function getResultStatus(text) {
            if (text.includes('ì¤€ìˆ˜') || text.includes('ì ìš©') || text.includes('í¬í•¨') || text.includes('ìµœì í™”')) {
                return 'success';
            } else if (text.includes('ë¶€ë¶„ ì¤€ìˆ˜') || text.includes('ì¼ë¶€')) {
                return 'warning';
            } else if (text.includes('ë¯¸ì¤€ìˆ˜') || text.includes('ì—†ìŒ')) {
                return 'danger';
            }
            return 'neutral';
        }

        // ì•„ì´ì½˜ê³¼ í…ìŠ¤íŠ¸ë¥¼ ì •í™•íˆ ë¶„ë¦¬í•˜ëŠ” í•¨ìˆ˜
        function extractIconAndText(text) {
            // ì´ëª¨ì§€ ì•„ì´ì½˜ íŒ¨í„´ (ë” ì •í™•í•œ ë§¤ì¹­)
            const emojiPattern = /^([\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}])/u;
            const match = text.match(emojiPattern);

            if (match) {
                const icon = match[1];
                const content = text.substring(icon.length).trim();
                return { icon, content };
            }

            // ì´ëª¨ì§€ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ì•„ì´ì½˜ ì‚¬ìš©
            return { icon: 'â€¢', content: text };
        }

        // ë¬¸ë§¥ ê¸°ë°˜ ì½˜í…ì¸  ì •ì œí™” í•¨ìˆ˜
        function refineContentForReading(contentText, aiMode) {
            console.log('=== refineContentForReading ë””ë²„ê¹… ===');
            console.log('ì…ë ¥ í…ìŠ¤íŠ¸ ê¸¸ì´:', contentText.length);
            console.log('ì…ë ¥ í…ìŠ¤íŠ¸ ì‹œì‘:', contentText.substring(0, 100));

            // ì…ë ¥ í…ìŠ¤íŠ¸ ê²€ì¦
            if (!contentText || contentText.trim().length === 0) {
                console.log('ì…ë ¥ í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆìŒ');
                return '<p>ì…ë ¥ëœ ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            // HTML ì½˜í…ì¸ ì¸ì§€ í™•ì¸
            const hasHtmlTags = /<[^>]+>/.test(contentText);

            if (hasHtmlTags) {
                // HTML ì½˜í…ì¸ ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ë°˜í™˜ (ë§ˆí¬ë‹¤ìš´ ì½”ë“œ ë¸”ë¡ë§Œ ì œê±°)
                let htmlContent = removeCodeBlocks(contentText);

                console.log('HTML ì½˜í…ì¸  ê°ì§€, ë§ˆí¬ë‹¤ìš´ ë¸”ë¡ ì œê±° í›„ ê¸¸ì´:', htmlContent.length);
                return htmlContent;
            }

            // ì¼ë°˜ í…ìŠ¤íŠ¸ì¸ ê²½ìš° ê¸°ì¡´ ë¡œì§ ì ìš©
            // ë¶ˆí•„ìš”í•œ í…ìŠ¤íŠ¸ ì œê±°
            let cleanText = contentText
                .replace(/[^\w\sê°€-í£.,!?;:()[\]{}"'\-â€“â€”â€¦]/g, ' ') // íŠ¹ìˆ˜ë¬¸ì ì •ë¦¬
                .replace(/\s+/g, ' ') // ì—°ì† ê³µë°± ì •ë¦¬
                .trim();

            // ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„ë¦¬ ë° ì •ì œ
            const sentences = cleanText
                .split(/[.!?]+/)
                .map(s => s.trim())
                .filter(s => s.length > 3) // ë§¤ìš° ê´€ëŒ€í•œ ê¸¸ì´ ì¡°ê±´
                .map(s => {
                    // ë¬¸ì¥ ì‹œì‘ì„ ëŒ€ë¬¸ìë¡œ
                    if (s.length > 0) {
                        return s.charAt(0).toUpperCase() + s.slice(1);
                    }
                    return s;
                });

            // ë¬¸ì¥ì´ ì—†ìœ¼ë©´ ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë‹¨ìˆœíˆ í¬ë§·íŒ…
            if (sentences.length === 0) {
                return '<p>' + cleanText + '</p>';
            }

            // ë¬¸ë§¥ì„ ê³ ë ¤í•œ ë¬¸ì¥ ì¬êµ¬ì„±
            let refinedContent = '';
            let currentParagraph = '';
            let sentenceCount = 0;

            for (let i = 0; i < sentences.length; i++) {
                const sentence = sentences[i];

                // ë¬¸ì¥ì´ ë„ˆë¬´ ê¸¸ë©´ ë¶„í• 
                if (sentence.length > 150) {
                    const parts = sentence.split(/[,;]/);
                    if (parts.length > 1) {
                        parts.forEach(part => {
                            const trimmedPart = part.trim();
                            if (trimmedPart.length > 10) {
                                currentParagraph += trimmedPart + '. ';
                                sentenceCount++;
                            }
                        });
                    } else {
                        currentParagraph += sentence + '. ';
                        sentenceCount++;
                    }
                } else {
                    currentParagraph += sentence + '. ';
                    sentenceCount++;
                }

                // ë¬¸ë‹¨ êµ¬ë¶„ (3-4ë¬¸ì¥ë§ˆë‹¤)
                if (sentenceCount >= 3 || i === sentences.length - 1) {
                    if (currentParagraph.trim()) {
                        refinedContent += '<p>' + currentParagraph.trim() + '</p>';
                    }
                    currentParagraph = '';
                    sentenceCount = 0;
                }
            }

            // ìŠ¤íƒ€ì¼ë³„ ì¶”ê°€ ì •ì œ
            switch (aiMode) {
                case 'ë‰´ìŠ¤':
                    // ê°ê´€ì ì´ê³  ì‚¬ì‹¤ ì¤‘ì‹¬ìœ¼ë¡œ ì •ë¦¬
                    refinedContent = refinedContent
                        .replace(/[ì£¼ê´€ì |ê°œì¸ì |ë‚˜ì˜|ì €ì˜|ì œ ìƒê°|ê°œì¸ì ìœ¼ë¡œ]/g, '')
                        .replace(/[í™•ì‹¤íˆ|ë¶„ëª…íˆ|í‹€ë¦¼ì—†ì´]/g, '');
                    break;
                case 'ë¦¬ë·°':
                    // ì¥ë‹¨ì ì´ ëª…í™•íˆ êµ¬ë¶„ë˜ë„ë¡ ì •ë¦¬
                    refinedContent = refinedContent
                        .replace(/ì¥ì /g, '<strong>ì¥ì :</strong>')
                        .replace(/ë‹¨ì /g, '<strong>ë‹¨ì :</strong>')
                        .replace(/ì¢‹ì€ ì /g, '<strong>ì¢‹ì€ ì :</strong>')
                        .replace(/ì•„ì‰¬ìš´ ì /g, '<strong>ì•„ì‰¬ìš´ ì :</strong>');
                    break;
                case 'ê°€ì´ë“œ':
                    // ë‹¨ê³„ë³„ë¡œ ëª…í™•íˆ êµ¬ë¶„
                    refinedContent = refinedContent
                        .replace(/(\d+\.)/g, '<strong>$1</strong>')
                        .replace(/[ì²«ì§¸|ë‘˜ì§¸|ì…‹ì§¸|ë„·ì§¸|ë‹¤ì„¯ì§¸]/g, '<strong>$&</strong>');
                    break;
                case 'ìš”ì•½':
                    // í•µì‹¬ë§Œ ê°„ê²°í•˜ê²Œ
                    refinedContent = refinedContent.replace(/<p>/g, '<p class="summary-paragraph">');
                    break;
                case 'ë¸”ë¡œê·¸':
                    // ê°œì¸ì  ì¸ì‚¬ì´íŠ¸ ê°•ì¡°
                    refinedContent = refinedContent
                        .replace(/[ì¤‘ìš”í•œ|í•µì‹¬ì ì¸|ì£¼ëª©í•  ë§Œí•œ|íŠ¹ë³„í•œ|ë†€ë¼ìš´]/g, '<em>$&</em>')
                        .replace(/[ê²½í—˜|ì²´í—˜|ëŠë‚€ ì |ë°°ìš´ ì ]/g, '<strong>$&</strong>');
                    break;
                case 'enhanced':
                    // AI ë¶„ì„ì´ í¬í•¨ëœ ê³ í’ˆì§ˆ ì½˜í…ì¸ 
                    refinedContent = refinedContent
                        .replace(/[ë¶„ì„|ì—°êµ¬|ì¡°ì‚¬|ê²°ê³¼]/g, '<strong>$&</strong>')
                        .replace(/[í†µê³„|ë°ì´í„°|ìˆ˜ì¹˜]/g, '<em>$&</em>');
                    break;
            }

            // ìµœì¢… ì •ë¦¬
            refinedContent = refinedContent
                .replace(/\s+/g, ' ') // ì—°ì† ê³µë°± ì •ë¦¬
                .replace(/>\s+</g, '><') // íƒœê·¸ ì‚¬ì´ ê³µë°± ì •ë¦¬
                .trim();

            // ê²°ê³¼ê°€ ë¹„ì–´ìˆìœ¼ë©´ ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ë°˜í™˜
            if (!refinedContent || refinedContent.trim().length === 0) {
                return '<p>' + cleanText.substring(0, 1000) + '</p>';
            }

            return refinedContent;
        }

        // ìš”ì•½(1000ì ì´ë‚´ ì™„ì„±í˜• ë¬¸ì¥)ê³¼ ë³¸ë¬¸ ë¶„ë¦¬ í•¨ìˆ˜
        function extractSummaryAndBody(contentText) {
            console.log('=== extractSummaryAndBody í•¨ìˆ˜ í˜¸ì¶œë¨ ===');
            console.log('ì…ë ¥ í…ìŠ¤íŠ¸ ê¸¸ì´:', contentText.length);
            console.log('ì…ë ¥ í…ìŠ¤íŠ¸ ì‹œì‘:', contentText.substring(0, 100));

            let summary = '';
            let body = '';
            const sentences = contentText.match(/[^.!?]+[.!?]+/g) || [];
            console.log('ì¶”ì¶œëœ ë¬¸ì¥ ìˆ˜:', sentences.length);

            // ìš”ì•½: ì •í™•íˆ 1000ì ì´ë‚´ (ëª©í‘œ: 800-1000ì)
            const targetSummaryLength = Math.min(1000, Math.max(800, contentText.length * 0.3));
            let sentenceCount = 0;

            for (let s of sentences) {
                if ((summary + s).length <= targetSummaryLength && sentenceCount < 4) {
                    summary += s;
                    sentenceCount++;
                } else {
                    break;
                }
            }

            // ìš”ì•½ì´ ì—†ê±°ë‚˜ ë„ˆë¬´ ì§§ìœ¼ë©´ ì²˜ìŒ ë¶€ë¶„ì„ ìš”ì•½ìœ¼ë¡œ
            if (!summary || summary.length < 300) {
                summary = contentText.substring(0, Math.min(targetSummaryLength, contentText.length));
            }

            // ë³¸ë¬¸: ìš”ì•½ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ ì „ì²´ í…ìŠ¤íŠ¸ (ëª©í‘œ: 2000ì ì´ìƒ)
            const summaryEndIndex = contentText.indexOf(summary) + summary.length;
            body = contentText.substring(summaryEndIndex).trim();

            // ë³¸ë¬¸ì´ ë¹„ì–´ìˆê±°ë‚˜ ë„ˆë¬´ ì§§ìœ¼ë©´ ì›ë³¸ í…ìŠ¤íŠ¸ì—ì„œ ìš”ì•½ ë¶€ë¶„ë§Œ ì œê±°
            if (!body || body.length < 500) {
                body = contentText.replace(summary, '').trim();
            }

            // ë³¸ë¬¸ì´ ì—¬ì „íˆ ë¹„ì–´ìˆìœ¼ë©´ ì›ë³¸ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•˜ê³  ìš”ì•½ì„ ë” ì§§ê²Œ
            if (!body || body.length < 300) {
                body = contentText;
                summary = contentText.substring(0, Math.min(600, contentText.length));
            }

            console.log('ëª©í‘œ ìš”ì•½ ê¸¸ì´:', targetSummaryLength);
            console.log('ì‹¤ì œ ìš”ì•½ ê¸¸ì´:', summary.length);
            console.log('ì‹¤ì œ ë³¸ë¬¸ ê¸¸ì´:', body.length);
            console.log('ìš”ì•½ ì‹œì‘:', summary.substring(0, 100));
            console.log('ë³¸ë¬¸ ì‹œì‘:', body.substring(0, 100));

            return { summary: summary.trim(), body: body.trim() };
        }

        // ìƒˆë¡œìš´ ì½˜í…ì¸  í…œí”Œë¦¿ ìƒì„± í•¨ìˆ˜
        function generateContentTemplate(data, aiMode) {
            console.log('=== generateContentTemplate ë””ë²„ê¹… ===');
            console.log('ì›ë³¸ ì½˜í…ì¸  ê¸¸ì´:', data.content.length);
            console.log('ì›ë³¸ ì½˜í…ì¸  ì‹œì‘:', data.content.substring(0, 100));
            console.log('ì›ë³¸ ì½˜í…ì¸  ë:', data.content.substring(data.content.length - 100));

            // HTML ë¸”ë¡ì—ì„œ ì‹¤ì œ HTML ì½˜í…ì¸ ë§Œ ì¶”ì¶œ
            let templateCleanContent = extractHtmlContent(data.content);

            console.log('HTML ì½˜í…ì¸  ì¶”ì¶œ ì™„ë£Œ!');
            console.log('ì¶”ì¶œëœ ì½˜í…ì¸  ê¸¸ì´:', templateCleanContent.length);
            console.log('ì¶”ì¶œëœ ì½˜í…ì¸  ì‹œì‘:', templateCleanContent.substring(0, 100));

            // ë§Œì•½ templateCleanContentê°€ ë¹„ì–´ìˆë‹¤ë©´ ì›ë³¸ data.content ì‚¬ìš©
            if (!templateCleanContent || templateCleanContent.trim().length === 0) {
                console.log('templateCleanContentê°€ ë¹„ì–´ìˆì–´ì„œ ì›ë³¸ data.content ì‚¬ìš©');
                templateCleanContent = data.content;
                console.log('ì›ë³¸ ì‚¬ìš© í›„ ê¸¸ì´:', templateCleanContent.length);
            }

            // ì œëª© ì¶”ì¶œ
            const titleMatch = templateCleanContent.match(/<h1[^>]*>(.*?)<\/h1>/i);
            const title = titleMatch ? titleMatch[1] : 'ìƒì„±ëœ ì½˜í…ì¸ ';

            // ë³¸ë¬¸ ë‚´ìš© ì¶”ì¶œ (H1 ì œì™¸)
            console.log('=== HTML ì •ì œ ê³¼ì • ë””ë²„ê¹… ===');
            console.log('templateCleanContent ê¸¸ì´:', templateCleanContent.length);
            console.log('templateCleanContent ì‹œì‘:', templateCleanContent.substring(0, 200));

            // HTML íƒœê·¸ë¥¼ ë‹¨ê³„ë³„ë¡œ ì œê±°í•˜ì—¬ ì•ˆì „í•˜ê²Œ ì²˜ë¦¬
            let contentText = templateCleanContent;

            // 1ë‹¨ê³„: H1 íƒœê·¸ë§Œ ì œê±°
            contentText = contentText.replace(/<h1[^>]*>.*?<\/h1>/gi, '');
            console.log('H1 ì œê±° í›„ ê¸¸ì´:', contentText.length);

            // 2ë‹¨ê³„: ë‚˜ë¨¸ì§€ HTML íƒœê·¸ ì œê±°
            contentText = contentText.replace(/<[^>]*>/g, '');
            console.log('ëª¨ë“  HTML íƒœê·¸ ì œê±° í›„ ê¸¸ì´:', contentText.length);

            // 3ë‹¨ê³„: ê³µë°± ì •ë¦¬
            contentText = contentText.replace(/\s+/g, ' ').trim();
            console.log('ê³µë°± ì •ë¦¬ í›„ ê¸¸ì´:', contentText.length);
            console.log('ìµœì¢… contentText ì‹œì‘:', contentText.substring(0, 200));

            // ë§Œì•½ contentTextê°€ ë¹„ì–´ìˆë‹¤ë©´ ì›ë³¸ templateCleanContentì—ì„œ H1ë§Œ ì œê±°
            if (!contentText || contentText.trim().length === 0) {
                console.log('contentTextê°€ ë¹„ì–´ìˆì–´ì„œ ì›ë³¸ templateCleanContentì—ì„œ H1ë§Œ ì œê±°');
                contentText = templateCleanContent
                    .replace(/<h1[^>]*>.*?<\/h1>/gi, '') // H1 íƒœê·¸ë§Œ ì œê±°
                    .replace(/\s+/g, ' ') // ì—°ì† ê³µë°± ì •ë¦¬
                    .trim();
                console.log('ì›ë³¸ ì‚¬ìš© í›„ ê¸¸ì´:', contentText.length);
            }

            // ìš”ì•½/ë³¸ë¬¸ ë¶„ë¦¬
            console.log('=== generateContentTemplateì—ì„œ ìš”ì•½/ë³¸ë¬¸ ë¶„ë¦¬ ì‹œì‘ ===');
            const { summary, body } = extractSummaryAndBody(contentText);

            // ì¹´ìš´íŠ¸
            const summaryLength = summary.length;
            const summaryWordCount = summary.split(/\s+/).filter(w => w).length;
            const bodyLength = body.length;
            const bodyWordCount = body.split(/\s+/).filter(w => w).length;

            console.log('ìµœì¢… ì¹´ìš´íŠ¸ ê²°ê³¼:');
            console.log('- ìš”ì•½ ê¸¸ì´:', summaryLength);
            console.log('- ìš”ì•½ ë‹¨ì–´ìˆ˜:', summaryWordCount);
            console.log('- ë³¸ë¬¸ ê¸¸ì´:', bodyLength);
            console.log('- ë³¸ë¬¸ ë‹¨ì–´ìˆ˜:', bodyWordCount);

            // í‚¤ì›Œë“œ ì²˜ë¦¬
            const keywords = data.keywords ? data.keywords.split(',').map(k => k.trim()).join(', ') : 'í‚¤ì›Œë“œ ì—†ìŒ';

            // ì£¼ìš” ë‚´ìš© (ë³¸ë¬¸ë§Œ)
            const mainContent = refineContentForReading(body, aiMode);

            // í•µì‹¬ í¬ì¸íŠ¸ ìƒì„± (ë³¸ë¬¸ì—ì„œ ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬ 3-5ê°œ ì¶”ì¶œ)
            const sentences = body.split(/[.!?]+/).filter(s => s.trim().length > 10);
            const keyPoints = sentences.slice(0, Math.min(5, sentences.length));

            // ì‹¤ìš©ì ì¸ íŒ ìƒì„± (ë³¸ë¬¸ì—ì„œ ë¬¸ì¥ ë‹¨ìœ„ë¡œ ë¶„ë¦¬í•˜ì—¬ 3-5ê°œ ì¶”ì¶œ)
            const tips = sentences.slice(Math.min(5, sentences.length), Math.min(10, sentences.length));

            // ìŠ¤íƒ€ì¼ë³„ ì•„ì´ì½˜ê³¼ ì„¤ëª…
            const styleInfo = {
                'ë‰´ìŠ¤': { icon: 'ğŸ“°', desc: 'ìµœì‹  ì •ë³´ì™€ ê°ê´€ì  ì‚¬ì‹¤ ì¤‘ì‹¬' },
                'ë¦¬ë·°': { icon: 'â­', desc: 'ì¥ë‹¨ì  ë¶„ì„ê³¼ ê°œì¸ì  ê²½í—˜' },
                'ê°€ì´ë“œ': { icon: 'ğŸ“‹', desc: 'ë‹¨ê³„ë³„ ì„¤ëª…ê³¼ ì‹¤ìš©ì  ì •ë³´' },
                'ìš”ì•½': { icon: 'ğŸ“', desc: 'í•µì‹¬ ë‚´ìš©ë§Œ ê°„ê²°í•˜ê²Œ ì •ë¦¬' },
                'ë¸”ë¡œê·¸': { icon: 'âœï¸', desc: 'ê°œì¸ì  ì¸ì‚¬ì´íŠ¸ì™€ ê²½í—˜ ì¤‘ì‹¬' },
                'enhanced': { icon: 'ğŸŒŸ', desc: 'AI ë¶„ì„ì´ í¬í•¨ëœ ê³ í’ˆì§ˆ ì½˜í…ì¸ ' }
            };

            const currentStyle = styleInfo[aiMode] || { icon: 'ğŸ¤–', desc: 'ê¸°ë³¸ ìŠ¤íƒ€ì¼' };

            return `
                <div class="content-template">
                    <!-- ì œëª© ì˜ì—­ -->
                    <div class="content-header mb-4">
                        <h1 class="content-title">${title}</h1>
                        <div class="content-meta">
                            <span class="badge bg-primary me-2">${currentStyle.icon} ${aiMode || 'ê¸°ë³¸'}</span>
                            <span class="text-muted">${currentStyle.desc}</span>
                        </div>
                    </div>
                    
                    <!-- ìš”ì•½ -->
                    <div class="content-section mb-4">
                        <h3 class="section-title">
                            <i class="bi bi-file-text me-2"></i>ìš”ì•½
                            <span class="badge bg-secondary ms-2">ê¸€ììˆ˜: ${summaryLength} / ë‹¨ì–´ìˆ˜: ${summaryWordCount}</span>
                        </h3>
                        <div class="section-content">
                            <p class="summary-text">${summary}</p>
                        </div>
                    </div>
                    
                    <!-- ì¶”ì²œ í‚¤ì›Œë“œ -->
                    <div class="content-section mb-4">
                        <h3 class="section-title">
                            <i class="bi bi-tags me-2"></i>ì¶”ì²œ í‚¤ì›Œë“œ
                        </h3>
                        <div class="section-content">
                            <div class="keywords-display">
                                ${keywords.split(',').map(k => `<span class="keyword-tag">${k.trim()}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì£¼ìš” ë‚´ìš© -->
                    <div class="content-section mb-4">
                        <h3 class="section-title">
                            <i class="bi bi-file-earmark-text me-2"></i>ì£¼ìš” ë‚´ìš©
                            <span class="badge bg-secondary ms-2">ê¸€ììˆ˜: ${bodyLength} / ë‹¨ì–´ìˆ˜: ${bodyWordCount}</span>
                        </h3>
                        <div class="section-content">
                            <div class="main-content-text">
                                ${mainContent}
                            </div>
                        </div>
                    </div>
                    
                    <!-- í•µì‹¬ í¬ì¸íŠ¸ -->
                    <div class="content-section mb-4">
                        <h3 class="section-title">
                            <i class="bi bi-lightbulb me-2"></i>í•µì‹¬ í¬ì¸íŠ¸
                        </h3>
                        <div class="section-content">
                            <ul class="key-points-list">
                                ${keyPoints.map(point => `<li>${point.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <!-- ì‹¤ìš©ì ì¸ íŒ -->
                    <div class="content-section mb-4">
                        <h3 class="section-title">
                            <i class="bi bi-lightning me-2"></i>ì‹¤ìš©ì ì¸ íŒ
                        </h3>
                        <div class="section-content">
                            <ul class="tips-list">
                                ${tips.map((tip, index) => `<li>${tip.trim()}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                    
                    <!-- êµ¬ë¶„ì„  -->
                    <hr class="content-divider">
                    
                    <!-- AI ë¶„ì„ -->
                    <div class="content-section ai-analysis-section">
                        <h3 class="section-title">
                            <i class="bi bi-robot me-2"></i>AI ë¶„ì„
                        </h3>
                        <div class="section-content">
                            <div class="ai-analysis-content">
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <div class="ai-analysis-card">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="ai-analysis-title mb-0">ì‹ ë¢°ë„ í‰ê°€</h5>
                                                <button class="btn btn-sm btn-outline-info" onclick="showAnalysisHelp('trust')" title="ê·¼ê±° ìë£Œ ë³´ê¸°">
                                                    <i class="bi bi-question-circle"></i>
                                                </button>
                                            </div>
                                            <div class="ai-analysis-value" id="trust-score-container">-</div>
                                            <div class="ai-analysis-desc" id="trust-reason-container">-</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="ai-analysis-card">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <h5 class="ai-analysis-title mb-0">SEO ìµœì í™” ì ìˆ˜</h5>
                                                <button class="btn btn-sm btn-outline-info" onclick="showAnalysisHelp('seo')" title="ê·¼ê±° ìë£Œ ë³´ê¸°">
                                                    <i class="bi bi-question-circle"></i>
                                                </button>
                                            </div>
                                            <div class="ai-analysis-value" id="seo-score-container">-</div>
                                            <div class="ai-analysis-desc" id="seo-reason-container">-</div>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="ai-analysis-card">
                                            <h5 class="ai-analysis-title">AI ìš”ì•½</h5>
                                            <div class="ai-analysis-desc" id="ai-summary-container">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function displayGuidelinesCompliance(content, config) {
            // ì½˜í…ì¸  ì¹´ë“œë¥¼ í™•ì¥ ìƒíƒœë¡œ ë³€ê²½
            const resultContainer = document.getElementById('result-container');
            resultContainer.classList.add('expanded');
            const guidelinesSummary = document.getElementById('guidelines-summary');
            const configuredGuidelines = document.getElementById('configured-guidelines');
            const appliedResults = document.getElementById('applied-results');
            const complianceScore = document.getElementById('guidelines-compliance-score');
            const complianceProgress = document.getElementById('compliance-progress');
            const compliancePercentage = document.getElementById('compliance-percentage');

            let complianceAnalysis = [];
            let complianceCount = 0;
            let totalChecks = 0;

            // AI SEO ê·œì¹™ ì¤€ìˆ˜ë„ í™•ì¸
            if (config.rules.includes('AI_SEO')) {
                totalChecks++;
                const hasKeywords = content.includes('<h1') || content.includes('<h2') || content.includes('<strong>');
                const hasStructuredData = content.includes('itemscope') || content.includes('schema.org');

                if (hasKeywords && hasStructuredData) {
                    complianceAnalysis.push('<span class="badge bg-success me-1 mb-1">âœ… AI SEO ì™„ë²½ ì¤€ìˆ˜</span>');
                    complianceCount++;
                } else if (hasKeywords || hasStructuredData) {
                    complianceAnalysis.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ AI SEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
                    complianceCount += 0.5;
                } else {
                    complianceAnalysis.push('<span class="badge bg-danger me-1 mb-1">âŒ AI SEO ë¯¸ì¤€ìˆ˜</span>');
                }
            }

            // AEO ê·œì¹™ ì¤€ìˆ˜ë„ í™•ì¸
            if (config.rules.includes('AEO')) {
                totalChecks++;
                const hasFAQ = content.includes('FAQ') || content.includes('ìì£¼ ë¬»ëŠ” ì§ˆë¬¸') || content.includes('Q&A');
                const hasQuestions = content.includes('?') && (content.includes('ë‹µë³€') || content.includes('ë‹µ'));

                if (hasFAQ || hasQuestions) {
                    complianceAnalysis.push('<span class="badge bg-success me-1 mb-1">âœ… AEO ì™„ë²½ ì¤€ìˆ˜</span>');
                    complianceCount++;
                } else {
                    complianceAnalysis.push('<span class="badge bg-danger me-1 mb-1">âŒ AEO ë¯¸ì¤€ìˆ˜</span>');
                }
            }

            // GEO ê·œì¹™ ì¤€ìˆ˜ë„ í™•ì¸
            if (config.rules.includes('GEO')) {
                totalChecks++;
                const hasCitations = content.includes('ì¶œì²˜') || content.includes('ì°¸ê³ ') || content.includes('ì¸ìš©');
                const hasTrustElements = content.includes('ì‹ ë¢°') || content.includes('ê²€ì¦') || content.includes('í™•ì¸');

                if (hasCitations && hasTrustElements) {
                    complianceAnalysis.push('<span class="badge bg-success me-1 mb-1">âœ… GEO ì™„ë²½ ì¤€ìˆ˜</span>');
                    complianceCount++;
                } else if (hasCitations || hasTrustElements) {
                    complianceAnalysis.push('<span class="badge bg-warning me-1 mb-1">âš ï¸ GEO ë¶€ë¶„ ì¤€ìˆ˜</span>');
                    complianceCount += 0.5;
                } else {
                    complianceAnalysis.push('<span class="badge bg-danger me-1 mb-1">âŒ GEO ë¯¸ì¤€ìˆ˜</span>');
                }
            }

            // ì½˜í…ì¸  ê¸¸ì´ ì¤€ìˆ˜ë„ í™•ì¸ (H1, H2, H3, H4 íƒœê·¸ ì œì™¸)
            if (config.contentLength) {
                totalChecks++;
                const complianceCleanContent = removeCodeBlocks(content)
                    .replace(/<h[1-4][^>]*>.*?<\/h[1-4]>/gi, '') // H1-H4 íƒœê·¸ì™€ ë‚´ìš© ì œê±°
                    .replace(/<[^>]*>/g, '') // ë‚˜ë¨¸ì§€ HTML íƒœê·¸ ì œê±°
                    .replace(/\s+/g, ' ') // ì—°ì† ê³µë°±ì„ ë‹¨ì¼ ê³µë°±ìœ¼ë¡œ
                    .trim(); // ì•ë’¤ ê³µë°± ì œê±°
                const contentLength = complianceCleanContent.length;
                const targetLength = parseInt(config.contentLength);
                const lengthRatio = contentLength / targetLength;

                if (lengthRatio >= 0.8 && lengthRatio <= 1.2) {
                    complianceAnalysis.push(`<span class="badge bg-success me-1 mb-1">âœ… ê¸¸ì´ ì¤€ìˆ˜ (${contentLength}ì)</span>`);
                    complianceCount++;
                } else if (lengthRatio >= 0.6 && lengthRatio <= 1.4) {
                    complianceAnalysis.push(`<span class="badge bg-warning me-1 mb-1">âš ï¸ ê¸¸ì´ ë¶€ë¶„ ì¤€ìˆ˜ (${contentLength}ì)</span>`);
                    complianceCount += 0.5;
                } else {
                    complianceAnalysis.push(`<span class="badge bg-danger me-1 mb-1">âŒ ê¸¸ì´ ë¯¸ì¤€ìˆ˜ (${contentLength}ì)</span>`);
                }
            }

            // ì •ì±… ê· í˜• ì¤€ìˆ˜ë„ í™•ì¸
            if (config.policyAuto) {
                totalChecks++;
                const hasBalance = content.includes('ì¥ë‹¨ì ') || content.includes('ê³ ë ¤ì‚¬í•­') ||
                    content.includes('ì£¼ì˜ì‚¬í•­') || content.includes('ë‹¨ì ') ||
                    content.includes('í•œê³„') || content.includes('ë¬¸ì œì ');

                if (hasBalance) {
                    complianceAnalysis.push('<span class="badge bg-success me-1 mb-1">âœ… ì •ì±… ê· í˜• ì¤€ìˆ˜</span>');
                    complianceCount++;
                } else {
                    complianceAnalysis.push('<span class="badge bg-danger me-1 mb-1">âŒ ì •ì±… ê· í˜• ë¯¸ì¤€ìˆ˜</span>');
                }
            }

            // AI ëª¨ë“œ ì¤€ìˆ˜ë„ í™•ì¸
            if (config.aiMode) {
                totalChecks++;
                let modeCompliance = false;

                switch (config.aiMode) {
                    case 'ë‰´ìŠ¤':
                        modeCompliance = content.includes('ìµœì‹ ') || content.includes('ë°œí‘œ') || content.includes('ê³µê°œ');
                        break;
                    case 'ë¦¬ë·°':
                        modeCompliance = content.includes('ì¥ì ') || content.includes('ë‹¨ì ') || content.includes('í‰ê°€');
                        break;
                    case 'ê°€ì´ë“œ':
                        modeCompliance = content.includes('ë‹¨ê³„') || content.includes('ë°©ë²•') || content.includes('ìˆœì„œ');
                        break;
                    case 'ìš”ì•½':
                        modeCompliance = content.length < 2000; // ìš”ì•½ì€ ì§§ì•„ì•¼ í•¨
                        break;
                    case 'ë¸”ë¡œê·¸':
                        modeCompliance = content.includes('ê°œì¸') || content.includes('ê²½í—˜') || content.includes('ìƒê°');
                        break;
                }

                if (modeCompliance) {
                    complianceAnalysis.push(`<span class="badge bg-success me-1 mb-1">âœ… ${config.aiMode} ìŠ¤íƒ€ì¼ ì¤€ìˆ˜</span>`);
                    complianceCount++;
                } else {
                    complianceAnalysis.push(`<span class="badge bg-warning me-1 mb-1">âš ï¸ ${config.aiMode} ìŠ¤íƒ€ì¼ ë¶€ë¶„ ì¤€ìˆ˜</span>`);
                    complianceCount += 0.5;
                }
            }

            // ì¤€ìˆ˜ë„ ê³„ì‚° ë° í‘œì‹œ
            if (totalChecks > 0) {
                const complianceRate = Math.round((complianceCount / totalChecks) * 100);

                // ì¤€ìˆ˜ë„ ë¶„ì„ ê²°ê³¼ ì €ì¥
                currentComplianceAnalysis = {
                    rate: complianceRate,
                    totalChecks: totalChecks,
                    complianceCount: complianceCount,
                    analysis: complianceAnalysis,
                    config: config,
                    content: content
                };

                // ì¤€ìˆ˜ë„ í‘œì‹œ ì—…ë°ì´íŠ¸
                complianceScore.textContent = `ì¤€ìˆ˜ë„: ${complianceRate}%`;
                complianceProgress.style.width = `${complianceRate}%`;
                compliancePercentage.textContent = `${complianceRate}%`;

                // ì¤€ìˆ˜ë„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€ê²½
                if (complianceRate >= 80) {
                    complianceScore.className = 'badge compliance-score bg-success me-2';
                    complianceProgress.className = 'progress-bar bg-success';
                } else if (complianceRate >= 60) {
                    complianceScore.className = 'badge compliance-score bg-warning me-2';
                    complianceProgress.className = 'progress-bar bg-warning';
                } else {
                    complianceScore.className = 'badge compliance-score bg-danger me-2';
                    complianceProgress.className = 'progress-bar bg-danger';
                }

                // ì„¤ì •ëœ ê°€ì´ë“œë¼ì¸ í‘œì‹œ ì—…ë°ì´íŠ¸
                if (configuredGuidelines) {
                    const configItems = [];

                    // ê·œì¹™ë“¤ì„ ì•„ì´ì½˜ê³¼ í•¨ê»˜ í‘œì‹œ
                    if (config.rules.length > 0) {
                        const ruleIcons = {
                            'AI_SEO': 'ğŸ¤–',
                            'AI_SEARCH': 'ğŸ”',
                            'AEO': 'ğŸ’¬',
                            'GEO': 'ğŸŒ',
                            'AIO': 'ğŸ”§'
                        };
                        const ruleDisplay = config.rules.map(rule =>
                            `<span class="guideline-badge">${ruleIcons[rule] || 'âš™ï¸'} ${rule.replace('_', ' ')}</span>`
                        ).join('');
                        configItems.push(`<div class="guideline-section"><strong>ê·œì¹™:</strong> ${ruleDisplay}</div>`);
                    }

                    // AI ëª¨ë“œ í‘œì‹œ
                    if (config.aiMode) {
                        const modeIcons = {
                            'ë‰´ìŠ¤': 'ğŸ“°',
                            'ë¦¬ë·°': 'â­',
                            'ê°€ì´ë“œ': 'ğŸ“‹',
                            'ìš”ì•½': 'ğŸ“',
                            'ë¸”ë¡œê·¸': 'âœï¸',
                            'enhanced': 'ğŸŒŸ'
                        };
                        const modeIcon = modeIcons[config.aiMode] || 'ğŸ¤–';
                        configItems.push(`<div class="guideline-section"><strong>ìŠ¤íƒ€ì¼:</strong> <span class="guideline-badge">${modeIcon} ${config.aiMode}</span></div>`);
                    }

                    // ëª©í‘œ ê¸¸ì´ í‘œì‹œ
                    if (config.contentLength) {
                        configItems.push(`<div class="guideline-section"><strong>ëª©í‘œ:</strong> <span class="guideline-badge">ğŸ“ ${config.contentLength}ì</span></div>`);
                    }

                    // ì •ì±… ê· í˜• í‘œì‹œ
                    if (config.policyAuto) {
                        configItems.push(`<div class="guideline-section"><strong>ê· í˜•:</strong> <span class="guideline-badge">âš–ï¸ ìë™ ì ìš©</span></div>`);
                    }

                    configuredGuidelines.innerHTML = configItems.join('');
                }

                // ì ìš© ê²°ê³¼ í‘œì‹œ ì—…ë°ì´íŠ¸
                if (appliedResults) {
                    const resultItems = complianceAnalysis.map(result => {
                        const text = result.replace(/<[^>]*>/g, '');
                        const isSuccess = result.includes('bg-success');
                        const isWarning = result.includes('bg-warning');
                        const isDanger = result.includes('bg-danger');

                        let statusIcon = 'â“';
                        let statusClass = 'result-neutral';

                        if (isSuccess) {
                            statusIcon = 'âœ…';
                            statusClass = 'result-success';
                        } else if (isWarning) {
                            statusIcon = 'âš ï¸';
                            statusClass = 'result-warning';
                        } else if (isDanger) {
                            statusIcon = 'âŒ';
                            statusClass = 'result-danger';
                        }

                        return `<div class="result-item ${statusClass}">
                            <span class="result-icon">${statusIcon}</span>
                            <span class="result-text">${text}</span>
                        </div>`;
                    }).join('');

                    appliedResults.innerHTML = resultItems || '<div class="text-muted">ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }

                // ê°€ì´ë“œë¼ì¸ ìš”ì•½ í‘œì‹œ
                if (guidelinesSummary) {
                    guidelinesSummary.style.display = 'block';
                }
            }
        }

        function showComplianceGuide() {
            if (!currentComplianceAnalysis) {
                showAlert('info', 'ì¤€ìˆ˜ë„ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            const analysis = currentComplianceAnalysis;
            const guideContent = document.getElementById('compliance-guide-content');
            const modalElement = document.getElementById('complianceGuideModal');

            let guideHTML = `
                <div class="row">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <h6><i class="bi bi-info-circle me-2"></i>í˜„ì¬ ì¤€ìˆ˜ë„: ${analysis.rate}%</h6>
                            <p class="mb-0">ì´ ${analysis.totalChecks}ê°œ í•­ëª© ì¤‘ ${analysis.complianceCount}ê°œ í•­ëª©ì´ ì¤€ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-graph-up me-2"></i>ì¤€ìˆ˜ë„ êµ¬ê°„ë³„ ë¶„ì„
                        </h6>
                        ${getComplianceLevelAnalysis(analysis.rate)}
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6 class="text-success mb-3">
                            <i class="bi bi-check-circle me-2"></i>ê°œì„  ì œì•ˆì‚¬í•­
                        </h6>
                        ${getImprovementSuggestions(analysis)}
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6 class="text-warning mb-3">
                            <i class="bi bi-lightbulb me-2"></i>ê¸€ ì‘ì„± íŒ
                        </h6>
                        ${getWritingTips(analysis)}
                    </div>
                </div>
            `;

            guideContent.innerHTML = guideHTML;

            // ëª¨ë‹¬ í‘œì‹œ (ì ‘ê·¼ì„± ê°œì„ )
            try {
                const modal = new bootstrap.Modal(modalElement);

                // ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                modalElement.addEventListener('shown.bs.modal', function () {
                    // ëª¨ë‹¬ì´ í‘œì‹œëœ í›„ í¬ì»¤ìŠ¤ ê´€ë¦¬
                    const applyBtn = document.getElementById('applySuggestionsBtn');
                    if (applyBtn) {
                        applyBtn.focus();
                    }
                });

                modalElement.addEventListener('hidden.bs.modal', function () {
                    // ëª¨ë‹¬ì´ ë‹«íŒ í›„ í¬ì»¤ìŠ¤ ë³µì›
                    const generateBtn = document.getElementById('generate-btn');
                    if (generateBtn) {
                        generateBtn.focus();
                    }
                });

                modal.show();
            } catch (error) {
                console.error('ëª¨ë‹¬ í‘œì‹œ ì¤‘ ì˜¤ë¥˜:', error);
                showAlert('danger', 'ëª¨ë‹¬ì„ í‘œì‹œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }

        function getComplianceLevelAnalysis(rate) {
            if (rate >= 90) {
                return `
                    <div class="alert alert-success">
                        <h6><i class="bi bi-trophy me-2"></i>ìš°ìˆ˜ (90-100%)</h6>
                        <p class="mb-2">ë§¤ìš° ë†’ì€ ì¤€ìˆ˜ë„ì…ë‹ˆë‹¤! ëŒ€ë¶€ë¶„ì˜ ê°€ì´ë“œë¼ì¸ì´ ì˜ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                        <ul class="mb-0">
                            <li>ì½˜í…ì¸  í’ˆì§ˆì´ ë§¤ìš° ìš°ìˆ˜í•©ë‹ˆë‹¤</li>
                            <li>SEO ìµœì í™”ê°€ ì˜ ë˜ì–´ ìˆìŠµë‹ˆë‹¤</li>
                            <li>ë…ìì—ê²Œ ë†’ì€ ê°€ì¹˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤</li>
                        </ul>
                    </div>
                `;
            } else if (rate >= 80) {
                return `
                    <div class="alert alert-info">
                        <h6><i class="bi bi-star me-2"></i>ì–‘í˜¸ (80-89%)</h6>
                        <p class="mb-2">ì¢‹ì€ ì¤€ìˆ˜ë„ì…ë‹ˆë‹¤. ëª‡ ê°€ì§€ ê°œì„ ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        <ul class="mb-0">
                            <li>ì „ë°˜ì ìœ¼ë¡œ ì˜ ì‘ì„±ëœ ì½˜í…ì¸ ì…ë‹ˆë‹¤</li>
                            <li>ì¼ë¶€ ì„¸ë¶€ì‚¬í•­ë§Œ ë³´ì™„í•˜ë©´ ë©ë‹ˆë‹¤</li>
                            <li>ë…ì ê²½í—˜ì´ ì–‘í˜¸í•©ë‹ˆë‹¤</li>
                        </ul>
                    </div>
                `;
            } else if (rate >= 70) {
                return `
                    <div class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle me-2"></i>ë³´í†µ (70-79%)</h6>
                        <p class="mb-2">ì ë‹¹í•œ ì¤€ìˆ˜ë„ì…ë‹ˆë‹¤. ê°œì„ ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.</p>
                        <ul class="mb-0">
                            <li>ê¸°ë³¸ì ì¸ êµ¬ì¡°ëŠ” ê°–ì¶”ê³  ìˆìŠµë‹ˆë‹¤</li>
                            <li>ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ìš”ì†Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤</li>
                            <li>ê°œì„ ì„ í†µí•´ ë” ë‚˜ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        </ul>
                    </div>
                `;
            } else if (rate >= 60) {
                return `
                    <div class="alert alert-warning">
                        <h6><i class="bi bi-exclamation-triangle me-2"></i>ë¯¸í¡ (60-69%)</h6>
                        <p class="mb-2">ì¤€ìˆ˜ë„ê°€ ë‚®ìŠµë‹ˆë‹¤. ìƒë‹¹í•œ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <ul class="mb-0">
                            <li>ê¸°ë³¸ êµ¬ì¡°ëŠ” ìˆì§€ë§Œ ì„¸ë¶€ì‚¬í•­ì´ ë¶€ì¡±í•©ë‹ˆë‹¤</li>
                            <li>SEO ìµœì í™”ê°€ ë¯¸í¡í•©ë‹ˆë‹¤</li>
                            <li>ë…ì ê²½í—˜ì„ ê°œì„ í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤</li>
                        </ul>
                    </div>
                `;
            } else {
                return `
                    <div class="alert alert-danger">
                        <h6><i class="bi bi-x-circle me-2"></i>ë¶€ì¡± (60% ë¯¸ë§Œ)</h6>
                        <p class="mb-2">ì¤€ìˆ˜ë„ê°€ ë§¤ìš° ë‚®ìŠµë‹ˆë‹¤. ëŒ€í­ì ì¸ ê°œì„ ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        <ul class="mb-0">
                            <li>ê¸°ë³¸ì ì¸ ê°€ì´ë“œë¼ì¸ ì¤€ìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤</li>
                            <li>SEO ìµœì í™”ê°€ ê±°ì˜ ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤</li>
                            <li>ì „ë©´ì ì¸ ì¬ì‘ì„±ì´ ê¶Œì¥ë©ë‹ˆë‹¤</li>
                        </ul>
                    </div>
                `;
            }
        }

        function getImprovementSuggestions(analysis) {
            const suggestions = [];
            const config = analysis.config;
            const content = analysis.content;

            // AI SEO ê°œì„  ì œì•ˆ
            if (config.rules.includes('AI_SEO')) {
                if (!content.includes('<h1') && !content.includes('<h2')) {
                    suggestions.push({
                        category: 'AI SEO',
                        issue: 'í—¤ë”© êµ¬ì¡° ë¶€ì¡±',
                        suggestion: 'H1, H2, H3 íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³„ì¸µì  êµ¬ì¡°ë¥¼ ë§Œë“œì„¸ìš”.',
                        priority: 'ë†’ìŒ',
                        action: 'addHeadings',
                        actionText: 'í—¤ë”© êµ¬ì¡° ì¶”ê°€'
                    });
                }
                if (!content.includes('itemscope') && !content.includes('schema.org')) {
                    suggestions.push({
                        category: 'AI SEO',
                        issue: 'êµ¬ì¡°í™”ëœ ë°ì´í„° ì—†ìŒ',
                        suggestion: 'Schema.org ë§ˆí¬ì—…ì„ ì¶”ê°€í•˜ì—¬ ê²€ìƒ‰ì—”ì§„ì´ ì½˜í…ì¸ ë¥¼ ë” ì˜ ì´í•´í•  ìˆ˜ ìˆë„ë¡ í•˜ì„¸ìš”.',
                        priority: 'ì¤‘ê°„',
                        action: 'addStructuredData',
                        actionText: 'êµ¬ì¡°í™” ë°ì´í„° ì¶”ê°€'
                    });
                }
            }

            // AEO ê°œì„  ì œì•ˆ
            if (config.rules.includes('AEO')) {
                if (!content.includes('FAQ') && !content.includes('ìì£¼ ë¬»ëŠ” ì§ˆë¬¸')) {
                    suggestions.push({
                        category: 'AEO',
                        issue: 'FAQ ì„¹ì…˜ ë¶€ì¡±',
                        suggestion: 'ë…ìë“¤ì´ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í¬í•¨í•œ FAQ ì„¹ì…˜ì„ ì¶”ê°€í•˜ì„¸ìš”.',
                        priority: 'ë†’ìŒ',
                        action: 'addFAQ',
                        actionText: 'FAQ ì„¹ì…˜ ì¶”ê°€'
                    });
                }
            }

            // GEO ê°œì„  ì œì•ˆ
            if (config.rules.includes('GEO')) {
                if (!content.includes('ì¶œì²˜') && !content.includes('ì°¸ê³ ')) {
                    suggestions.push({
                        category: 'GEO',
                        issue: 'ì¶œì²˜ ì¸ìš© ë¶€ì¡±',
                        suggestion: 'ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¥¼ ì¸ìš©í•˜ì—¬ ì½˜í…ì¸ ì˜ ì‹ ë¢°ì„±ì„ ë†’ì´ì„¸ìš”.',
                        priority: 'ì¤‘ê°„',
                        action: 'addSources',
                        actionText: 'ì¶œì²˜ ì¸ìš© ì¶”ê°€'
                    });
                }
            }

            // ì½˜í…ì¸  ê¸¸ì´ ê°œì„  ì œì•ˆ
            if (config.contentLength) {
                const contentLength = content.replace(/<[^>]*>/g, '').length;
                const targetLength = parseInt(config.contentLength);
                if (contentLength < targetLength * 0.8) {
                    suggestions.push({
                        category: 'ì½˜í…ì¸  ê¸¸ì´',
                        issue: 'ëª©í‘œ ê¸¸ì´ ë¯¸ë‹¬',
                        suggestion: `ëª©í‘œ ê¸¸ì´ ${targetLength}ìì— ë¹„í•´ í˜„ì¬ ${contentLength}ìë¡œ ë¶€ì¡±í•©ë‹ˆë‹¤. ë” ìƒì„¸í•œ ë‚´ìš©ì„ ì¶”ê°€í•˜ì„¸ìš”.`,
                        priority: 'ë†’ìŒ',
                        action: 'expandContent',
                        actionText: 'ì½˜í…ì¸  í™•ì¥'
                    });
                }
            }

            // ì •ì±… ê· í˜• ê°œì„  ì œì•ˆ
            if (config.policyAuto) {
                if (!content.includes('ì¥ë‹¨ì ') && !content.includes('ê³ ë ¤ì‚¬í•­')) {
                    suggestions.push({
                        category: 'ì •ì±… ê· í˜•',
                        issue: 'ê· í˜• ì¡íŒ ê´€ì  ë¶€ì¡±',
                        suggestion: 'ì¥ë‹¨ì , ê³ ë ¤ì‚¬í•­, ì£¼ì˜ì‚¬í•­ ë“±ì„ í¬í•¨í•˜ì—¬ ê· í˜• ì¡íŒ ê´€ì ì„ ì œì‹œí•˜ì„¸ìš”.',
                        priority: 'ì¤‘ê°„',
                        action: 'addBalance',
                        actionText: 'ê· í˜• ê´€ì  ì¶”ê°€'
                    });
                }
            }

            if (suggestions.length === 0) {
                return '<div class="alert alert-success"><i class="bi bi-check-circle me-2"></i>ëª¨ë“  ê°€ì´ë“œë¼ì¸ì´ ì˜ ì¤€ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤!</div>';
            }

            let suggestionsHTML = '';
            suggestions.forEach((suggestion, index) => {
                const priorityColor = suggestion.priority === 'ë†’ìŒ' ? 'danger' : 'warning';
                suggestionsHTML += `
                    <div class="card mb-2">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div class="flex-grow-1">
                                    <h6 class="card-title text-${priorityColor}">
                                        <i class="bi bi-exclamation-triangle me-2"></i>${suggestion.category}
                                    </h6>
                                    <p class="card-text mb-1"><strong>ë¬¸ì œ:</strong> ${suggestion.issue}</p>
                                    <p class="card-text mb-0"><strong>ì œì•ˆ:</strong> ${suggestion.suggestion}</p>
                                </div>
                                <div class="d-flex flex-column align-items-end">
                                    <span class="badge bg-${priorityColor} mb-2">${suggestion.priority}</span>
                                    <button type="button" class="btn btn-sm btn-outline-primary" 
                                            onclick="applySuggestion(${index}, '${suggestion.action}', '${suggestion.category}')">
                                        <i class="bi bi-magic me-1"></i>${suggestion.actionText}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            // ì „ì—­ ë³€ìˆ˜ì— ì œì•ˆì‚¬í•­ ì €ì¥
            window.currentSuggestions = suggestions;

            return suggestionsHTML;
        }

        function getWritingTips(analysis) {
            const tips = [
                {
                    title: 'ì œëª© ìµœì í™”',
                    tip: 'H1 íƒœê·¸ì—ëŠ” ì£¼ìš” í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ê³ , H2, H3 íƒœê·¸ë¡œ í•˜ìœ„ ì£¼ì œë¥¼ êµ¬ë¶„í•˜ì„¸ìš”.'
                },
                {
                    title: 'í‚¤ì›Œë“œ ë°°ì¹˜',
                    tip: 'ì²« ë¬¸ë‹¨, ë§ˆì§€ë§‰ ë¬¸ë‹¨, ê·¸ë¦¬ê³  ë³¸ë¬¸ ì¤‘ê°„ì— ìì—°ìŠ¤ëŸ½ê²Œ í‚¤ì›Œë“œë¥¼ ë°°ì¹˜í•˜ì„¸ìš”.'
                },
                {
                    title: 'ê°€ë…ì„± í–¥ìƒ',
                    tip: 'ì§§ì€ ë¬¸ë‹¨, ê¸€ë¨¸ë¦¬ ê¸°í˜¸, ë²ˆí˜¸ ë§¤ê¸°ê¸°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½ê¸° ì‰½ê²Œ ë§Œë“œì„¸ìš”.'
                },
                {
                    title: 'ë‚´ë¶€ ë§í¬',
                    tip: 'ê´€ë ¨ëœ ë‹¤ë¥¸ í˜ì´ì§€ë‚˜ ì„¹ì…˜ìœ¼ë¡œì˜ ë§í¬ë¥¼ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©ì ê²½í—˜ì„ í–¥ìƒì‹œí‚¤ì„¸ìš”.'
                },
                {
                    title: 'ì´ë¯¸ì§€ ìµœì í™”',
                    tip: 'ê´€ë ¨ ì´ë¯¸ì§€ë¥¼ ì¶”ê°€í•˜ê³  alt í…ìŠ¤íŠ¸ì— í‚¤ì›Œë“œë¥¼ í¬í•¨í•˜ì„¸ìš”.'
                }
            ];

            let tipsHTML = '<div class="row">';
            tips.forEach((tip, index) => {
                tipsHTML += `
                    <div class="col-md-6 mb-2">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title text-primary">
                                    <i class="bi bi-lightbulb me-2"></i>${tip.title}
                                </h6>
                                <p class="card-text small">${tip.tip}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            tipsHTML += '</div>';

            return tipsHTML;
        }

        // ê°œë³„ ì œì•ˆì‚¬í•­ ì ìš© í•¨ìˆ˜
        async function applySuggestion(index, action, category) {
            try {
                const suggestion = window.currentSuggestions[index];
                if (!suggestion) {
                    showAlert('danger', 'ì œì•ˆì‚¬í•­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                showAlert('info', `${category} ê°œì„ ì‚¬í•­ì„ ì ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤...`);

                // í˜„ì¬ ìƒì„±ëœ ì½˜í…ì¸  ê°€ì ¸ì˜¤ê¸°
                const currentContent = document.getElementById('generated-content').value;
                if (!currentContent) {
                    showAlert('danger', 'ì ìš©í•  ì½˜í…ì¸ ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                // ì œì•ˆì‚¬í•­ì— ë”°ë¥¸ ì½˜í…ì¸  ê°œì„ 
                const improvedContent = await improveContentWithSuggestion(currentContent, action, suggestion);

                if (improvedContent) {
                    // ê°œì„ ëœ ì½˜í…ì¸ ë¥¼ ì—ë””í„°ì— ë°˜ì˜
                    document.getElementById('generated-content').value = improvedContent;

                    // ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
                    updateContentPreview(improvedContent);

                    showAlert('success', `${category} ê°œì„ ì‚¬í•­ì´ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!`);

                    // ì ìš©ëœ ì œì•ˆì‚¬í•­ ë²„íŠ¼ ë¹„í™œì„±í™”
                    const button = event.target.closest('.btn');
                    if (button) {
                        button.disabled = true;
                        button.innerHTML = '<i class="bi bi-check-circle me-1"></i>ì ìš©ë¨';
                        button.classList.remove('btn-outline-primary');
                        button.classList.add('btn-success');
                    }
                } else {
                    showAlert('danger', 'ì½˜í…ì¸  ê°œì„ ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì œì•ˆì‚¬í•­ ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
                showAlert('danger', 'ì œì•ˆì‚¬í•­ ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì œì•ˆì‚¬í•­ì— ë”°ë¥¸ ì½˜í…ì¸  ê°œì„  í•¨ìˆ˜
        async function improveContentWithSuggestion(content, action, suggestion) {
            try {
                const requestData = {
                    content: content,
                    action: action,
                    suggestion: suggestion,
                    keywords: getCurrentKeywords()
                };

                const response = await fetch('/api/v1/improve-content-suggestion', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                return result.improved_content;
            } catch (error) {
                console.error('ì½˜í…ì¸  ê°œì„  ìš”ì²­ ì¤‘ ì˜¤ë¥˜:', error);

                // API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ê°œì„  ì‹œë„
                return applyLocalImprovement(content, action, suggestion);
            }
        }

        // ë¡œì»¬ ê°œì„  í•¨ìˆ˜ (API ì‹¤íŒ¨ ì‹œ ëŒ€ì²´)
        function applyLocalImprovement(content, action, suggestion) {
            let improvedContent = content;

            switch (action) {
                case 'addHeadings':
                    improvedContent = addHeadingsToContent(content);
                    break;
                case 'addFAQ':
                    improvedContent = addFAQToContent(content);
                    break;
                case 'addSources':
                    improvedContent = addSourcesToContent(content);
                    break;
                case 'expandContent':
                    improvedContent = expandContent(content);
                    break;
                case 'addBalance':
                    improvedContent = addBalanceToContent(content);
                    break;
                case 'addStructuredData':
                    improvedContent = addStructuredDataToContent(content);
                    break;
                default:
                    return content;
            }

            return improvedContent;
        }

        // í—¤ë”© êµ¬ì¡° ì¶”ê°€
        function addHeadingsToContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            // ì²« ë²ˆì§¸ p íƒœê·¸ë¥¼ h2ë¡œ ë³€ê²½
            htmlContent = htmlContent.replace(/<p>([^<]+)<\/p>/i, '<h2>$1</h2>');

            // ì£¼ìš” ì„¹ì…˜ì— h3 íƒœê·¸ ì¶”ê°€
            htmlContent = htmlContent.replace(/<p><strong>([^<]+)<\/strong>/g, '<h3>$1</h3>');

            return content.replace(htmlMatch[0], '```html\n' + htmlContent + '\n```');
        }

        // FAQ ì„¹ì…˜ ì¶”ê°€
        function addFAQToContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            const faqSection =
                '<h2>ìì£¼ ë¬»ëŠ” ì§ˆë¬¸ (FAQ)</h2>' +
                '<div class="faq-section">' +
                '<h3>Q: ì´ ì£¼ì œì— ëŒ€í•´ ê°€ì¥ ë§ì´ ë¬»ëŠ” ì§ˆë¬¸ì€ ë¬´ì—‡ì¸ê°€ìš”?</h3>' +
                '<p>A: ì´ ì£¼ì œì— ëŒ€í•´ ë…ìë“¤ì´ ê°€ì¥ ê¶ê¸ˆí•´í•˜ëŠ” ë¶€ë¶„ì— ëŒ€í•œ ë‹µë³€ì„ ì œê³µí•©ë‹ˆë‹¤.</p>' +
                '<h3>Q: ì‹¤ì œ ì ìš© ì‹œ ì£¼ì˜ì‚¬í•­ì€ ë¬´ì—‡ì¸ê°€ìš”?</h3>' +
                '<p>A: ì‹¤ì œ ì‚¬ìš© ì‹œ ê³ ë ¤í•´ì•¼ í•  ì¤‘ìš”í•œ ì‚¬í•­ë“¤ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</p>' +
                '<h3>Q: ì¶”ê°€ë¡œ ì•Œì•„ë‘ë©´ ì¢‹ì€ ì •ë³´ëŠ” ë¬´ì—‡ì¸ê°€ìš”?</h3>' +
                '<p>A: ë” ê¹Šì´ ìˆëŠ” ì´í•´ë¥¼ ìœ„í•œ ì¶”ê°€ ì •ë³´ë¥¼ ì œê³µí•©ë‹ˆë‹¤.</p>' +
                '</div>';

            // ê²°ë¡  ì„¹ì…˜ ì•ì— FAQ ì¶”ê°€
            htmlContent = htmlContent.replace(/<h2>ê²°ë¡ <\/h2>/i, faqSection + '\n\n<h2>ê²°ë¡ </h2>');

            return content.replace(htmlMatch[0], '```html\n' + htmlContent + '\n```');
        }

        // ì¶œì²˜ ì¸ìš© ì¶”ê°€
        function addSourcesToContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            const sourcesSection =
                '<h2>ì°¸ê³  ìë£Œ</h2>' +
                '<ul>' +
                '<li><a href="#" target="_blank" rel="noopener noreferrer">ê´€ë ¨ ì—°êµ¬ ìë£Œ</a></li>' +
                '<li><a href="#" target="_blank" rel="noopener noreferrer">ì „ë¬¸ê°€ ì˜ê²¬</a></li>' +
                '<li><a href="#" target="_blank" rel="noopener noreferrer">ê³µì‹ ë¬¸ì„œ</a></li>' +
                '</ul>';

            // ê²°ë¡  ì„¹ì…˜ ì•ì— ì¶œì²˜ ì¶”ê°€
            htmlContent = htmlContent.replace(/<h2>ê²°ë¡ <\/h2>/i, sourcesSection + '\n\n<h2>ê²°ë¡ </h2>');

            return content.replace(htmlMatch[0], '```html\n' + htmlContent + '\n```');
        }

        // ì½˜í…ì¸  í™•ì¥
        function expandContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            // ê° ì„¹ì…˜ì— ë” ìƒì„¸í•œ ë‚´ìš© ì¶”ê°€
            htmlContent = htmlContent.replace(/<p>([^<]+)<\/p>/g, (match, text) => {
                if (text.length < 100) {
                    return `<p>${text}</p><p>ì´ì— ëŒ€í•œ ì¶”ê°€ì ì¸ ì„¤ëª…ê³¼ êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ í†µí•´ ë” ê¹Šì´ ìˆëŠ” ì´í•´ë¥¼ ë•ìŠµë‹ˆë‹¤. ì‹¤ì œ ì ìš© ì‚¬ë¡€ì™€ í•¨ê»˜ ë‹¨ê³„ë³„ ê°€ì´ë“œë¥¼ ì œê³µí•˜ì—¬ ë…ìë“¤ì´ ì‰½ê²Œ ë”°ë¼í•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>`;
                }
                return match;
            });

            return content.replace(htmlMatch[0], `\`\`\`html\n${htmlContent}\n\`\`\``);
        }

        // ê· í˜• ì¡íŒ ê´€ì  ì¶”ê°€
        function addBalanceToContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            const balanceSection = `
                <h2>ê³ ë ¤ì‚¬í•­ ë° ì£¼ì˜ì‚¬í•­</h2>
                <div class="balance-section">
                    <h3>ì¥ì </h3>
                    <ul>
                        <li>íš¨ê³¼ì ì¸ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>ì‹œê°„ê³¼ ë¹„ìš©ì„ ì ˆì•½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>ì²´ê³„ì ì¸ ì ‘ê·¼ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤</li>
                    </ul>
                    
                    <h3>ë‹¨ì  ë° ì£¼ì˜ì‚¬í•­</h3>
                    <ul>
                        <li>ì´ˆê¸° ì„¤ì •ì— ì‹œê°„ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>ì§€ì†ì ì¸ ëª¨ë‹ˆí„°ë§ì´ í•„ìš”í•©ë‹ˆë‹¤</li>
                        <li>ì‹œì¥ ë³€í™”ì— ë”°ë¥¸ ì¡°ì •ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                    </ul>
                </div>
            `;

            // ê²°ë¡  ì„¹ì…˜ ì•ì— ê· í˜• ì„¹ì…˜ ì¶”ê°€
            htmlContent = htmlContent.replace(/<h2>ê²°ë¡ <\/h2>/i, `${balanceSection}\n\n<h2>ê²°ë¡ </h2>`);

            return content.replace(htmlMatch[0], `\`\`\`html\n${htmlContent}\n\`\`\``);
        }

        // êµ¬ì¡°í™” ë°ì´í„° ì¶”ê°€
        function addStructuredDataToContent(content) {
            const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
            if (!htmlMatch) return content;

            let htmlContent = htmlMatch[1];

            // JSON-LD êµ¬ì¡°í™” ë°ì´í„° ì¶”ê°€ (JavaScript ì‹¤í–‰ì„ í”¼í•˜ê¸° ìœ„í•´ ë¬¸ìì—´ë¡œ ì²˜ë¦¬)
            const currentDate = new Date().toISOString();
            const structuredData =
                '<script type="application/ld+json">' +
                '{' +
                '"@context": "https://schema.org",' +
                '"@type": "Article",' +
                '"headline": "í˜ì´ì§€ ì œëª©",' +
                '"description": "í˜ì´ì§€ ì„¤ëª…",' +
                '"author": {' +
                '"@type": "Person",' +
                '"name": "ì‘ì„±ì"' +
                '},' +
                '"publisher": {' +
                '"@type": "Organization",' +
                '"name": "ë°œí–‰ì²˜"' +
                '},' +
                '"datePublished": "' + currentDate + '",' +
                '"dateModified": "' + currentDate + '"' +
                '}' +
                '<\\/script>';

            // head íƒœê·¸ê°€ ìˆìœ¼ë©´ ê·¸ ì•ˆì—, ì—†ìœ¼ë©´ body ì‹œì‘ ë¶€ë¶„ì— ì¶”ê°€
            if (htmlContent.includes('<head>')) {
                htmlContent = htmlContent.replace(/<head>/i, '<head>' + structuredData);
            } else {
                htmlContent = structuredData + htmlContent;
            }

            return content.replace(htmlMatch[0], '```html\n' + htmlContent + '\n```');
        }

        // í˜„ì¬ í‚¤ì›Œë“œ ê°€ì ¸ì˜¤ê¸°
        function getCurrentKeywords() {
            const keywordsInput = document.getElementById('keywords');
            return keywordsInput ? keywordsInput.value : '';
        }

        // ì½˜í…ì¸  ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateContentPreview(content) {
            const previewElement = document.getElementById('content-preview');
            if (previewElement && content) {
                // HTML ë¸”ë¡ì—ì„œ ì‹¤ì œ ì½˜í…ì¸  ì¶”ì¶œ
                const htmlMatch = content.match(/```html\s*([\s\S]*?)\s*```/i);
                if (htmlMatch) {
                    previewElement.innerHTML = htmlMatch[1];
                } else {
                    previewElement.innerHTML = content;
                }
            }
        }

        // í˜„ì¬ ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
        let currentGeneratedContent = null;

        function applyComplianceSuggestions() {
            if (!currentComplianceAnalysis) {
                showAlert('info', 'ì ìš©í•  ì¤€ìˆ˜ë„ ë¶„ì„ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            try {
                // ëª¨ë‹¬ ë‹«ê¸° (ì•ˆì „í•œ ë°©ì‹)
                const modalElement = document.getElementById('complianceGuideModal');
                const modal = bootstrap.Modal.getInstance(modalElement);
                if (modal) {
                    modal.hide();
                }

                // ê°œì„  ì œì•ˆ ì ìš© ì‹œì‘
                showAlert('info', 'ê°œì„  ì œì•ˆì„ ì ìš©í•˜ì—¬ ì½˜í…ì¸ ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...');

                // ë©”ì‹œì§€ ì±„ë„ ì¶©ëŒ ë°©ì§€ë¥¼ ìœ„í•œ ì§€ì—° ì²˜ë¦¬
                setTimeout(() => {
                    improveContentWithSuggestions().catch(error => {
                        console.error('ì½˜í…ì¸  ê°œì„  ì¤‘ ì˜¤ë¥˜:', error);
                        if (error.name !== 'AbortError') {
                            showAlert('danger', 'ì½˜í…ì¸  ê°œì„  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                        }
                    });
                }, 200);

            } catch (error) {
                console.error('ì¤€ìˆ˜ë„ ì œì•ˆ ì ìš© ì¤‘ ì˜¤ë¥˜:', error);
                showAlert('danger', 'ì¤€ìˆ˜ë„ ì œì•ˆ ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        async function improveContentWithSuggestions() {
            const progressContainer = document.getElementById('progress-container');
            const progressBar = document.getElementById('progress-bar');
            const progressMessage = document.getElementById('progress-message');

            // ì§„í–‰ ìƒí™© í‘œì‹œ (null ì²´í¬ í¬í•¨)
            if (progressContainer) {
                progressContainer.style.display = 'block';
                if (progressBar) {
                    progressBar.style.width = '25%';
                }
                if (progressMessage) {
                    progressMessage.textContent = 'ê°œì„  ì œì•ˆ ë¶„ì„ ì¤‘...';
                }
            }

            try {
                // ê°œì„  ì œì•ˆ ìƒì„±
                const suggestions = generateImprovementSuggestions(currentComplianceAnalysis);

                if (progressContainer) {
                    if (progressBar) {
                        progressBar.style.width = '50%';
                    }
                    if (progressMessage) {
                        progressMessage.textContent = 'ì½˜í…ì¸  ê°œì„  ì¤‘...';
                    }
                }

                // AIë¥¼ í†µí•œ ì½˜í…ì¸  ê°œì„  (AbortController ì‚¬ìš©)
                const improvementResult = await improveContentWithAI(currentGeneratedContent, suggestions);

                if (progressContainer) {
                    if (progressBar) {
                        progressBar.style.width = '75%';
                    }
                    if (progressMessage) {
                        progressMessage.textContent = 'ê°œì„ ëœ ì½˜í…ì¸  ì ìš© ì¤‘...';
                    }
                }

                // ê°œì„ ëœ ì½˜í…ì¸ ë¡œ UI ì—…ë°ì´íŠ¸
                updateContentWithImprovements(improvementResult.improved_content, improvementResult);

                if (progressContainer) {
                    if (progressBar) {
                        progressBar.style.width = '100%';
                    }
                    if (progressMessage) {
                        progressMessage.textContent = 'ê°œì„  ì™„ë£Œ!';
                    }

                    setTimeout(() => {
                        progressContainer.style.display = 'none';
                    }, 2000);
                }

                // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
                if (improvementResult.fallback) {
                    showAlert('warning', 'AI ê°œì„ ì´ ì‹¤íŒ¨í•˜ì—¬ ë¡œì»¬ ê°œì„ ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.');
                } else {
                    showAlert('success', 'ì½˜í…ì¸ ê°€ ê°œì„  ì œì•ˆì— ë”°ë¼ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
                }

            } catch (error) {
                console.error('ì½˜í…ì¸  ê°œì„  ì¤‘ ì˜¤ë¥˜:', error);

                // ì§„í–‰ ìƒí™© ìˆ¨ê¸°ê¸°
                if (progressContainer) {
                    progressContainer.style.display = 'none';
                }

                // ì‚¬ìš©ìì—ê²Œ ì˜¤ë¥˜ ì•Œë¦¼
                if (error.name === 'AbortError') {
                    showAlert('warning', 'ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì–´ ë¡œì»¬ ê°œì„ ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.');
                } else {
                    showAlert('danger', 'ì½˜í…ì¸  ê°œì„  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                }
            }
        }

        function generateImprovementSuggestions(analysis) {
            const suggestions = [];

            // ê¸¸ì´ ê´€ë ¨ ì œì•ˆ
            if (analysis.contentLength < 1500) {
                suggestions.push({
                    type: 'length',
                    priority: 'ë†’ìŒ',
                    title: 'ì½˜í…ì¸  ê¸¸ì´ ë¶€ì¡±',
                    description: 'ì½˜í…ì¸  ê¸¸ì´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ë” ìƒì„¸í•œ ì„¤ëª…ê³¼ ì˜ˆì‹œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.',
                    action: 'expand_content'
                });
            }

            // AI SEO ê´€ë ¨ ì œì•ˆ
            if (!analysis.aiSeoCompliance) {
                suggestions.push({
                    type: 'ai_seo',
                    priority: 'ë†’ìŒ',
                    title: 'AI SEO ìµœì í™” ë¶€ì¡±',
                    description: 'AI SEO ìµœì í™”ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í‚¤ì›Œë“œ ë°€ë„ì™€ êµ¬ì¡°ë¥¼ ê°œì„ í•˜ì„¸ìš”.',
                    action: 'optimize_seo'
                });
            }

            // GEO ê´€ë ¨ ì œì•ˆ
            if (!analysis.geoCompliance) {
                suggestions.push({
                    type: 'geo',
                    priority: 'ë†’ìŒ',
                    title: 'GEO ìµœì í™” ë¶€ì¡±',
                    description: 'ìƒì„±í˜• AI ì—”ì§„ ìµœì í™”(GEO) ìš”ì†Œê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ì½˜í…ì¸ ì™€ ê¶Œìœ„ ì‹ í˜¸ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.',
                    action: 'add_geo_context'
                });
            }

            // ì •ì±… ê· í˜• ê´€ë ¨ ì œì•ˆ
            if (!analysis.policyBalanceCompliance) {
                suggestions.push({
                    type: 'balance',
                    priority: 'ë†’ìŒ',
                    title: 'ê· í˜• ì¡íŒ ê´€ì  ë¶€ì¡±',
                    description: 'ê· í˜• ì¡íŒ ê´€ì ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. ì¥ë‹¨ì ê³¼ ê³ ë ¤ì‚¬í•­ì„ ì¶”ê°€í•˜ì„¸ìš”.',
                    action: 'add_balanced_perspective'
                });
            }

            return suggestions;
        }

        async function improveContentWithAI(originalContent, suggestions) {
            // ê°œì„  ì œì•ˆì„ í”„ë¡¬í”„íŠ¸ë¡œ ë³€í™˜
            const improvementPrompt = createImprovementPrompt(originalContent, suggestions);

            // AbortControllerë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì²­ ì·¨ì†Œ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸°
            const controller = new AbortController();
            const timeoutId = setTimeout(() => controller.abort(), 30000); // 30ì´ˆ íƒ€ì„ì•„ì›ƒ

            try {
                const response = await fetch('/api/v1/improve-content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        original_content: originalContent,
                        suggestions: suggestions,
                        improvement_prompt: improvementPrompt
                    }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                return result;

            } catch (error) {
                clearTimeout(timeoutId);

                // AbortErrorì¸ ê²½ìš° ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                if (error.name === 'AbortError') {
                    console.warn('ìš”ì²­ì´ íƒ€ì„ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œì»¬ ê°œì„ ì„ ì ìš©í•©ë‹ˆë‹¤.');
                } else {
                    console.error('AI ê°œì„  ìš”ì²­ ì‹¤íŒ¨:', error);
                }

                // AI ê°œì„  ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ê°œì„  ì ìš©
                const improvedContent = applyLocalImprovements(originalContent, suggestions);
                return {
                    improved_content: improvedContent,
                    original_analysis: { content_length: 0, length_compliant: false, ai_seo_compliant: false, geo_compliant: false, policy_balance_compliant: false, has_headings: false, has_keywords: false, has_links: false, has_images: false, has_structured_data: false },
                    improved_analysis: { content_length: improvedContent.length, length_compliant: improvedContent.length >= 1500, ai_seo_compliant: false, geo_compliant: false, policy_balance_compliant: false, has_headings: false, has_keywords: false, has_links: false, has_images: false, has_structured_data: false },
                    improvements: [],
                    fallback: true
                };
            }
        }

        function createImprovementPrompt(originalContent, suggestions) {
            let prompt = `ë‹¤ìŒ ì½˜í…ì¸ ë¥¼ ê°œì„ í•´ì£¼ì„¸ìš”:\n\n${originalContent}\n\nê°œì„  ìš”ì²­ì‚¬í•­:\n`;

            suggestions.forEach((suggestion, index) => {
                prompt += `${index + 1}. ${suggestion.description}\n`;
            });

            prompt += `\nìš”êµ¬ì‚¬í•­:\n- ì›ë³¸ ì½˜í…ì¸ ì˜ í•µì‹¬ ë‚´ìš©ì€ ìœ ì§€í•˜ì„¸ìš”\n- ìì—°ìŠ¤ëŸ½ê³  ì½ê¸° ì‰½ê²Œ ê°œì„ í•˜ì„¸ìš”\n- HTML íƒœê·¸ëŠ” ìœ ì§€í•˜ì„¸ìš”\n- ê°œì„ ëœ ì½˜í…ì¸ ë§Œ ë°˜í™˜í•˜ì„¸ìš”`;

            return prompt;
        }

        function applyLocalImprovements(originalContent, suggestions) {
            let improvedContent = originalContent;

            suggestions.forEach(suggestion => {
                switch (suggestion.action) {
                    case 'expand_content':
                        improvedContent = expandContent(improvedContent);
                        break;
                    case 'optimize_seo':
                        improvedContent = optimizeSEO(improvedContent);
                        break;
                    case 'add_geo_context':
                        improvedContent = addGeoContext(improvedContent);
                        break;
                    case 'add_balanced_perspective':
                        improvedContent = addBalancedPerspective(improvedContent);
                        break;
                }
            });

            return improvedContent;
        }

        function expandContent(content) {
            // ì½˜í…ì¸  í™•ì¥ ë¡œì§
            const expansionTexts = [
                'ë” ìì„¸í•œ ì„¤ëª…ì„ ìœ„í•´ ì¶”ê°€ ì •ë³´ë¥¼ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.',
                'ì´ëŸ¬í•œ ë³€í™”ì˜ ë°°ê²½ê³¼ ì˜ë¯¸ë¥¼ ë” ê¹Šì´ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.',
                'ì‹¤ì œ ì‚¬ë¡€ì™€ ë°ì´í„°ë¥¼ í†µí•´ ë” êµ¬ì²´ì ìœ¼ë¡œ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.'
            ];

            // ë³¸ë¬¸ ì¤‘ê°„ì— í™•ì¥ í…ìŠ¤íŠ¸ ì¶”ê°€
            const paragraphs = content.split('</p>');
            if (paragraphs.length > 2) {
                const middleIndex = Math.floor(paragraphs.length / 2);
                paragraphs.splice(middleIndex, 0, `<p>${expansionTexts[Math.floor(Math.random() * expansionTexts.length)]}</p>`);
            }

            return paragraphs.join('</p>');
        }

        function optimizeSEO(content) {
            // SEO ìµœì í™” ë¡œì§
            // í‚¤ì›Œë“œ ê°•í™”, í—¤ë”© êµ¬ì¡° ê°œì„  ë“±
            return content.replace(
                /<h1[^>]*>(.*?)<\/h1>/gi,
                '<h1>$1 - ìµœì‹  íŠ¸ë Œë“œì™€ ì¸ì‚¬ì´íŠ¸</h1>'
            );
        }

        function addGeoContext(content) {
            // GEO ìµœì í™” ìš”ì†Œ ì¶”ê°€
            const geoContext = `
            <h3>ìƒì„±í˜• AI ì—”ì§„ ìµœì í™” (GEO) ê´€ì </h3>
            <p>ì´ëŸ¬í•œ ë³€í™”ëŠ” ìƒì„±í˜• AI ì—”ì§„ì´ ì½˜í…ì¸ ë¥¼ ë” íš¨ê³¼ì ìœ¼ë¡œ ì´í•´í•˜ê³  í™œìš©í•  ìˆ˜ ìˆë„ë¡ ìµœì í™”í•˜ëŠ” ì¤‘ìš”í•œ ìš”ì†Œì…ë‹ˆë‹¤. êµ¬ì¡°í™”ëœ ì •ë³´ì™€ ëª…í™•í•œ ë‹µë³€ì„ ì œê³µí•¨ìœ¼ë¡œì¨ AI ì‹œìŠ¤í…œì´ ì´ ì½˜í…ì¸ ë¥¼ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì¶œì²˜ë¡œ ì¸ì‹í•˜ê²Œ ë©ë‹ˆë‹¤.</p>
            
            <h4>GEO ìµœì í™” ìš”ì†Œ:</h4>
            <ul>
                <li><strong>êµ¬ì¡°í™”ëœ ì½˜í…ì¸ :</strong> ëª…í™•í•œ í—¤ë”©ê³¼ ë¦¬ìŠ¤íŠ¸ë¥¼ í†µí•œ ì •ë³´ ê³„ì¸µí™”</li>
                <li><strong>ê¶Œìœ„ ì‹ í˜¸:</strong> ì „ë¬¸ì ì´ê³  ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì •ë³´ ì œê³µ</li>
                <li><strong>ëª…í™•í•œ ë‹µë³€:</strong> ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ì§ì ‘ì ì´ê³  ì •í™•í•œ ë‹µë³€</li>
            </ul>
            `;

            // ë³¸ë¬¸ ë ë¶€ë¶„ì— ì¶”ê°€
            return content.replace('</div>', `${geoContext}</div>`);
        }

        function addBalancedPerspective(content) {
            // ê· í˜• ì¡íŒ ê´€ì  ì¶”ê°€
            const balanceText = '<p>ì´ëŸ¬í•œ ë³€í™”ì—ëŠ” ì¥ì ê³¼ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•  ì¸¡ë©´ë“¤ì´ ìˆìŠµë‹ˆë‹¤. ì‚¬ìš©ì ê°œì¸ì •ë³´ ë³´í˜¸ ì¸¡ë©´ì—ì„œëŠ” ê¸ì •ì ì´ì§€ë§Œ, êµ¬í˜„ ê³¼ì •ì—ì„œì˜ ê¸°ìˆ ì  ì–´ë ¤ì›€ê³¼ ë¹„ìš© ë¬¸ì œë„ í•¨ê»˜ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.</p>';

            // ë³¸ë¬¸ ë ë¶€ë¶„ì— ì¶”ê°€
            return content.replace('</div>', `${balanceText}</div>`);
        }

        function updateContentWithImprovements(improvedContent, improvementData) {
            const resultDiv = document.getElementById('result-container');

            // ê°œì„ ëœ ì½˜í…ì¸ ë¡œ ì—…ë°ì´íŠ¸
            if (resultDiv) {
                // HTML ì½”ë“œ ë¸”ë¡ ì œê±° ë° ì‹¤ì œ HTML ì½˜í…ì¸  ì¶”ì¶œ
                const cleanedContent = extractHtmlContent(improvedContent);

                // ê¸°ì¡´ ì½˜í…ì¸ ë¥¼ ê°œì„ ëœ ì½˜í…ì¸ ë¡œ êµì²´
                const contentSections = resultDiv.querySelectorAll('.content-section');
                contentSections.forEach(section => {
                    const mainContent = section.querySelector('.main-content-text');
                    if (mainContent) {
                        mainContent.innerHTML = cleanedContent;
                    }
                });

                // ê°œì„  ê²°ê³¼ í‘œì‹œ
                displayImprovementResults(improvementData);

                // ì¤€ìˆ˜ë„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                updateComplianceScore(improvementData);
            }
        }

        function updateComplianceScore(improvementData) {
            const complianceScore = document.getElementById('guidelines-compliance-score');
            const complianceProgress = document.getElementById('compliance-progress');
            const compliancePercentage = document.getElementById('compliance-percentage');
            const appliedResults = document.getElementById('applied-results');

            if (improvementData && improvementData.improved_analysis) {
                const improvedAnalysis = improvementData.improved_analysis;
                const improvedScore = calculateComplianceScore(improvedAnalysis);

                // ì¤€ìˆ˜ë„ ì ìˆ˜ ì—…ë°ì´íŠ¸
                if (complianceScore) complianceScore.textContent = `ì¤€ìˆ˜ë„: ${improvedScore}%`;
                if (complianceProgress) complianceProgress.style.width = `${improvedScore}%`;
                if (compliancePercentage) compliancePercentage.textContent = `${improvedScore}%`;

                // ì ìš© ê²°ê³¼ ì—…ë°ì´íŠ¸
                if (appliedResults) {
                    const analysisResults = [];

                    // ê¸¸ì´ ì¤€ìˆ˜ë„
                    if (improvedAnalysis.content_length >= 1500) {
                        analysisResults.push(`<div class="result-item result-success">
                            <span class="result-icon">âœ…</span>
                            <span class="result-text">ê¸¸ì´ ì¤€ìˆ˜ (${improvedAnalysis.content_length}ì)</span>
                        </div>`);
                    } else if (improvedAnalysis.content_length > 0) {
                        analysisResults.push(`<div class="result-item result-warning">
                            <span class="result-icon">âš ï¸</span>
                            <span class="result-text">ê¸¸ì´ ë¶€ë¶„ ì¤€ìˆ˜ (${improvedAnalysis.content_length}ì)</span>
                        </div>`);
                    } else {
                        analysisResults.push(`<div class="result-item result-danger">
                            <span class="result-icon">âŒ</span>
                            <span class="result-text">ê¸¸ì´ ë¯¸ì¤€ìˆ˜ (${improvedAnalysis.content_length}ì)</span>
                        </div>`);
                    }

                    // AI SEO ì¤€ìˆ˜ë„
                    if (improvedAnalysis.ai_seo_compliant) {
                        analysisResults.push(`<div class="result-item result-success">
                            <span class="result-icon">âœ…</span>
                            <span class="result-text">AI SEO ì¤€ìˆ˜</span>
                        </div>`);
                    } else {
                        analysisResults.push(`<div class="result-item result-warning">
                            <span class="result-icon">âš ï¸</span>
                            <span class="result-text">AI SEO ë¶€ë¶„ ì¤€ìˆ˜</span>
                        </div>`);
                    }

                    // GEO ì¤€ìˆ˜ë„
                    if (improvedAnalysis.geo_compliant) {
                        analysisResults.push(`<div class="result-item result-success">
                            <span class="result-icon">âœ…</span>
                            <span class="result-text">GEO ì¤€ìˆ˜</span>
                        </div>`);
                    } else {
                        analysisResults.push(`<div class="result-item result-warning">
                            <span class="result-icon">âš ï¸</span>
                            <span class="result-text">GEO ë¶€ë¶„ ì¤€ìˆ˜</span>
                        </div>`);
                    }

                    // ì •ì±… ê· í˜• ì¤€ìˆ˜ë„
                    if (improvedAnalysis.policy_balance_compliant) {
                        analysisResults.push(`<div class="result-item result-success">
                            <span class="result-icon">âœ…</span>
                            <span class="result-text">ì •ì±… ê· í˜• ì¤€ìˆ˜</span>
                        </div>`);
                    } else {
                        analysisResults.push(`<div class="result-item result-danger">
                            <span class="result-icon">âŒ</span>
                            <span class="result-text">ì •ì±… ê· í˜• ë¯¸ì¤€ìˆ˜</span>
                        </div>`);
                    }

                    // ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ì¤€ìˆ˜ë„
                    if (improvedAnalysis.has_headings && improvedAnalysis.has_keywords) {
                        analysisResults.push(`<div class="result-item result-success">
                            <span class="result-icon">âœ…</span>
                            <span class="result-text">ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ì¤€ìˆ˜</span>
                        </div>`);
                    } else {
                        analysisResults.push(`<div class="result-item result-warning">
                            <span class="result-icon">âš ï¸</span>
                            <span class="result-text">ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ë¶€ë¶„ ì¤€ìˆ˜</span>
                        </div>`);
                    }

                    appliedResults.innerHTML = analysisResults.join('');
                }

                console.log('ì¤€ìˆ˜ë„ ì ìˆ˜ ë° ì ìš© ê²°ê³¼ ì—…ë°ì´íŠ¸:', improvedScore);
            }
        }

        // ìƒì„¸ ì¤€ìˆ˜ë„ ë¶„ì„ í…Œì´ë¸” í–‰ ìƒì„± í•¨ìˆ˜
        function createComplianceDetailRows(original, improved) {
            const items = [
                {
                    name: 'ì½˜í…ì¸  ê¸¸ì´',
                    value: improved.content_length || 0,
                    unit: 'ì',
                    threshold: 1500,
                    description: '1500ì ì´ìƒ ê¶Œì¥'
                },
                {
                    name: 'AI SEO ìµœì í™”',
                    value: improved.ai_seo_compliant || false,
                    unit: '',
                    threshold: true,
                    description: 'í‚¤ì›Œë“œ ë°€ë„ ë° êµ¬ì¡° ìµœì í™”'
                },
                {
                    name: 'GEO ì¤€ìˆ˜ë„',
                    value: improved.geo_compliant || false,
                    unit: '',
                    threshold: true,
                    description: 'ìƒì„±í˜• AI ì—”ì§„ ìµœì í™”'
                },
                {
                    name: 'ì •ì±… ê· í˜•',
                    value: improved.policy_balance_compliant || false,
                    unit: '',
                    threshold: true,
                    description: 'ì¥ë‹¨ì  ê· í˜• ìˆëŠ” ì„œìˆ '
                },
                {
                    name: 'êµ¬ì¡°í™”',
                    value: improved.has_headings || false,
                    unit: '',
                    threshold: true,
                    description: 'í—¤ë”© êµ¬ì¡° ë° í‚¤ì›Œë“œ í¬í•¨'
                }
            ];

            let html = '';
            items.forEach(item => {
                // ì ìš© ì—¬ë¶€ ê²°ì • (O/X)
                const isApplied = item.unit ?
                    (item.value >= item.threshold) :
                    (item.value === true);

                // ì¤€ìˆ˜ ìƒíƒœ ê²°ì •
                const complianceStatus = item.unit ?
                    (item.value >= item.threshold ? 'success' : 'danger') :
                    (item.value ? 'success' : 'danger');

                const appliedText = isApplied ? 'O' : 'X';
                const appliedClass = isApplied ? 'success' : 'danger';

                const complianceText = item.unit ?
                    (item.value >= item.threshold ? 'ì¤€ìˆ˜' : 'ë¯¸ì¤€ìˆ˜') :
                    (item.value ? 'ì¤€ìˆ˜' : 'ë¯¸ì¤€ìˆ˜');

                const complianceIcon = item.unit ?
                    (item.value >= item.threshold ? 'âœ…' : 'âŒ') :
                    (item.value ? 'âœ…' : 'âŒ');

                html +=
                    '<tr>' +
                    '<td>' +
                    '<div class="fw-bold">' + item.name + '</div>' +
                    '<small class="text-muted">' + item.description + '</small>' +
                    '</td>' +
                    '<td class="text-center">' +
                    '<span class="badge bg-' + appliedClass + ' fs-6 fw-bold">' + appliedText + '</span>' +
                    '</td>' +
                    '<td class="text-center">' +
                    '<div class="d-flex align-items-center justify-content-center">' +
                    '<span class="me-2">' + complianceIcon + '</span>' +
                    '<span class="badge bg-' + complianceStatus + '">' + complianceText + '</span>' +
                    '</div>' +
                    '</td>' +
                    '</tr>';
            });

            return html;
        }

        function displayImprovementResults(improvementData) {
            const resultDiv = document.getElementById('result-container');

            // ê¸°ì¡´ ê°œì„  í‘œì‹œ ì œê±°
            const existingImprovement = resultDiv.querySelector('.improvement-results');
            if (existingImprovement) {
                existingImprovement.remove();
            }

            // ê°œì„  ê²°ê³¼ ì»¨í…Œì´ë„ˆ ìƒì„±
            const improvementContainer = document.createElement('div');
            improvementContainer.className = 'improvement-results mt-4';

            // ì¤€ìˆ˜ë„ ì ìˆ˜ ë³€ê²½ í‘œì‹œ
            const scoreChangeSection = createScoreChangeSection(improvementData);
            improvementContainer.appendChild(scoreChangeSection);

            // ê°œì„  ì‚¬í•­ ëª©ë¡ í‘œì‹œ
            const improvementsSection = createImprovementsSection(improvementData);
            improvementContainer.appendChild(improvementsSection);

            // AI ë¶„ì„ ì˜ì—­ ìœ„ì— ì‚½ì…
            const aiAnalysisSection = resultDiv.querySelector('.ai-analysis-section');
            if (aiAnalysisSection) {
                aiAnalysisSection.parentNode.insertBefore(improvementContainer, aiAnalysisSection);
            } else {
                resultDiv.appendChild(improvementContainer);
            }
        }

        function createScoreChangeSection(improvementData) {
            const original = improvementData.original_analysis;
            const improved = improvementData.improved_analysis;
            const originalScore = calculateComplianceScore(original);
            const improvedScore = calculateComplianceScore(improved);
            const scoreChange = improvedScore - originalScore;

            const section = document.createElement('div');
            section.className = 'card mb-3 border-success compliance-improvement-card';
            section.innerHTML = `
                <div class="card-header bg-success text-white">\
                    <h6 class="mb-0">\
                        <i class="bi bi-graph-up me-2"></i>\
                        ì¤€ìˆ˜ë„ ì ìˆ˜ ê°œì„  ê²°ê³¼\
                        <span id="score-change-badge" class="badge bg-light text-muted ms-2">ë³€í™” ì—†ìŒ</span>\
                    </h6>\
                </div>\
                <div class="card-body">\
                    <!-- ì ìˆ˜ ë¹„êµ ì„¹ì…˜ -->\
                    <div class="row mb-4">\
                        <div class="col-md-3">\
                            <div class="score-display">\
                                <div class="h6 text-muted mb-2">ì´ì „ ì ìˆ˜</div>\
                                <div id="score-original" class="h2 text-danger fw-bold">0%</div>\
                                <div class="small text-muted">ê°œì„  ì „</div>\
                            </div>\
                        </div>\
                        <div class="col-md-1 d-flex align-items-center justify-content-center">\
                            <div class="text-center">\
                                <i class="bi bi-arrow-right h3 text-success"></i>\
                                <div class="small text-muted mt-1">ê°œì„ </div>\
                            </div>\
                        </div>\
                        <div class="col-md-3">\
                            <div class="score-display">\
                                <div class="h6 text-muted mb-2">ì´í›„ ì ìˆ˜</div>\
                                <div id="score-improved" class="h2 text-success fw-bold">0%</div>\
                                <div class="small text-muted">ê°œì„  í›„</div>\
                            </div>\
                        </div>\
                        <div class="col-md-5">\
                            <div class="progress-comparison">\
                                <div class="d-flex justify-content-between mb-2">\
                                    <span class="small text-muted">ì´ì „</span>\
                                    <span class="small text-muted">ì´í›„</span>\
                                </div>\
                                <div class="progress mb-2" style="height: 12px;">\
                                    <div id="bar-original" class="progress-bar bg-danger"></div>\
                                </div>\
                                <div class="progress" style="height: 12px;">\
                                    <div id="bar-improved" class="progress-bar bg-success"></div>\
                                </div>\
                                <div class="mt-2">\
                                    <small id="score-change-text" class="text-muted"></small>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                    \n+                    <!-- ìƒì„¸ ë¶„ì„ ì„¹ì…˜ -->\
                    <div class="row">\
                        <div class="col-12">\
                            <h6 class="text-success mb-3">\
                                <i class="bi bi-bar-chart me-2"></i>ìƒì„¸ ì¤€ìˆ˜ë„ ë¶„ì„\
                            </h6>\
                            <div class="table-responsive">\
                                <table class="table table-sm table-bordered improvement-detail-table">\
                                    <thead class="table-light">\
                                        <tr>\
                                            <th>ì¤€ìˆ˜ í•­ëª©</th>\
                                            <th class="text-center">ì ìš© ì—¬ë¶€</th>\
                                            <th class="text-center">ì¤€ìˆ˜ ìƒíƒœ</th>\
                                        </tr>\
                                    </thead>\
                                    <tbody id="compliance-detail-rows">\
                                        <!-- ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->\
                                    </tbody>\
                                </table>\
                            </div>\
                        </div>\
                    </div>\
                </div>`;

            // ë™ì  ê°’ ì£¼ì…
            const scoreOriginalEl = section.querySelector('#score-original');
            const scoreImprovedEl = section.querySelector('#score-improved');
            const barOriginal = section.querySelector('#bar-original');
            const barImproved = section.querySelector('#bar-improved');
            const changeBadge = section.querySelector('#score-change-badge');
            const changeText = section.querySelector('#score-change-text');

            if (scoreOriginalEl) scoreOriginalEl.textContent = originalScore + '%';
            if (scoreImprovedEl) scoreImprovedEl.textContent = improvedScore + '%';
            if (barOriginal) barOriginal.style.width = originalScore + '%';
            if (barImproved) barImproved.style.width = improvedScore + '%';

            if (changeBadge) {
                if (scoreChange > 0) {
                    changeBadge.className = 'badge bg-light text-success ms-2';
                    changeBadge.textContent = '+' + scoreChange + '%';
                } else if (scoreChange < 0) {
                    changeBadge.className = 'badge bg-light text-danger ms-2';
                    changeBadge.textContent = '' + scoreChange + '%';
                } else {
                    changeBadge.className = 'badge bg-light text-muted ms-2';
                    changeBadge.textContent = 'ë³€í™” ì—†ìŒ';
                }
            }
            if (changeText) {
                changeText.textContent = scoreChange > 0 ? 'âœ… ê°œì„ ë¨' : scoreChange < 0 ? 'âš ï¸ ê°ì†Œí•¨' : 'â¡ï¸ ë³€í™” ì—†ìŒ';
            }

            // ìƒì„¸ ì¤€ìˆ˜ë„ ë¶„ì„ í…Œì´ë¸” í–‰ ìƒì„±
            const complianceDetailRows = section.querySelector('#compliance-detail-rows');
            if (complianceDetailRows) {
                complianceDetailRows.innerHTML = createComplianceDetailRows(original, improved);
            }

            return section;
        }

        function createImprovementsSection(improvementData) {
            const improvements = improvementData.improvements || [];
            const totalImprovements = improvements.length;

            const section = document.createElement('div');
            section.className = 'card border-info';

            const badgeHtml = totalImprovements > 0 ?
                '<span class="badge bg-light text-info ms-2">ì´ ' + totalImprovements + 'ê°œ ê°œì„ </span>' : '';

            const bodyContent = totalImprovements > 0 ?
                createDetailedImprovementsList(improvements) :
                createNoImprovementsMessage();

            section.innerHTML =
                '<div class="card-header bg-info text-white">' +
                '<h6 class="mb-0">' +
                '<i class="bi bi-list-check me-2"></i>' +
                'ê°œì„ ëœ ì‚¬í•­ (' + totalImprovements + 'ê°œ)' +
                badgeHtml +
                '</h6>' +
                '</div>' +
                '<div class="card-body">' +
                bodyContent +
                '</div>';

            return section;
        }

        function createDetailedImprovementsList(improvements) {
            let html = `
                <div class="row mb-3">
                    <div class="col-12">
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            <strong>ê°œì„  ìš”ì•½:</strong> ì´ ${improvements.length}ê°œ í•­ëª©ì´ ê°œì„ ë˜ì—ˆìŠµë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
                <div class="row">
            `;

            improvements.forEach((improvement, index) => {
                // ìš°ì„ ìˆœìœ„ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì„¤ì •
                const priority = improvement.priority || 'ë³´í†µ';
                const priorityClass = priority === 'ë†’ìŒ' ? 'border-danger' :
                    priority === 'ì¤‘ê°„' ? 'border-warning' : 'border-info';
                const priorityColor = priority === 'ë†’ìŒ' ? 'danger' :
                    priority === 'ì¤‘ê°„' ? 'warning' : 'info';

                html += `
                    <div class="col-md-6 mb-3">
                        <div class="card ${priorityClass} h-100 improvement-card">
                            <div class="card-header bg-light">
                                <div class="d-flex justify-content-between align-items-center">
                                    <h6 class="mb-0">
                                        <i class="bi bi-check-circle text-success me-2"></i>
                                        ${improvement.category || 'ê°œì„  ì‚¬í•­'}
                                    </h6>
                                    <span class="badge bg-${priorityColor}">${priority}</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <p class="card-text small text-muted mb-2">${improvement.description || 'ê°œì„ ì´ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.'}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="badge bg-success">${improvement.improvement || 'ê°œì„ ë¨'}</span>
                                    <small class="text-muted">#${index + 1}</small>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                </div>
                <div class="row mt-3">
                    <div class="col-12">
                        <div class="alert alert-success">
                            <i class="bi bi-lightbulb me-2"></i>
                            <strong>íŒ:</strong> ê°œì„ ëœ ì½˜í…ì¸ ëŠ” ë” ë‚˜ì€ SEO ì„±ê³¼ì™€ ì‚¬ìš©ì ê²½í—˜ì„ ì œê³µí•©ë‹ˆë‹¤.
                        </div>
                    </div>
                </div>
            `;

            return html;
        }

        function createNoImprovementsMessage() {
            return `
                <div class="text-center py-4">
                    <i class="bi bi-check-circle text-success" style="font-size: 3rem;"></i>
                    <h5 class="mt-3 text-muted">ê°œì„ ëœ ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤</h5>
                    <p class="text-muted">í˜„ì¬ ì½˜í…ì¸ ê°€ ì´ë¯¸ ìµœì í™”ë˜ì–´ ìˆì–´ ì¶”ê°€ ê°œì„ ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                    <div class="alert alert-light">
                        <i class="bi bi-info-circle me-2"></i>
                        ì½˜í…ì¸ ê°€ ì´ë¯¸ ë†’ì€ í’ˆì§ˆì„ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤.
                    </div>
                </div>
            `;
        }

        function showHelpModal() {
            const helpContent = `
                <div class="row">
                    <div class="col-12">
                        <h6 class="text-primary mb-3">
                            <i class="bi bi-lightbulb me-2"></i>ë¬¸ì œ í•´ê²° ê°€ì´ë“œ
                        </h6>
                        <div class="accordion" id="helpAccordion">
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#help1">
                                        API í‚¤ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤
                                    </button>
                                </h2>
                                <div id="help1" class="accordion-collapse collapse show" data-bs-parent="#helpAccordion">
                                    <div class="accordion-body">
                                        <p>API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
                                        <ul>
                                            <li>ê´€ë¦¬ìì—ê²Œ API í‚¤ ì„¤ì •ì„ ìš”ì²­í•˜ì„¸ìš”</li>
                                            <li>í™˜ê²½ ë³€ìˆ˜ íŒŒì¼(.env)ì„ í™•ì¸í•˜ì„¸ìš”</li>
                                            <li>API í‚¤ê°€ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help2">
                                        ë²ˆì—­ ì„œë¹„ìŠ¤ ì˜¤ë¥˜ê°€ ë°œìƒí•©ë‹ˆë‹¤
                                    </button>
                                </h2>
                                <div id="help2" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                    <div class="accordion-body">
                                        <p>ë²ˆì—­ ì„œë¹„ìŠ¤ì— ì¼ì‹œì ì¸ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                                        <ul>
                                            <li>ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”</li>
                                            <li>ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”</li>
                                            <li>ë‹¤ë¥¸ URLì´ë‚˜ í…ìŠ¤íŠ¸ë¡œ ì‹œë„í•´ë³´ì„¸ìš”</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#help3">
                                        ì½˜í…ì¸ ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤
                                    </button>
                                </h2>
                                <div id="help3" class="accordion-collapse collapse" data-bs-parent="#helpAccordion">
                                    <div class="accordion-body">
                                        <p>ìƒì„±ëœ ì½˜í…ì¸ ê°€ ìµœì†Œ ê¸¸ì´ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>
                                        <ul>
                                            <li>ë” ê¸´ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”</li>
                                            <li>ë‹¤ë¥¸ URLì„ ì‹œë„í•´ë³´ì„¸ìš”</li>
                                            <li>ì½˜í…ì¸  ê¸¸ì´ ì„¤ì •ì„ ì¡°ì •í•´ë³´ì„¸ìš”</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // ë„ì›€ë§ ëª¨ë‹¬ í‘œì‹œ
            const modal = new bootstrap.Modal(document.getElementById('analysisHelpModal'));
            document.getElementById('analysisHelpModalLabel').innerHTML = '<i class="bi bi-question-circle me-2"></i>ë¬¸ì œ í•´ê²° ë„ì›€ë§';
            document.getElementById('analysis-help-content').innerHTML = helpContent;
            modal.show();
        }

        function createImprovementsList(improvements) {
            let html = '<ul class="list-group list-group-flush">';

            improvements.forEach((improvement, index) => {
                html +=
                    '<li class="list-group-item d-flex justify-content-between align-items-start">' +
                    '<div class="ms-2 me-auto">' +
                    '<div class="fw-bold text-primary">' + improvement.category + '</div>' +
                    '<div class="text-muted small">' + improvement.description + '</div>' +
                    '</div>' +
                    '<span class="badge bg-success rounded-pill">' + improvement.improvement + '</span>' +
                    '</li>';
            });

            html += '</ul>';
            return html;
        }

        function calculateComplianceScore(analysis) {
            let score = 0;
            let total = 5; // ì´ 5ê°œ í•­ëª©

            if (analysis.length_compliant) score++;
            if (analysis.ai_seo_compliant) score++;
            if (analysis.geo_compliant) score++;
            if (analysis.policy_balance_compliant) score++;
            if (analysis.has_headings) score++;

            return Math.round((score / total) * 100);
        }

        function calculateComplianceRate(analysis) {
            let score = 0;
            let total = 5; // ì´ 5ê°œ í•­ëª©

            // ì½˜í…ì¸  ê¸¸ì´ ì¤€ìˆ˜ (1500ì ì´ìƒ)
            if (analysis.contentLength >= 1500) score++;

            // AI SEO ì¤€ìˆ˜
            if (analysis.aiSeoCompliance) score++;

            // GEO ì¤€ìˆ˜
            if (analysis.geoCompliance) score++;

            // ì •ì±… ê· í˜• ì¤€ìˆ˜
            if (analysis.policyBalanceCompliance) score++;

            // ë¸”ë¡œê·¸ ìŠ¤íƒ€ì¼ ì¤€ìˆ˜ (í—¤ë”©ê³¼ í‚¤ì›Œë“œ)
            if (analysis.hasHeadings && analysis.hasKeywords) score++;

            return Math.round((score / total) * 100);
        }

        // Enter í‚¤ë¡œ ìƒì„± ì‹œì‘
        document.getElementById('text_input').addEventListener('keydown', function (e) {
            if (e.key === 'Enter' && e.ctrlKey) {
                generateContent();
            }
        });
    </script>
</body>

</html>