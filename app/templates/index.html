<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI SEO Blog Post Generator</title>
    <!-- Bootstrap CSS & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/static/common.css">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+KR:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body, html { font-family: 'IBM Plex Sans KR', sans-serif !important; }
        body { background-color: #f8f9fa; }
        .container { max-width: 960px; }
        .card { margin-bottom: 1.5rem; }
        #result-container {
            border: 1px solid #dee2e6;
            border-radius: .375rem;
            padding: 1.5rem;
            background-color: #fff;
            min-height: 200px;
            max-height: 600px;
            overflow-y: auto;
        }
        .keyword-badge {
            margin-right: 5px;
            margin-bottom: 5px;
        }
        .progress-container {
            display: none;
            margin: 1rem 0;
        }
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 0.5rem;
            background-color: #e9ecef;
            border-radius: 0.375rem;
            margin: 0 0.25rem;
        }
        .step.active {
            background-color: #007bff;
            color: white;
        }
        .step.completed {
            background-color: #28a745;
            color: white;
        }
        .service-status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #28a745;
            box-shadow: 0 0 0 2px rgba(40, 167, 69, 0.3);
            animation: pulse 2s infinite;
        }
        .service-status-indicator.warning {
            background-color: #ffc107;
            box-shadow: 0 0 0 2px rgba(255, 193, 7, 0.3);
        }
        .service-status-indicator.danger {
            background-color: #dc3545;
            box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.3);
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
    </style>
</head>
<body>
    {% include '_navbar.html' %}
    <div class="container" style="padding-top: 84px; padding-bottom: 120px;">
        <div class="row mb-4 g-3 align-items-stretch">
            <div class="col-md-8">
                <div class="card h-100">
                    <div class="card-header bg-info text-white">
                        <a href="/admin#stats-panel" class="text-white text-decoration-underline" style="cursor:pointer;"><span style="font-size:1.1em;">ğŸ“Š</span> ëˆ„ì  í†µê³„</a>
                    </div>
                    <div class="card-body">
                        <table class="table table-bordered mb-0 w-100 text-center align-middle">
                            <tr class="table-light">
                                <th>í¬ë¡¤ë§ ê±´ìˆ˜</th>
                                <th>ì›ê³  ì´ˆì•ˆ ì‘ì„±</th>
                                <th>ì˜¤ë¥˜ ê±´ìˆ˜</th>
                                <th>í‚¤ì›Œë“œ ì¶”ì¶œ</th>
                                <th>ìƒìœ„ í‚¤ì›Œë“œ(3ê°œ)</th>
                            </tr>
                            <tr>
                                <td id="total-crawling">-</td>
                                <td id="total-posts">-</td>
                                <td id="total-errors">-</td>
                                <td id="total-keywords">-</td>
                                <td id="top-keywords" style="white-space:pre-line;">-</td>
                            </tr>
                        </table>
                        <div class="alert alert-primary mt-2 mb-0 py-2 small text-center">ì‹œìŠ¤í…œ ë™ì‘ ì´í›„, ì§ì ‘ ì‹¤í–‰í•œ í†µê³„ë§Œ ëˆ„ì í•˜ì—¬ ì œê³µí•©ë‹ˆë‹¤</div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card h-100 border-primary">
                    <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                        <div>
                            <i class="bi bi-graph-up-arrow"></i> API í˜¸ì¶œ ê±´ìˆ˜
                        </div>
                        <div class="d-flex align-items-center">
                            <div id="service-status" class="service-status-indicator me-2" title="ì„œë¹„ìŠ¤ ìƒíƒœ"></div>
                            <span id="status-text" class="small">ì •ìƒ</span>
                        </div>
                    </div>
                    <div class="card-body d-flex flex-column justify-content-center align-items-center">
                        <div class="mb-2 w-100 d-flex justify-content-between align-items-center">
                            <span class="fw-bold"><i class="bi bi-robot"></i> OpenAI</span>
                            <span id="openai-count" class="fs-5 text-primary">-</span>
                        </div>
                        <div class="mb-2 w-100 d-flex justify-content-between align-items-center">
                            <span class="fw-bold"><i class="bi bi-translate"></i> DeepL</span>
                            <span id="deepl-count" class="fs-5 text-success">-</span>
                        </div>
                        <div class="mb-2 w-100 d-flex justify-content-between align-items-center">
                            <span class="fw-bold"><i class="bi bi-stars"></i> Gemini</span>
                            <span id="gemini-count" class="fs-5 text-warning">-</span>
                        </div>
                        <div class="text-muted small mt-2">(ëˆ„ì  í˜¸ì¶œ ìˆ˜, ì‹¤ì‹œê°„ ì§‘ê³„)</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body">
                <h5 class="card-title"><span style="font-size:1.1em;">ğŸ“</span> ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„±</h5>
                <!-- RULE/AI MODE ì„ íƒ UI ì‹œì‘ -->
                <div class="mb-3">
                    <label class="form-check-label me-3">
                        <input class="form-check-input" type="checkbox" name="rules" value="AI_SEO"> AI SEO
                    </label>
                    <label class="form-check-label me-3">
                        <input class="form-check-input" type="checkbox" name="rules" value="AI_SEARCH"> AI SEARCH
                    </label>
                    <label class="form-check-label me-3">
                        <input class="form-check-input" type="checkbox" name="rules" value="AIEO"> AIEO
                    </label>
                    <label for="ai_mode" class="form-label ms-3 me-2">AI MODE:</label>
                    <select class="form-select d-inline-block w-auto" name="ai_mode" id="ai_mode">
                        <option value="">ì„ íƒ ì•ˆí•¨</option>
                        <option value="ë‰´ìŠ¤">ë‰´ìŠ¤</option>
                        <option value="ë¦¬ë·°">ë¦¬ë·°</option>
                        <option value="ê°€ì´ë“œ">ê°€ì´ë“œ</option>
                        <option value="ìš”ì•½">ìš”ì•½</option>
                        <option value="ë¸”ë¡œê·¸">ë¸”ë¡œê·¸</option>
                    </select>
                    <label class="form-check-label ms-3">
                        <input class="form-check-input" type="checkbox" id="policy_auto" name="policy_auto" value="1"> ê· í˜• ì¡íŒ ê´€ì (Policy) ìë™ ì ìš©
                    </label>
                </div>
                <!-- RULE/AI MODE ì„ íƒ UI ë -->
                <!-- íƒ­ ë©”ë‰´ UI -->
                <ul class="nav nav-tabs" id="inputTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="url-tab" data-bs-toggle="tab" data-bs-target="#url-tab-pane" type="button" role="tab"><i class="bi bi-link-45deg"></i> URLë¡œ ì…ë ¥</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="text-tab" data-bs-toggle="tab" data-bs-target="#text-tab-pane" type="button" role="tab"><i class="bi bi-textarea-t"></i> í…ìŠ¤íŠ¸ë¡œ ì…ë ¥</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="url-text-tab" data-bs-toggle="tab" data-bs-target="#url-text-tab-pane" type="button" role="tab"><i class="bi bi-link-45deg"></i> URL+í…ìŠ¤íŠ¸ ì…ë ¥</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="kor-content-tab" data-bs-toggle="tab" data-bs-target="#kor-content-tab-pane" type="button" role="tab"><i class="bi bi-translate"></i> KOR ì½˜í…ì¸  ì…ë ¥</button>
                    </li>
                </ul>
                <!-- íƒ­ ì½˜í…ì¸  -->
                <div class="tab-content pt-3" id="inputTabContent">
                    <div class="tab-pane fade show active" id="url-tab-pane" role="tabpanel">
                        <div class="mb-3">
                            <label for="url_input" class="form-label">ì°¸ê³  ì•„í‹°í´ URL:</label>
                            <textarea id="url_input" class="form-control" rows="3" placeholder="ë¶„ì„í•˜ê³  ì‹¶ì€ í•´ì™¸ ì•„í‹°í´ì˜ URLì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div class="alert alert-info small">ì´ íƒ­ì€ <b>DeepL ë²ˆì—­ API</b>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</div>
                    </div>
                    <div class="tab-pane fade" id="text-tab-pane" role="tabpanel">
                        <div class="mb-3">
                            <label for="text_input" class="form-label">ë²ˆì—­ ë° ìš”ì•½í•  ì›ë¬¸ í…ìŠ¤íŠ¸:</label>
                            <textarea id="text_input" class="form-control" rows="8" placeholder="ì—¬ê¸°ì— ì§ì ‘ í…ìŠ¤íŠ¸ë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
                        </div>
                        <div class="alert alert-info small">ì´ íƒ­ì€ <b>DeepL ë²ˆì—­ API</b>ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</div>
                    </div>
                    <div class="tab-pane fade" id="url-text-tab-pane" role="tabpanel">
                        <div class="mb-3">
                            <label for="url_text_url_input" class="form-label">ì°¸ê³  ì•„í‹°í´ URL:</label>
                            <textarea id="url_text_url_input" class="form-control" rows="2" placeholder="URLì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="url_text_text_input" class="form-label">ì¶”ê°€ í…ìŠ¤íŠ¸ ì…ë ¥:</label>
                            <textarea id="url_text_text_input" class="form-control" rows="4" placeholder="ì¶”ê°€ë¡œ ë²ˆì—­/ìš”ì•½í•  í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div class="alert alert-info small">ì´ íƒ­ì€ <b>Gemini ë²ˆì—­ API</b>ë¥¼ ì‚¬ìš©í•˜ë©°, ìƒì„± ê²°ê³¼ëŠ” <b>1000~2000ì ì´ë‚´</b>ë¡œ ì œí•œë©ë‹ˆë‹¤.</div>
                    </div>
                    <div class="tab-pane fade" id="kor-content-tab-pane" role="tabpanel">
                        <div class="mb-3">
                            <label for="kor_content_url_input" class="form-label">KOR ì½˜í…ì¸  URL (ì„ íƒ):</label>
                            <textarea id="kor_content_url_input" class="form-control" rows="2" placeholder="í•œêµ­ì–´ ì½˜í…ì¸ ì˜ URLì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="kor_content_text_input" class="form-label">KOR ì½˜í…ì¸  í…ìŠ¤íŠ¸ (ì„ íƒ):</label>
                            <textarea id="kor_content_text_input" class="form-control" rows="6" placeholder="í•œêµ­ì–´ ì½˜í…ì¸ ë¥¼ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”..."></textarea>
                        </div>
                        <div class="alert alert-info small">ì´ íƒ­ì€ <b>Gemini ë²ˆì—­ API</b>ë¥¼ ì‚¬ìš©í•˜ë©°, ìƒì„± ê²°ê³¼ëŠ” <b>1000~2000ì ì´ë‚´</b>ë¡œ ì œí•œë©ë‹ˆë‹¤.<br>ë²ˆì—­ ì—†ì´ ìš”ì•½ ë° AI RULE/ê°€ì´ë“œë¼ì¸ì´ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
                    </div>
                </div>
                <div class="d-inline-flex gap-2">
                    <button id="generate-btn" class="btn btn-primary" onclick="handleGenerate()">
                        <span id="btn-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                        ìƒì„±í•˜ê¸°
                    </button>
                    <button id="cancel-btn" class="btn btn-outline-danger" type="button" onclick="handleCancel()">ì¤‘ë‹¨í•˜ê¸°</button>
                </div>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  í‘œì‹œ -->
        <div class="progress-container" id="progress-container">
            <div class="step-indicator">
                <div class="step" id="step-1">1. í¬ë¡¤ë§</div>
                <div class="step" id="step-2">2. ë²ˆì—­</div>
                <div class="step" id="step-3">3. í‚¤ì›Œë“œ ì¶”ì¶œ</div>
                <div class="step" id="step-4">4. ì½˜í…ì¸  ìƒì„±</div>
            </div>
            <div class="progress">
                <div class="progress-bar" role="progressbar" style="width: 0%" id="progress-bar"></div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">ìƒì„± ê²°ê³¼</h5>
                    <div>
                        <button id="copy-btn" class="btn btn-secondary btn-sm d-none me-2" onclick="copyResult()">ì½˜í…ì¸  ë³µì‚¬</button>
                        <button id="download-btn" class="btn btn-success btn-sm d-none" onclick="downloadResult()">HTML ë‹¤ìš´ë¡œë“œ</button>
                    </div>
                </div>
                <div>
                    <strong>AI ì¶”ì²œ í‚¤ì›Œë“œ:</strong>
                    <div id="keywords-container" class="mt-2">
                        <span class="text-muted">ì½˜í…ì¸  ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ì¶”ì¶œë©ë‹ˆë‹¤.</span>
                    </div>
                </div>
                <div class="mt-2">
                    <strong>ë©”íƒ€ ì„¤ëª…:</strong>
                    <div id="meta-description-container" class="mt-1">
                        <span class="text-muted">ì½˜í…ì¸  ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.</span>
                    </div>
                </div>
                <div class="mt-2">
                    <strong>ë‹¨ì–´ ìˆ˜:</strong>
                    <span id="word-count-container" class="text-muted">-</span>
                </div>
                <div class="mt-2 d-flex justify-content-end">
                    <button id="seo-check-btn" class="btn btn-outline-info btn-sm" type="button" onclick="showSeoAppliedModal()">SEO ì ìš© ì—¬ë¶€ ë³´ê¸°</button>
                </div>
                <hr>
                <div id="result-container">
                    <p class="text-muted">ì—¬ê¸°ì— ìƒì„±ëœ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ì´ˆê³ ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let currentStep = 0;
        const totalSteps = 4;

        function updateProgress(step) {
            currentStep = step;
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = (step / totalSteps) * 100;
            progressBar.style.width = progressPercent + '%';
            
            // ë‹¨ê³„ë³„ ìƒíƒœ ì—…ë°ì´íŠ¸
            for (let i = 1; i <= totalSteps; i++) {
                const stepElement = document.getElementById(`step-${i}`);
                if (i < step) {
                    stepElement.className = 'step completed';
                } else if (i === step) {
                    stepElement.className = 'step active';
                } else {
                    stepElement.className = 'step';
                }
            }
        }

        async function copyResult() {
            const resultContainer = document.getElementById('result-container');
            // ìƒì„± ê¸°ë¡ ëª¨ë‹¬ê³¼ ë™ì¼í•œ ìŠ¤íƒ€ì¼ì˜ wrapperë¡œ ê°ì‹¸ì„œ ë³µì‚¬
            const contentToCopy = `<div class=\"modal-body\" style=\"font-family:'IBM Plex Sans KR',sans-serif;background:#fff;padding:1.5rem;border-radius:.375rem;min-height:200px;max-height:600px;overflow-y:auto;\">${resultContainer.innerHTML}</div>`;
            try {
                // HTML ì½˜í…ì¸ ë¥¼ í¬í•¨í•˜ëŠ” Blob ê°ì²´ë¥¼ ìƒì„±
                const blob = new Blob([contentToCopy], { type: 'text/html' });
                // Blobì„ í¬í•¨í•˜ëŠ” ClipboardItem ê°ì²´ ìƒì„±
                const clipboardItem = new ClipboardItem({ 'text/html': blob });
                // Rich Text í˜•ì‹ìœ¼ë¡œ í´ë¦½ë³´ë“œì— ì“°ê¸°
                await navigator.clipboard.write([clipboardItem]);
                const copyBtn = document.getElementById('copy-btn');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                copyBtn.classList.remove('btn-secondary');
                copyBtn.classList.add('btn-success');
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.classList.remove('btn-success');
                    copyBtn.classList.add('btn-secondary');
                }, 2000);
            } catch (err) {
                console.error('í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        function downloadResult() {
            const resultContainer = document.getElementById('result-container');
            const content = resultContainer.innerHTML;
            const blob = new Blob([content], { type: 'text/html' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'blog-post.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // --- ì‹¤ì‹œê°„ ì§‘ê³„ íƒ€ì´ë¨¸ ê´€ë¦¬ ë³€ìˆ˜ ì¶”ê°€ ---
        let apiUsageInterval = null;
        let apiUsageStartTime = null;

        // --- API í˜¸ì¶œ ê±´ìˆ˜ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateApiUsageCounts() {
            fetch('/api/v1/stats/api-usage')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('openai-count').textContent = data.openai ?? '-';
                    document.getElementById('deepl-count').textContent = data.deepl ?? '-';
                    document.getElementById('gemini-count').textContent = data.gemini ?? '-';
                    
                    // ì„œë¹„ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸
                    updateServiceStatus(data);
                })
                .catch(error => {
                    console.error('API í˜¸ì¶œ ê±´ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨:', error);
                    updateServiceStatus({ openai: 0, deepl: 0, gemini: 0 }, 'error');
                });
        }

        // --- ì„œë¹„ìŠ¤ ìƒíƒœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateServiceStatus(data, errorType = null) {
            const statusIndicator = document.getElementById('service-status');
            const statusText = document.getElementById('status-text');
            
            if (errorType === 'error') {
                // API ì¡°íšŒ ì‹¤íŒ¨ ì‹œ
                statusIndicator.className = 'service-status-indicator danger';
                statusText.textContent = 'ì—°ê²° ì˜¤ë¥˜';
                statusText.className = 'small text-danger';
                return;
            }
            
            // API í˜¸ì¶œ ê±´ìˆ˜ ê¸°ë°˜ ìƒíƒœ íŒë‹¨
            const totalCalls = (data.openai || 0) + (data.deepl || 0) + (data.gemini || 0);
            
            if (totalCalls === 0) {
                // API í˜¸ì¶œì´ ì—†ìŒ (ì„œë¹„ìŠ¤ ë¯¸ì‚¬ìš©)
                statusIndicator.className = 'service-status-indicator warning';
                statusText.textContent = 'ëŒ€ê¸° ì¤‘';
                statusText.className = 'small text-warning';
            } else if (totalCalls >= 1 && totalCalls <= 100000) {
                // ì •ìƒ ì‚¬ìš© ì¤‘
                statusIndicator.className = 'service-status-indicator';
                statusText.textContent = 'ì •ìƒ';
                statusText.className = 'small text-success';
            } else if (totalCalls >= 100001 && totalCalls <= 1000000) {
                // ë†’ì€ ì‚¬ìš©ëŸ‰
                statusIndicator.className = 'service-status-indicator warning';
                statusText.textContent = 'ë†’ì€ ì‚¬ìš©ëŸ‰';
                statusText.className = 'small text-warning';
            } else {
                // ë§¤ìš° ë†’ì€ ì‚¬ìš©ëŸ‰
                statusIndicator.className = 'service-status-indicator danger';
                statusText.textContent = 'ê³¼ë¶€í•˜';
                statusText.className = 'small text-danger';
            }
        }

        // --- ì‹¤ì‹œê°„ ì§‘ê³„ íƒ€ì´ë¨¸ ì‹œì‘ í•¨ìˆ˜ ---
        function startApiUsageInterval() {
            if (apiUsageInterval) clearInterval(apiUsageInterval);
            apiUsageStartTime = Date.now();
            updateApiUsageCounts();
            apiUsageInterval = setInterval(() => {
                // 1ë¶„(60ì´ˆ) ê²½ê³¼ ì‹œ íƒ€ì´ë¨¸ ì¤‘ë‹¨
                if (Date.now() - apiUsageStartTime > 60000) {
                    clearInterval(apiUsageInterval);
                    apiUsageInterval = null;
                    return;
                }
                updateApiUsageCounts();
            }, 5000);
        }

        // AbortController ì „ì—­ ì„ ì–¸
        let currentAbortController = null;

        function handleGenerate() {
            const activeTab = document.querySelector('#inputTab .nav-link.active');
            if (activeTab.id === 'url-text-tab') {
                generatePostGemini();
            } else if (activeTab.id === 'url-tab') {
                generatePostByUrl();
            } else if (activeTab.id === 'kor-content-tab') {
                generateKorContent();
            } else {
                generatePostByText();
            }
        }

        // RULE/AI MODE ì„ íƒê°’ ì¶”ì¶œ í•¨ìˆ˜
        function getSelectedRulesAndMode() {
            const ruleCheckboxes = document.querySelectorAll('input[name="rules"]:checked');
            const rules = Array.from(ruleCheckboxes).map(cb => cb.value);
            const aiMode = document.getElementById('ai_mode').value;
            const policyAuto = document.getElementById('policy_auto').checked;
            return { rules, ai_mode: aiMode, policy_auto: policyAuto };
        }

        // URL ì…ë ¥ íƒ­ìš© í•¨ìˆ˜
        async function generatePostByUrl() {
            const url = document.getElementById('url_input').value.trim();
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const metaDescriptionDiv = document.getElementById('meta-description-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            const { rules, ai_mode, policy_auto } = getSelectedRulesAndMode();

            if (!url) {
                alert('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            generateBtn.disabled = true;
            btnSpinner.classList.remove('d-none');
            copyBtn.classList.add('d-none');
            downloadBtn.classList.add('d-none');
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '<div class="d-flex justify-content-center align-items-center" style="height: 100px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="ms-3">ì½˜í…ì¸ ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p></div>';
            keywordsDiv.innerHTML = '<span class="text-muted">í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            metaDescriptionDiv.innerHTML = '<span class="text-muted">ë©”íƒ€ ì„¤ëª…ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            wordCountDiv.textContent = 'ê³„ì‚° ì¤‘...';
            updateProgress(1);
            // AbortController ìƒì„± ë° ì €ì¥
            if (currentAbortController) currentAbortController.abort();
            currentAbortController = new AbortController();
            try {
                const response = await fetch('/api/v1/generate-post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, rules, ai_mode, policy_auto }),
                    signal: currentAbortController.signal
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }
                let content = data.post;
                resultDiv.innerHTML = content;
                keywordsDiv.innerHTML = data.keywords ? data.keywords.split(',').map(k => `<span class="badge bg-secondary keyword-badge">${k.trim()}</span>`).join(' ') : '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>';
                metaDescriptionDiv.innerHTML = data.meta_description ? `<span class="text-dark">${data.meta_description}</span>` : '<span class="text-muted">ë©”íƒ€ ì„¤ëª… ì—†ìŒ</span>';
                wordCountDiv.textContent = data.word_count ? data.word_count.toLocaleString() + 'ë‹¨ì–´' : '-';
                copyBtn.classList.remove('d-none');
                downloadBtn.classList.remove('d-none');
                updateProgress(4);
                if (typeof updateApiUsageCounts === 'function') {
                    updateApiUsageCounts();
                    startApiUsageInterval();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    resultDiv.innerHTML = '<div class="alert alert-warning">ìš”ì²­ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger" role="alert"><strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}</div>`;
                }
                keywordsDiv.innerHTML = `<span class="text-danger">í‚¤ì›Œë“œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                metaDescriptionDiv.innerHTML = `<span class="text-danger">ë©”íƒ€ ì„¤ëª…ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                wordCountDiv.textContent = 'ì˜¤ë¥˜';
            } finally {
                generateBtn.disabled = false;
                btnSpinner.classList.add('d-none');
                currentAbortController = null;
            }
        }

        // í…ìŠ¤íŠ¸ ì…ë ¥ íƒ­ìš© í•¨ìˆ˜
        async function generatePostByText() {
            const text = document.getElementById('text_input').value.trim();
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const metaDescriptionDiv = document.getElementById('meta-description-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            const { rules, ai_mode, policy_auto } = getSelectedRulesAndMode();

            if (!text) {
                alert('í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            generateBtn.disabled = true;
            btnSpinner.classList.remove('d-none');
            copyBtn.classList.add('d-none');
            downloadBtn.classList.add('d-none');
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '<div class="d-flex justify-content-center align-items-center" style="height: 100px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="ms-3">ì½˜í…ì¸ ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p></div>';
            keywordsDiv.innerHTML = '<span class="text-muted">í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            metaDescriptionDiv.innerHTML = '<span class="text-muted">ë©”íƒ€ ì„¤ëª…ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            wordCountDiv.textContent = 'ê³„ì‚° ì¤‘...';
            updateProgress(1);
            // AbortController ìƒì„± ë° ì €ì¥
            if (currentAbortController) currentAbortController.abort();
            currentAbortController = new AbortController();
            try {
                const response = await fetch('/api/v1/generate-post', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text, rules, ai_mode, policy_auto }),
                    signal: currentAbortController.signal
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }
                let content = data.post;
                resultDiv.innerHTML = content;
                keywordsDiv.innerHTML = data.keywords ? data.keywords.split(',').map(k => `<span class="badge bg-secondary keyword-badge">${k.trim()}</span>`).join(' ') : '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>';
                metaDescriptionDiv.innerHTML = data.meta_description ? `<span class="text-dark">${data.meta_description}</span>` : '<span class="text-muted">ë©”íƒ€ ì„¤ëª… ì—†ìŒ</span>';
                wordCountDiv.textContent = data.word_count ? data.word_count.toLocaleString() + 'ë‹¨ì–´' : '-';
                copyBtn.classList.remove('d-none');
                downloadBtn.classList.remove('d-none');
                updateProgress(4);
                if (typeof updateApiUsageCounts === 'function') {
                    updateApiUsageCounts();
                    startApiUsageInterval();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    resultDiv.innerHTML = '<div class="alert alert-warning">ìš”ì²­ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger" role="alert"><strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}</div>`;
                }
                keywordsDiv.innerHTML = `<span class="text-danger">í‚¤ì›Œë“œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                metaDescriptionDiv.innerHTML = `<span class="text-danger">ë©”íƒ€ ì„¤ëª…ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                wordCountDiv.textContent = 'ì˜¤ë¥˜';
            } finally {
                generateBtn.disabled = false;
                btnSpinner.classList.add('d-none');
                currentAbortController = null;
            }
        }

        async function generatePostGemini() {
            const url = document.getElementById('url_text_url_input').value.trim();
            const text = document.getElementById('url_text_text_input').value.trim();
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const metaDescriptionDiv = document.getElementById('meta-description-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            const { rules, ai_mode, policy_auto } = getSelectedRulesAndMode();

            if (!url && !text) {
                alert('URL ë˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            generateBtn.disabled = true;
            btnSpinner.classList.remove('d-none');
            copyBtn.classList.add('d-none');
            downloadBtn.classList.add('d-none');
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '<div class="d-flex justify-content-center align-items-center" style="height: 100px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="ms-3">Gemini APIë¡œ ì½˜í…ì¸ ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...</p></div>';
            keywordsDiv.innerHTML = '<span class="text-muted">í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            metaDescriptionDiv.innerHTML = '<span class="text-muted">ë©”íƒ€ ì„¤ëª…ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            wordCountDiv.textContent = 'ê³„ì‚° ì¤‘...';
            updateProgress(1);
            // AbortController ìƒì„± ë° ì €ì¥
            if (currentAbortController) currentAbortController.abort();
            currentAbortController = new AbortController();
            try {
                const response = await fetch('/api/v1/generate-post-gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, text, rules, ai_mode, policy_auto }),
                    signal: currentAbortController.signal
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }
                // ê²°ê³¼ í‘œì‹œ (1000~2000ì ì´ë‚´ë¡œ ìë¥´ê¸°)
                let content = data.post;
                if (content.length > 2000) content = content.slice(0, 2000);
                if (content.length > 1000) {
                    resultDiv.innerHTML = content;
                } else {
                    resultDiv.innerHTML = '<span class="text-danger">ìƒì„± ê²°ê³¼ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</span>';
                }
                // í‚¤ì›Œë“œ, ë©”íƒ€ ì„¤ëª…, ë‹¨ì–´ ìˆ˜ ë“± í‘œì‹œ
                keywordsDiv.innerHTML = data.keywords ? data.keywords.split(',').map(k => `<span class="badge bg-secondary keyword-badge">${k.trim()}</span>`).join(' ') : '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>';
                metaDescriptionDiv.innerHTML = data.meta_description ? `<span class="text-dark">${data.meta_description}</span>` : '<span class="text-muted">ë©”íƒ€ ì„¤ëª… ì—†ìŒ</span>';
                wordCountDiv.textContent = data.word_count ? data.word_count.toLocaleString() + 'ë‹¨ì–´' : '-';
                copyBtn.classList.remove('d-none');
                downloadBtn.classList.remove('d-none');
                updateProgress(4);
                if (typeof updateApiUsageCounts === 'function') {
                    updateApiUsageCounts();
                    startApiUsageInterval();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    resultDiv.innerHTML = '<div class="alert alert-warning">ìš”ì²­ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger" role="alert"><strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}</div>`;
                }
                keywordsDiv.innerHTML = `<span class="text-danger">í‚¤ì›Œë“œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                metaDescriptionDiv.innerHTML = `<span class="text-danger">ë©”íƒ€ ì„¤ëª…ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                wordCountDiv.textContent = 'ì˜¤ë¥˜';
            } finally {
                generateBtn.disabled = false;
                btnSpinner.classList.add('d-none');
                currentAbortController = null;
            }
        }

        async function generateKorContent() {
            const url = document.getElementById('kor_content_url_input').value.trim();
            const text = document.getElementById('kor_content_text_input').value.trim();
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const metaDescriptionDiv = document.getElementById('meta-description-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            const { rules, ai_mode, policy_auto } = getSelectedRulesAndMode();
            if (!url && !text) {
                alert('URL ë˜ëŠ” í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            generateBtn.disabled = true;
            btnSpinner.classList.remove('d-none');
            copyBtn.classList.add('d-none');
            downloadBtn.classList.add('d-none');
            progressContainer.style.display = 'block';
            resultDiv.innerHTML = '<div class="d-flex justify-content-center align-items-center" style="height: 100px;"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Loading...</span></div><p class="ms-3">KOR ì½˜í…ì¸  ìš”ì•½ ë° ê°€ì´ë“œë¼ì¸ ì ìš© ì¤‘...</p></div>';
            keywordsDiv.innerHTML = '<span class="text-muted">í‚¤ì›Œë“œë¥¼ ì¶”ì¶œí•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            metaDescriptionDiv.innerHTML = '<span class="text-muted">ë©”íƒ€ ì„¤ëª…ì„ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</span>';
            wordCountDiv.textContent = 'ê³„ì‚° ì¤‘...';
            updateProgress(1);
            // AbortController ìƒì„± ë° ì €ì¥
            if (currentAbortController) currentAbortController.abort();
            currentAbortController = new AbortController();
            try {
                const response = await fetch('/api/v1/generate-post-gemini', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ url, text, rules, ai_mode, policy_auto }),
                    signal: currentAbortController.signal
                });
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || `HTTP error! status: ${response.status}`);
                }
                let content = data.post;
                if (content.length > 2000) content = content.slice(0, 2000);
                if (content.length > 1000) {
                    resultDiv.innerHTML = content;
                } else {
                    resultDiv.innerHTML = '<span class="text-danger">ìƒì„± ê²°ê³¼ê°€ ë„ˆë¬´ ì§§ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.</span>';
                }
                keywordsDiv.innerHTML = data.keywords ? data.keywords.split(',').map(k => `<span class="badge bg-secondary keyword-badge">${k.trim()}</span>`).join(' ') : '<span class="text-muted">í‚¤ì›Œë“œ ì—†ìŒ</span>';
                metaDescriptionDiv.innerHTML = data.meta_description ? `<span class="text-dark">${data.meta_description}</span>` : '<span class="text-muted">ë©”íƒ€ ì„¤ëª… ì—†ìŒ</span>';
                wordCountDiv.textContent = data.word_count ? data.word_count.toLocaleString() + 'ë‹¨ì–´' : '-';
                copyBtn.classList.remove('d-none');
                downloadBtn.classList.remove('d-none');
                updateProgress(4);
                if (typeof updateApiUsageCounts === 'function') {
                    updateApiUsageCounts();
                    startApiUsageInterval();
                }
            } catch (error) {
                if (error.name === 'AbortError') {
                    resultDiv.innerHTML = '<div class="alert alert-warning">ìš”ì²­ì´ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</div>';
                } else {
                    resultDiv.innerHTML = `<div class="alert alert-danger" role="alert"><strong>ì˜¤ë¥˜ ë°œìƒ:</strong> ${error.message}</div>`;
                }
                keywordsDiv.innerHTML = `<span class="text-danger">í‚¤ì›Œë“œë¥¼ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                metaDescriptionDiv.innerHTML = `<span class="text-danger">ë©”íƒ€ ì„¤ëª…ì„ ê°€ì ¸ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</span>`;
                wordCountDiv.textContent = 'ì˜¤ë¥˜';
            } finally {
                generateBtn.disabled = false;
                btnSpinner.classList.add('d-none');
                currentAbortController = null;
            }
        }

        function showSeoAppliedModal() {
            // RULE/ê°€ì´ë“œë¼ì¸ ì •ì˜ (í”„ë¡ íŠ¸ì— í•˜ë“œì½”ë”©, ë°±ì—”ë“œì™€ ë™ê¸°í™” í•„ìš”)
            const RULE_GUIDES = {
                'AI_SEO': [
                    'ì œëª©ì— ì£¼ìš” í‚¤ì›Œë“œ í¬í•¨', 'ë©”íƒ€ ì„¤ëª… 155ì ì´ë‚´', 'ë³¸ë¬¸ì— í‚¤ì›Œë“œ 2~3íšŒ', 'í—¤ë”© íƒœê·¸ êµ¬ì¡°í™”', 'ë‚´ë¶€/ì™¸ë¶€ ë§í¬', 'ì´ë¯¸ì§€ alt íƒœê·¸'
                ],
                'AI_SEARCH': [
                    'ê²€ìƒ‰ ì˜ë„ ë°˜ì˜', 'FAQ/Q&A í¬í•¨', 'ì˜ˆì‹œ/ì¼€ì´ìŠ¤ ì œì‹œ', 'ëª…í™•í•œ ë‹µë³€', 'ì—°ê´€ ì§ˆë¬¸ í¬í•¨'
                ],
                'AIEO': [
                    'íŠ¸ë Œë“œ í‚¤ì›Œë“œ ìë™ ì‚½ì…', 'ì¸ê¸° í† í”½ ë°˜ì˜', 'LSI í‚¤ì›Œë“œ í¬í•¨', 'ê´€ì‹¬ì‚¬ ë°˜ì˜'
                ],
                'POLICY': [
                    'ì¥ë‹¨ì /ê°•ì•½ì /ì´ì -ë‹¨ì  ëª…í™•íˆ', 'ë¹„êµ ìš”ì•½í‘œ', 'ì¤‘ë¦½ì  ì–¸ì–´', 'ë¹„êµ ì–¸ì–´(ìµœê³ /ì´ìƒì  ë“±)', 'ê³ ë ¤ì‚¬í•­/ê°€ì¹˜ì—†ìŒ/ê°€ê¸°ì „ ì„¹ì…˜'
                ],
                'AI_MODE': {
                    'ë‰´ìŠ¤': ['ìµœì‹  ì •ë³´', 'ê°ê´€ì /ê°„ê²°í•œ ë¬¸ì²´', 'ì¶œì²˜ ëª…ì‹œ'],
                    'ë¦¬ë·°': ['ì¥ë‹¨ì ', 'ì‹¤ì œ ê²½í—˜', 'ë³„ì  ë“±'],
                    'ê°€ì´ë“œ': ['ë‹¨ê³„ë³„ ì„¤ëª…', 'How-to', 'ì²´í¬ë¦¬ìŠ¤íŠ¸'],
                    'ìš”ì•½': ['í•µì‹¬ë§Œ ê°„ê²°', 'ë¶ˆí•„ìš”í•œ ë‚´ìš© ìƒëµ'],
                    'ë¸”ë¡œê·¸': ['ê°œì¸ì  ê²½í—˜/ì¸ì‚¬ì´íŠ¸', 'ë…ì ì†Œí†µ', 'í…Œí¬ë‹ˆì»¬ SEO(robots.txt, sitemap, êµ¬ì¡°í™”, ëª¨ë°”ì¼, HTTPS ë“±)']
                }
            };
            const ruleCheckboxes = document.querySelectorAll('input[name="rules"]:checked');
            const rules = Array.from(ruleCheckboxes).map(cb => cb.value);
            const aiMode = document.getElementById('ai_mode').value;
            const policyAuto = document.getElementById('policy_auto') ? document.getElementById('policy_auto').checked : false;
            let msg = '<strong>ì ìš©ëœ ì˜µì…˜ ë° ê°€ì´ë“œë¼ì¸</strong><ul style="margin-bottom:0">';
            if (rules.length > 0) {
                rules.forEach(rule => {
                    msg += `<li><b>${rule}</b>: <span class='text-secondary small'>${(RULE_GUIDES[rule]||[]).join(', ')}</span></li>`;
                });
            }
            if (aiMode && RULE_GUIDES['AI_MODE'][aiMode]) {
                msg += `<li><b>AI MODE: ${aiMode}</b>: <span class='text-secondary small'>${RULE_GUIDES['AI_MODE'][aiMode].join(', ')}</span></li>`;
            }
            if (policyAuto) {
                msg += `<li><b>ê· í˜• ì¡íŒ ê´€ì (Policy)</b>: <span class='text-secondary small'>${RULE_GUIDES['POLICY'].join(', ')}</span></li>`;
            }
            if (rules.length === 0 && !aiMode && !policyAuto) {
                msg += '<li>ì ìš©ëœ ì˜µì…˜ ì—†ìŒ</li>';
            }
            msg += '</ul>';
            showSimpleModal('SEO ì ìš© ì—¬ë¶€', msg);
        }

        // ê°„ë‹¨í•œ ëª¨ë‹¬ ìƒì„± í•¨ìˆ˜
        function showSimpleModal(title, html) {
            let modal = document.getElementById('seo-applied-modal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'seo-applied-modal';
                modal.innerHTML = `
                <div class="modal fade" tabindex="-1" id="seoAppliedModalReal">
                  <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title">${title}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                      </div>
                      <div class="modal-body">${html}</div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
                      </div>
                    </div>
                  </div>
                </div>`;
                document.body.appendChild(modal);
            } else {
                modal.querySelector('.modal-title').innerHTML = title;
                modal.querySelector('.modal-body').innerHTML = html;
            }
            // Bootstrap ëª¨ë‹¬ í‘œì‹œ
            const realModal = new bootstrap.Modal(document.getElementById('seoAppliedModalReal'));
            realModal.show();
        }

        function handleCancel() {
            // ìš”ì²­ ì¤‘ë‹¨
            if (currentAbortController) {
                currentAbortController.abort();
                currentAbortController = null;
            }
            // UI ë¦¬ì…‹
            const generateBtn = document.getElementById('generate-btn');
            const btnSpinner = document.getElementById('btn-spinner');
            const resultDiv = document.getElementById('result-container');
            const keywordsDiv = document.getElementById('keywords-container');
            const metaDescriptionDiv = document.getElementById('meta-description-container');
            const wordCountDiv = document.getElementById('word-count-container');
            const copyBtn = document.getElementById('copy-btn');
            const downloadBtn = document.getElementById('download-btn');
            const progressContainer = document.getElementById('progress-container');
            generateBtn.disabled = false;
            btnSpinner.classList.add('d-none');
            resultDiv.innerHTML = '<p class="text-muted">ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤.</p>';
            keywordsDiv.innerHTML = '<span class="text-muted">-</span>';
            metaDescriptionDiv.innerHTML = '<span class="text-muted">-</span>';
            wordCountDiv.textContent = '-';
            copyBtn.classList.add('d-none');
            downloadBtn.classList.add('d-none');
            progressContainer.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            fetch('/api/v1/stats/daily')
                .then(res => res.json())
                .then(data => {
                    // ëˆ„ì ê°’ ê³„ì‚°
                    const totalCrawling = data.crawling.reduce((a, b) => a + b, 0);
                    const totalPosts = data.posts.reduce((a, b) => a + b, 0);
                    // ëˆ„ì  ì˜¤ë¥˜ ê±´ìˆ˜ ê³„ì‚° (crawling_stats.jsonì˜ recent_attemptsì—ì„œ success: falseì¸ ê°œìˆ˜)
                    fetch('/crawling_stats.json')
                        .then(res2 => res2.json())
                        .then(stats => {
                            const totalErrors = (stats.recent_attempts || []).filter(x => x.success === false).length;
                            document.getElementById('total-crawling').textContent = totalCrawling;
                            document.getElementById('total-posts').textContent = totalPosts;
                            document.getElementById('total-errors').textContent = totalErrors;
                        });
                });
            // ëˆ„ì  í‚¤ì›Œë“œ/ìƒìœ„ í‚¤ì›Œë“œ fetch
            fetch('/api/v1/stats/keywords-summary')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('total-keywords').textContent = data.total_keywords ?? '-';
                    // 2ì¤„ë¡œ í‘œì‹œ: ì‰¼í‘œë¡œ ë¶„ë¦¬ í›„ ì¤„ë°”ê¿ˆ
                    if (data.top_keywords) {
                        document.getElementById('top-keywords').textContent = data.top_keywords.split(',').map(k => k.trim()).join('\n');
                    } else {
                        document.getElementById('top-keywords').textContent = '-';
                    }
                });
            // ìµœì´ˆ 1íšŒë§Œ API í˜¸ì¶œ ê±´ìˆ˜ í‘œì‹œ
            updateApiUsageCounts();
        });
    </script>

    <!-- ê³ ì •í˜• copyright footer -->
    <footer class="footer position-fixed w-100 text-center bg-dark text-white py-2" style="left:0;bottom:0;z-index:1050;box-shadow:0 -2px 8px rgba(0,0,0,0.08);font-size:0.97rem;letter-spacing:0.01em;">
        <span style="opacity:0.85;">
            &copy; made by <strong>chunghyo</strong>, 2026 &nbsp;|&nbsp; email : <a href="mailto:chunghyo@troe.kr" class="text-warning text-decoration-none">chunghyo@troe.kr</a>
        </span>
    </footer>
</body>
</html>